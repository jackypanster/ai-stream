<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Qwen | Code Whispers</title><meta name=keywords content><meta name=description content="Code Whispers - ä¸€ä¸ªå…³äº AIã€ç¼–ç¨‹å’ŒæŠ€æœ¯çš„èµ›åšç©ºé—´ã€‚"><meta name=author content="Jacky Pan"><link rel=canonical href=https://jackypanster.github.io/ai-stream/tags/qwen/><link crossorigin=anonymous href=/ai-stream/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://jackypanster.github.io/ai-stream/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jackypanster.github.io/ai-stream/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jackypanster.github.io/ai-stream/favicon-32x32.png><link rel=apple-touch-icon href=https://jackypanster.github.io/ai-stream/apple-touch-icon.png><link rel=mask-icon href=https://jackypanster.github.io/ai-stream/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://jackypanster.github.io/ai-stream/tags/qwen/index.xml><link rel=alternate hreflang=en href=https://jackypanster.github.io/ai-stream/tags/qwen/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jackypanster.github.io/ai-stream/tags/qwen/"><meta property="og:site_name" content="Code Whispers"><meta property="og:title" content="Qwen"><meta property="og:description" content="Code Whispers - ä¸€ä¸ªå…³äº AIã€ç¼–ç¨‹å’ŒæŠ€æœ¯çš„èµ›åšç©ºé—´ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Qwen"><meta name=twitter:description content="Code Whispers - ä¸€ä¸ªå…³äº AIã€ç¼–ç¨‹å’ŒæŠ€æœ¯çš„èµ›åšç©ºé—´ã€‚"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jackypanster.github.io/ai-stream/ accesskey=h title="Code Whispers (Alt + H)">Code Whispers</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jackypanster.github.io/ai-stream/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://jackypanster.github.io/ai-stream/>Home</a>&nbsp;Â»&nbsp;<a href=https://jackypanster.github.io/ai-stream/tags/>Tags</a></div><h1>Qwen
<a href=/ai-stream/tags/qwen/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–</h2></header><div class=entry-content><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ vLLM é«˜æ•ˆéƒ¨ç½² Qwen3-32B-AWQ é‡åŒ–æ¨¡å‹ï¼Œå®ç° 32K ä¸Šä¸‹æ–‡çª—å£ã€OpenAI å…¼å®¹ APIï¼Œå¹¶ç¦ç”¨æ€è€ƒæ¨¡å¼ã€‚é€šè¿‡å¯¹ Docker åŠ vLLM å‚æ•°çš„ç²¾ç»†è°ƒä¼˜ï¼Œæœ€å¤§åŒ–æ¨¡å‹åœ¨å¤š GPU ç¯å¢ƒä¸‹çš„æ¨ç†æ€§èƒ½ã€‚</p></div><footer class=entry-footer><span title='2025-06-10 20:45:00 +0800 +0800'>June 10, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;732 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-32b-awq-vllm-guide/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡</h2></header><div class=entry-content><p>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡ æœ¬æ–‡æ˜¯ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚
åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚
ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨&lt;think>...&lt;/think>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§"æ€è€ƒè¿‡ç¨‹"æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚
åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š
&lt;think> é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚ æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚ åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š 1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰ 2. è¯»å–æˆ–å†™å…¥å†…å®¹ 3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­ &lt;/think> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š ```python # å†™å…¥æ–‡ä»¶ with open('example.txt', 'w') as file: file.write('Hello, World!') # è¯»å–æ–‡ä»¶ with open('example.txt', 'r') as file: content = file.read() print(content) ### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶ vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š 1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨ 2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶ æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚ ## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç° ### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š ```jinja {% if messages %} {% set loop_messages = messages %} {% else %} {% set loop_messages = [{'role': 'system', 'content': ''}] %} {% endif %} {% for message in loop_messages %} {% if message['role'] == 'user' %} &lt;|im_start|>user {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'assistant' %} &lt;|im_start|>assistant {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'system' %} &lt;|im_start|>system {{ message['content'] }}&lt;|im_end|> {% endif %} {% endfor %} &lt;|im_start|>assistant {% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %} è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ&lt;think>...&lt;/think>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-04 14:30:00 +0800 +0800'>June 4, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;329 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—</h2></header><div class=entry-content><p>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å— ğŸ“‹ æ¦‚è¿° æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨vLLMé«˜æ•ˆéƒ¨ç½²Qwen3-30B-A3Bæ¨¡å‹ï¼Œå®ç°32Kä¸Šä¸‹æ–‡çª—å£å’ŒOpenAIå…¼å®¹APIï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚é€šè¿‡ç²¾ç»†è°ƒæ•´éƒ¨ç½²å‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ‰é™çš„GPUèµ„æºä¸‹æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½ã€‚
ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚ ç¡¬ä»¶é…ç½® 4å—NVIDIA GPU (æ¯å—22GBæ˜¾å­˜ï¼Œæ€»è®¡88GB) 512GBç³»ç»Ÿå†…å­˜ 2TB SSDå­˜å‚¨ 56æ ¸CPU è½¯ä»¶ç¯å¢ƒ Ubuntu 24.04 NVIDIAé©±åŠ¨ 550.144.03 CUDA 12.4 Docker + NVIDIA Container Toolkit ğŸ§  æ¨¡å‹ä¸æ¶æ„ Qwen3-30B-A3Bæ˜¯é˜¿é‡Œäº‘å‘å¸ƒçš„é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
30Bå‚æ•°é‡ åŸç”Ÿæ”¯æŒ32Kä¸Šä¸‹æ–‡é•¿åº¦ æ”¯æŒæ€è€ƒæ¨¡å¼(Chain-of-Thought) ä¼˜å¼‚çš„å¤šè¯­è¨€ä¸ä»£ç èƒ½åŠ› æˆ‘ä»¬ä½¿ç”¨vLLMä½œä¸ºæ¨ç†å¼•æ“ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒé‡ï¼š
é«˜æ•ˆå†…å­˜ç®¡ç†ï¼šé€šè¿‡PagedAttentionæŠ€æœ¯ä¼˜åŒ–KVç¼“å­˜ å¼ é‡å¹¶è¡Œï¼šè‡ªåŠ¨è·¨å¤šGPUåˆ†å¸ƒæ¨¡å‹æƒé‡ OpenAIå…¼å®¹APIï¼šç›´æ¥æ›¿ä»£OpenAI APIï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰åº”ç”¨ åŠ¨æ€æ‰¹å¤„ç†ï¼šè‡ªåŠ¨æ‰¹å¤„ç†å¤šè¯·æ±‚ï¼Œæé«˜ååé‡ ğŸ³ éƒ¨ç½²è„šæœ¬ ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç”¨äºéƒ¨ç½²çš„Dockerå‘½ä»¤ï¼Œç»è¿‡ç²¾å¿ƒè°ƒä¼˜ä»¥å¹³è¡¡æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ï¼š
docker run -d \ --runtime=nvidia \ --gpus=all \ --name coder \ -v /home/llm/model/qwen/qwen3-30b-a3b:/qwen/qwen3-30b-a3b \ -p 8000:8000 \ --cpuset-cpus 0-55 \ --ulimit memlock=-1 \ --ulimit stack=67108864 \ --restart always \ --ipc=host \ vllm/vllm-openai:v0.8.5 \ --model /qwen/qwen3-30b-a3b \ --served-model-name coder \ --tensor-parallel-size 4 \ --dtype half \ --max-model-len 32768 \ --max-num-batched-tokens 4096 \ --gpu-memory-utilization 0.93 \ --block-size 32 \ --enable-chunked-prefill \ --swap-space 16 \ --tokenizer-pool-size 56 \ --disable-custom-all-reduce ğŸ”§ å‚æ•°è¯¦è§£ä¸ä¼˜åŒ–ç­–ç•¥ Dockerå®¹å™¨é…ç½® å‚æ•° å€¼ ä½œç”¨ --runtime=nvidia å¯ç”¨NVIDIAå®¹å™¨è¿è¡Œæ—¶ --gpus=all å°†æ‰€æœ‰GPUæš´éœ²ç»™å®¹å™¨ --cpuset-cpus 0-55 é™åˆ¶å®¹å™¨ä½¿ç”¨0-55å·CPUæ ¸å¿ƒ --ulimit memlock=-1 ç§»é™¤å†…å­˜é”å®šé™åˆ¶ï¼Œæé«˜æ€§èƒ½ --ipc=host ä½¿ç”¨ä¸»æœºIPCå‘½åç©ºé—´ï¼Œå¯¹å…±äº«å†…å­˜å¾ˆé‡è¦ vLLMå¼•æ“é…ç½® 1. å¼ é‡å¹¶è¡Œç­–ç•¥ --tensor-parallel-size 4 æˆ‘ä»¬ä½¿ç”¨4è·¯å¼ é‡å¹¶è¡Œï¼Œå°†æ¨¡å‹åˆ†å¸ƒåœ¨4å—GPUä¸Šã€‚è¿™æ˜¯åŸºäºå®éªŒå¾—å‡ºçš„æœ€ä½³é…ç½® - åœ¨æˆ‘ä»¬çš„ç¡¬ä»¶ä¸Šï¼Œæ¯å—22GBæ˜¾å­˜çš„GPUæ— æ³•å•ç‹¬åŠ è½½å®Œæ•´çš„30Bæ¨¡å‹ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-03 16:00:00 +0800 +0800'>June 3, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;308 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)</h2></header><div class=entry-content><p>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR) é¡¹ç›®æ¦‚è¿° æœ¬é¡¹ç›®åŸºäºQwen2.5-Omni-7Bæ¨¡å‹ï¼Œå®ç°äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³ è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ï¼šå°†è¯­éŸ³æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒæ ‡å‡†ASRå’Œçº¯ASRä¸¤ç§æ¨¡å¼ é¡¹ç›®åœ°å€ï¼šhttps://github.com/jackypanster/qwen-omni
ç¯å¢ƒé…ç½® æ¨èä½¿ç”¨condaç®¡ç†Pythonç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–å®‰è£…çš„ç¨³å®šæ€§ï¼š
# åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ conda create -n qwen-tts python=3.10 conda activate qwen-tts # å®‰è£…PyTorchï¼ˆGPUç‰ˆæœ¬ï¼‰ conda install pytorch=2.5.1 pytorch-cuda=12.1 -c pytorch -c nvidia conda install torchvision torchaudio -c pytorch # å®‰è£…å…¶ä»–ä¾èµ– conda install streamlit python-soundfile -c conda-forge pip install git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview pip install qwen-omni-utils æ ¸å¿ƒåŠŸèƒ½å®ç° 1. æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ def text_to_speech(text_input, output_audio_path="output/output.wav", speaker="Chelsie"): # åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨ model = Qwen2_5OmniForConditionalGeneration.from_pretrained( model_path, config=config, torch_dtype="auto", device_map="auto" ) processor = Qwen2_5OmniProcessor.from_pretrained(model_path) # æ„é€ å¯¹è¯ conversation = [ {"role": "system", "content": [{"type": "text", "text": "You are Qwen..."}]}, {"role": "user", "content": [{"type": "text", "text": text_input}]} ] # ç”Ÿæˆè¯­éŸ³ with torch.no_grad(): text_ids, audio = model.generate( **inputs, speaker=speaker, do_sample=True, temperature=0.8, top_p=0.95, max_new_tokens=1024 ) 2. è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ def audio_to_text(audio_path: str) -> str: # æ ‡å‡†ASRæ¨¡å¼ conversation = [ {"role": "system", "content": [{"type": "text", "text": "ä½ æ˜¯Qwen..."}]}, {"role": "user", "content": [{"type": "audio", "audio": audio_path}]} ] # ç”Ÿæˆæ–‡æœ¬ with torch.no_grad(): text_ids = model.generate( **inputs, do_sample=False, max_new_tokens=1024, return_audio=False ) Webç•Œé¢å®ç° ä½¿ç”¨Streamlitæ„å»ºäº†ç®€æ´çš„Webç•Œé¢ï¼š
...</p></div><footer class=entry-footer><span title='2025-05-20 20:24:06 +0800 +0800'>May 20, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;251 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)" href=https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qwen2.5-Omni-7B æ–‡æœ¬è½¬è¯­éŸ³éƒ¨ç½²æŒ‡å—</h2></header><div class=entry-content><p>æ¦‚è¿° æœ¬è„šæœ¬åŸºäº Qwen2.5-Omni-7B å¤šæ¨¡æ€æ¨¡å‹å®ç°æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰åŠŸèƒ½ï¼Œæ”¯æŒç”Ÿæˆè‡ªç„¶æµç•…çš„ä¸­æ–‡ / è‹±æ–‡è¯­éŸ³ï¼Œå¹¶æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹ï¼ˆå¥³æ€§ â€œChelsieâ€ã€ç”·æ€§ â€œEthanâ€ï¼‰ã€‚è„šæœ¬å¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼ˆ.wavæ ¼å¼ï¼‰ï¼Œé€‚ç”¨äºè¯­éŸ³åŠ©æ‰‹ã€å†…å®¹åˆ›ä½œã€æ— éšœç¢æœåŠ¡ç­‰åœºæ™¯ã€‚
ä¸»è¦ç‰¹æ€§ ğŸ™ï¸ æ”¯æŒè‡ªç„¶æµç•…çš„ ä¸­æ–‡/è‹±æ–‡ è¯­éŸ³åˆæˆ ğŸ‘¥ æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹é€‰æ‹©ï¼š å¥³æ€§å£°çº¿ï¼šâ€œChelsieâ€ ç”·æ€§å£°çº¿ï¼šâ€œEthanâ€ ğŸ’¾ è¾“å‡ºæ ¼å¼ï¼šæ ‡å‡† .wav éŸ³é¢‘æ–‡ä»¶ ğŸš€ é«˜æ€§èƒ½æ¨ç†ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ åº”ç”¨åœºæ™¯ æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹å¼€å‘ å†…å®¹åˆ›ä½œä¸æ’­å®¢åˆ¶ä½œ æ— éšœç¢æœåŠ¡ æ•™è‚²ç±»åº”ç”¨ å¤šåª’ä½“å†…å®¹ç”Ÿæˆ å¼€å§‹ä½¿ç”¨ ğŸ’¡ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
Python 3.8+ CUDA 11.7+ (å¦‚éœ€GPUåŠ é€Ÿ) è‡³å°‘16GBå¯ç”¨å†…å­˜ å®‰è£…ä¾èµ–åº“
uv init uv add git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview uv add accelerate uv add qwen-omni-utils[decord] uv add soundfile uv add torchvision uv sync å®Œæ•´è„šæœ¬ä»£ç ï¼ˆmain_text2audio.pyï¼‰
import os import soundfile as sf import torch from transformers import Qwen2_5OmniForConditionalGeneration, Qwen2_5OmniProcessor from qwen_omni_utils import process_mm_info from transformers import AutoConfig def text_to_speech( text_input: str, output_audio_path: str = "output/test_audio.wav", speaker: str = "Chelsie", model_path: str = "/home/llm/model/qwen/Omni/" # æ”¹ä¸ºæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„ ): """ æ–‡æœ¬è½¬è¯­éŸ³æ ¸å¿ƒå‡½æ•° :param text_input: è¾“å…¥æ–‡æœ¬ï¼ˆæ”¯æŒä¸­æ–‡/è‹±æ–‡ï¼‰ :param output_audio_path: éŸ³é¢‘è¾“å‡ºè·¯å¾„ï¼ˆå«æ–‡ä»¶åï¼‰ :param speaker: è¯­éŸ³ç±»å‹ï¼ˆ"Chelsie"å¥³æ€§/"Ethan"ç”·æ€§ï¼‰ :param model_path: æ¨¡å‹è·¯å¾„ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰ """ # 1. åŠ è½½æ¨¡å‹é…ç½®ï¼ˆä¿®å¤ROPEå‚æ•°å…¼å®¹æ€§ï¼‰ config = AutoConfig.from_pretrained(model_path, local_files_only=True) if hasattr(config, "rope_scaling") and "mrope_section" in config.rope_scaling: config.rope_scaling.pop("mrope_section") # 2. åŠ è½½æ¨¡å‹ï¼ˆæ”¯æŒGPUè‡ªåŠ¨åˆ†é…ï¼‰ model = Qwen2_5OmniForConditionalGeneration.from_pretrained( model_path, config=config, torch_dtype="auto", device_map="auto", local_files_only=(model_path != "Qwen/Qwen2.5-Omni-7B") ) processor = Qwen2_5OmniProcessor.from_pretrained(model_path) # 3. ç³»ç»Ÿæç¤ºï¼ˆå¿…é¡»åŒ…å«è¯­éŸ³ç”Ÿæˆèƒ½åŠ›å£°æ˜ï¼‰ system_prompt = [ { "role": "system", "content": [ {"type": "text", "text": "You are Qwen, a virtual human developed by the Qwen Team, Alibaba Group, capable of perceiving auditory and visual inputs, as well as generating text and speech."} ] } ] # 4. æ„å»ºå¯¹è¯ï¼ˆçº¯æ–‡æœ¬è¾“å…¥ï¼‰ conversation = system_prompt + [ {"role": "user", "content": [{"type": "text", "text": text_input}]} ] # 5. å¤„ç†è¾“å…¥æ•°æ® text = processor.apply_chat_template(conversation, add_generation_prompt=True, tokenize=False) audios, images, videos = process_mm_info(conversation, use_audio_in_video=False) # 6. ç”Ÿæˆè¯­éŸ³ inputs = processor( text=text, audio=audios, images=images, videos=videos, return_tensors="pt", padding=True, use_audio_in_video=False ).to(model.device, model.dtype) with torch.no_grad(): text_ids, audio = model.generate( **inputs, speaker=speaker, do_sample=True, # å¯ç”¨é‡‡æ ·æ¨¡å¼ä»¥ä½¿ç”¨temperature/top_p temperature=0.8, # æ§åˆ¶éšæœºæ€§ï¼ˆ0.5-1.0è¾ƒè‡ªç„¶ï¼‰ top_p=0.95, # æ ¸é‡‡æ ·å‚æ•° max_new_tokens=1024, # æ§åˆ¶è¯­éŸ³æ—¶é•¿ï¼ˆçº¦15ç§’ï¼‰ use_audio_in_video=False ) # 7. ä¿å­˜ç»“æœ os.makedirs(os.path.dirname(output_audio_path), exist_ok=True) sf.write(output_audio_path, audio.reshape(-1).cpu().numpy(), samplerate=24000) print(f"âœ… ç”Ÿæˆå®Œæˆï¼š{output_audio_path}") print(f"ğŸ“„ ç”Ÿæˆæ–‡æœ¬ï¼š{processor.batch_decode(text_ids, skip_special_tokens=True)[0]}") if __name__ == "__main__": # ç¤ºä¾‹è¾“å…¥ï¼ˆå¯æ›¿æ¢ä¸ºä»»æ„æ–‡æœ¬ï¼‰ input_text = "ä½ å¥½ï¼Œè¿™æ˜¯Qwen2.5-Omniçš„æ–‡æœ¬è½¬è¯­éŸ³ç¤ºä¾‹ã€‚ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼" # è°ƒç”¨å‡½æ•°ï¼ˆæŒ‡å®šè¾“å‡ºè·¯å¾„å’Œè¯­éŸ³ç±»å‹ï¼‰ text_to_speech( input_text, output_audio_path="output/hello_qwen.wav", speaker="Chelsie" # å¯é€‰"Ethan" ) è¿è¡Œè„šæœ¬
...</p></div><footer class=entry-footer><span title='2025-05-19 10:54:50 +0800 +0800'>May 19, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;292 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen2.5-Omni-7B æ–‡æœ¬è½¬è¯­éŸ³éƒ¨ç½²æŒ‡å—" href=https://jackypanster.github.io/ai-stream/posts/how-to-setup-qwen-omni/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://jackypanster.github.io/ai-stream/>Code Whispers</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>