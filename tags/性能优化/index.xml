<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>æ€§èƒ½ä¼˜åŒ– on AI é¿éš¾æ‰€</title><link>https://jackypanster.github.io/ai-stream/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</link><description>Recent content in æ€§èƒ½ä¼˜åŒ– on AI é¿éš¾æ‰€</description><generator>Hugo -- 0.147.7</generator><language>en-us</language><lastBuildDate>Sat, 07 Jun 2025 17:50:00 +0800</lastBuildDate><atom:link href="https://jackypanster.github.io/ai-stream/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/index.xml" rel="self" type="application/rss+xml"/><item><title>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/</link><pubDate>Sat, 07 Jun 2025 17:50:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/</guid><description>&lt;h1 id="deepseek-r1-0528-qwen3-8béƒ¨ç½²ä¼˜åŒ–å®è·µæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯">DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µï¼šæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯&lt;/h1>
&lt;p>åœ¨AIå¤§æ¨¡å‹éƒ¨ç½²é¢†åŸŸï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•å¯¹DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ä½¿ç”¨vLLMè¿›è¡Œéƒ¨ç½²ä¼˜åŒ–çš„å…¨è¿‡ç¨‹ï¼Œé‡ç‚¹å…³æ³¨ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸ç¡¬ä»¶èµ„æºåˆ©ç”¨çš„å¹³è¡¡è°ƒä¼˜ã€‚&lt;/p>
&lt;h2 id="ç¯å¢ƒä¸åŸºç¡€è®¾æ–½">ç¯å¢ƒä¸åŸºç¡€è®¾æ–½&lt;/h2>
&lt;p>æˆ‘ä»¬çš„éƒ¨ç½²ç¯å¢ƒå…·å¤‡ä»¥ä¸‹é…ç½®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>GPU&lt;/strong>: 4 x NVIDIA RTX 2080 Tiï¼ˆæ¯å¼ 22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBæ˜¾å­˜ï¼‰
&lt;ul>
&lt;li>æ¶æ„: Turing&lt;/li>
&lt;li>è®¡ç®—èƒ½åŠ›: 7.5&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>CPU&lt;/strong>: 56æ ¸&lt;/li>
&lt;li>&lt;strong>å†…å­˜&lt;/strong>: 512GB RAM&lt;/li>
&lt;li>&lt;strong>å­˜å‚¨&lt;/strong>: 2TB SSD&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿ&lt;/strong>: Ubuntu 24.04&lt;/li>
&lt;li>&lt;strong>å®¹å™¨é•œåƒ&lt;/strong>: &lt;code>vllm/vllm-openai:v0.8.5&lt;/code>&lt;/li>
&lt;li>&lt;strong>NVIDIAé©±åŠ¨&lt;/strong>: 570.153.02ï¼ˆCUDA 12.8ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ">ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ&lt;/h2>
&lt;p>æˆ‘ä»¬æœ€åˆçš„éƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpus all &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --shm-size 16g &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ulimit memlock&lt;span style="color:#f92672">=&lt;/span>-1 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ipc&lt;span style="color:#f92672">=&lt;/span>host &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8000:8000 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -e CUDA_MODULE_LOADING&lt;span style="color:#f92672">=&lt;/span>LAZY &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> vllm/vllm-openai:v0.8.5 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --model /models &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --served-model-name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --tensor-parallel-size &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpu-memory-utilization 0.93 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --dtype float16 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --max-model-len &lt;span style="color:#ae81ff">65536&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --trust-remote-code &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --load-format safetensors &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --disable-custom-all-reduce
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š&lt;/p></description><content:encoded><![CDATA[<h1 id="deepseek-r1-0528-qwen3-8béƒ¨ç½²ä¼˜åŒ–å®è·µæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯">DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µï¼šæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯</h1>
<p>åœ¨AIå¤§æ¨¡å‹éƒ¨ç½²é¢†åŸŸï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•å¯¹DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ä½¿ç”¨vLLMè¿›è¡Œéƒ¨ç½²ä¼˜åŒ–çš„å…¨è¿‡ç¨‹ï¼Œé‡ç‚¹å…³æ³¨ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸ç¡¬ä»¶èµ„æºåˆ©ç”¨çš„å¹³è¡¡è°ƒä¼˜ã€‚</p>
<h2 id="ç¯å¢ƒä¸åŸºç¡€è®¾æ–½">ç¯å¢ƒä¸åŸºç¡€è®¾æ–½</h2>
<p>æˆ‘ä»¬çš„éƒ¨ç½²ç¯å¢ƒå…·å¤‡ä»¥ä¸‹é…ç½®ï¼š</p>
<ul>
<li><strong>GPU</strong>: 4 x NVIDIA RTX 2080 Tiï¼ˆæ¯å¼ 22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBæ˜¾å­˜ï¼‰
<ul>
<li>æ¶æ„: Turing</li>
<li>è®¡ç®—èƒ½åŠ›: 7.5</li>
</ul>
</li>
<li><strong>CPU</strong>: 56æ ¸</li>
<li><strong>å†…å­˜</strong>: 512GB RAM</li>
<li><strong>å­˜å‚¨</strong>: 2TB SSD</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>: Ubuntu 24.04</li>
<li><strong>å®¹å™¨é•œåƒ</strong>: <code>vllm/vllm-openai:v0.8.5</code></li>
<li><strong>NVIDIAé©±åŠ¨</strong>: 570.153.02ï¼ˆCUDA 12.8ï¼‰</li>
</ul>
<h2 id="ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ">ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ</h2>
<p>æˆ‘ä»¬æœ€åˆçš„éƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --gpus all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name coder <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --shm-size 16g <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ulimit memlock<span style="color:#f92672">=</span>-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --restart always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ipc<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 8000:8000 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -e CUDA_MODULE_LOADING<span style="color:#f92672">=</span>LAZY <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  vllm/vllm-openai:v0.8.5 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --model /models <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --served-model-name coder <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --tensor-parallel-size <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --gpu-memory-utilization 0.93 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dtype float16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-model-len <span style="color:#ae81ff">65536</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --trust-remote-code <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --load-format safetensors <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --disable-custom-all-reduce
</span></span></code></pre></div><p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong>å…±äº«å†…å­˜</strong>ï¼š16GBå¯èƒ½ä¸è¶³ä»¥æ”¯æŒé«˜å¹¶å‘è¯·æ±‚</li>
<li><strong>äº¤æ¢ç©ºé—´</strong>ï¼šæœªé…ç½®SSDäº¤æ¢ç©ºé—´æ”¯æŒ</li>
<li><strong>æ‰¹å¤„ç†èƒ½åŠ›</strong>ï¼šæœªè®¾ç½®<code>--max-num-batched-tokens</code>å‚æ•°</li>
<li><strong>CUDAå›¾å½¢ä¼˜åŒ–</strong>ï¼šæœªä½¿ç”¨<code>--enforce-eager</code>æé«˜ç¨³å®šæ€§</li>
</ol>
<h2 id="æ·±å…¥ä¼˜åŒ–ç­–ç•¥">æ·±å…¥ä¼˜åŒ–ç­–ç•¥</h2>
<h3 id="1-å†…å­˜ä¸è®¡ç®—èµ„æºåˆ†é…">1. å†…å­˜ä¸è®¡ç®—èµ„æºåˆ†é…</h3>
<p>å¯¹äºRTX 2080 Tiè¿™ç±»Turingæ¶æ„GPUï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„æ˜¾å­˜åˆ†é…ä¸å¹¶è¡Œç­–ç•¥ï¼š</p>
<ul>
<li><strong>å…±äº«å†…å­˜æ‰©å±•</strong>ï¼šå°†<code>--shm-size</code>ä»16gå¢åŠ åˆ°64gï¼Œå……åˆ†åˆ©ç”¨512GBç³»ç»Ÿå†…å­˜</li>
<li><strong>æ˜¾å­˜åˆ©ç”¨ç‡</strong>ï¼šç»´æŒ<code>--gpu-memory-utilization 0.93</code>çš„æ¿€è¿›ä½†å¯æ§è®¾ç½®</li>
<li><strong>å¼ é‡å¹¶è¡ŒåŒ–</strong>ï¼šä¿æŒ<code>--tensor-parallel-size 4</code>å……åˆ†åˆ©ç”¨æ‰€æœ‰GPU</li>
<li><strong>æ‰¹å¤„ç†æ”¯æŒ</strong>ï¼šæ·»åŠ <code>--max-num-batched-tokens 8192</code>æé«˜ååé‡</li>
</ul>
<h3 id="2-ç¨³å®šæ€§ä¸æ•ˆç‡å¹³è¡¡">2. ç¨³å®šæ€§ä¸æ•ˆç‡å¹³è¡¡</h3>
<ul>
<li><strong>CUDAæ‰§è¡Œæ¨¡å¼</strong>ï¼šæ·»åŠ <code>--enforce-eager</code>å‚æ•°ï¼Œé¿å…CUDAå›¾æ•è·å¯èƒ½å¯¼è‡´çš„OOMé—®é¢˜</li>
<li><strong>äº¤æ¢ç©ºé—´æ”¯æŒ</strong>ï¼šæ·»åŠ <code>--swap-space 32</code>å‚æ•°ï¼Œä¸ºå¤„ç†é•¿ä¸Šä¸‹æ–‡æä¾›é¢å¤–å†…å­˜ä¿éšœ</li>
<li><strong>all-reduceä¼˜åŒ–</strong>ï¼šç§»é™¤<code>--disable-custom-all-reduce</code>å‚æ•°ï¼ˆæ³¨ï¼šæ—¥å¿—æ˜¾ç¤ºç³»ç»Ÿè‡ªåŠ¨ç¦ç”¨ï¼‰</li>
</ul>
<h3 id="3-ä¸Šä¸‹æ–‡é•¿åº¦è®¾è®¡">3. ä¸Šä¸‹æ–‡é•¿åº¦è®¾è®¡</h3>
<p>è™½ç„¶æˆ‘ä»¬æœ€ç»ˆä¿ç•™äº†<code>--max-model-len 65536</code>è®¾ç½®ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”å½“æ ¹æ®å…·ä½“ä½¿ç”¨åœºæ™¯å’Œç¨³å®šæ€§éœ€æ±‚è€ƒè™‘é™è‡³32768ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œè¿™ä¸ªé•¿åº¦å·²ç»è¶³å¤Ÿï¼Œå¹¶ä¸”èƒ½æä¾›æ›´å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§å¹³è¡¡ã€‚</p>
<h2 id="ä¼˜åŒ–åçš„éƒ¨ç½²è„šæœ¬">ä¼˜åŒ–åçš„éƒ¨ç½²è„šæœ¬</h2>
<p>ç»è¿‡ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆéƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --gpus all <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --name coder <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --shm-size 64g <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ulimit memlock<span style="color:#f92672">=</span>-1 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --restart always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ipc<span style="color:#f92672">=</span>host <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 8000:8000 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -e CUDA_MODULE_LOADING<span style="color:#f92672">=</span>LAZY <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  vllm/vllm-openai:v0.8.5 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --model /models <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --served-model-name coder <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --tensor-parallel-size <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --gpu-memory-utilization 0.93 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --dtype float16 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-model-len <span style="color:#ae81ff">65536</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --trust-remote-code <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --load-format safetensors <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --swap-space <span style="color:#ae81ff">32</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --enforce-eager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --max-num-batched-tokens <span style="color:#ae81ff">8192</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --chat-template /models/qwen3_programming.jinja
</span></span></code></pre></div><h2 id="æ€§èƒ½ä¸èµ„æºåˆ†æ">æ€§èƒ½ä¸èµ„æºåˆ†æ</h2>
<p>éƒ¨ç½²åï¼Œé€šè¿‡æ—¥å¿—åˆ†ææˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹æ€§èƒ½æŒ‡æ ‡ï¼š</p>
<pre tabindex="0"><code>Memory profiling takes 5.76 seconds
the current vLLM instance can use total_gpu_memory (21.48GiB) x gpu_memory_utilization (0.93) = 19.98GiB
model weights take 3.85GiB; non_torch_memory takes 0.20GiB; PyTorch activation peak memory takes 1.45GiB; the rest of the memory reserved for KV Cache is 14.49GiB.
</code></pre><p>å…³é”®æ€§èƒ½å‘ç°ï¼š</p>
<ul>
<li><strong>KVç¼“å­˜ç©ºé—´</strong>ï¼š14.49GiBï¼Œè¶³å¤Ÿæ”¯æŒ65536 tokençš„ä¸Šä¸‹æ–‡å¤„ç†</li>
<li><strong>æœ€å¤§å¹¶å‘èƒ½åŠ›</strong>ï¼šå¯åŒæ—¶å¤„ç†çº¦6.44ä¸ªæœ€å¤§é•¿åº¦ï¼ˆ65536 tokensï¼‰çš„è¯·æ±‚</li>
<li><strong>åˆå§‹åŒ–æ—¶é—´</strong>ï¼š31.86ç§’ï¼Œç›¸æ¯”æœªä¼˜åŒ–é…ç½®æœ‰æ‰€æ”¹å–„</li>
</ul>
<h2 id="å®ç”¨éƒ¨ç½²å»ºè®®">å®ç”¨éƒ¨ç½²å»ºè®®</h2>
<p>æ ¹æ®æˆ‘ä»¬çš„å®è·µç»éªŒï¼Œæä¾›ä»¥ä¸‹éƒ¨ç½²å»ºè®®ï¼š</p>
<ol>
<li>
<p><strong>ä¸Šä¸‹æ–‡é•¿åº¦é€‰æ‹©</strong></p>
<ul>
<li>å¯¹äºè¿½æ±‚ç¨³å®šæ€§çš„ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨<code>--max-model-len 32768</code></li>
<li>å¯¹äºéœ€è¦æé™æ€§èƒ½çš„åœºæ™¯ï¼šå¯å°è¯•<code>--max-model-len 65536</code>ä½†éœ€å¯†åˆ‡ç›‘æ§ç¨³å®šæ€§</li>
</ul>
</li>
<li>
<p><strong>æ˜¾å­˜åˆ©ç”¨ç‡è°ƒä¼˜</strong></p>
<ul>
<li>ç¨³å®šæ€§ä¼˜å…ˆï¼š<code>--gpu-memory-utilization 0.9</code></li>
<li>æ€§èƒ½ä¼˜å…ˆï¼š<code>--gpu-memory-utilization 0.93</code>æˆ–æ›´é«˜ï¼ˆéœ€è°¨æ…ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ‰¹å¤„ç†å‚æ•°ä¼˜åŒ–</strong></p>
<ul>
<li>å¯¹äºå¤šç”¨æˆ·åœºæ™¯ï¼šå¢åŠ <code>--max-num-batched-tokens</code>è‡³8192æˆ–æ›´é«˜</li>
<li>å¯¹äºå•ä¸€å¤æ‚ä»»åŠ¡ï¼šå¯é€‚å½“é™ä½æ­¤å‚æ•°ï¼Œä¸“æ³¨å•ä»»åŠ¡æ€§èƒ½</li>
</ul>
</li>
<li>
<p><strong>ç¡¬ä»¶èµ„æºåˆ†é…</strong></p>
<ul>
<li>å…±äº«å†…å­˜ä¸ç³»ç»Ÿå†…å­˜æ¯”ä¾‹ï¼šå»ºè®®1:8å·¦å³ï¼ˆå¦‚512GBç³»ç»Ÿå†…å­˜é…ç½®64GBå…±äº«å†…å­˜ï¼‰</li>
<li>äº¤æ¢ç©ºé—´è®¾ç½®ï¼šæ ¹æ®SSDé€Ÿåº¦å’Œå®¹é‡ï¼Œå¯è®¾ç½®ä¸ºæ˜¾å­˜æ€»é‡çš„1/3è‡³1/2</li>
</ul>
</li>
</ol>
<h2 id="æ’éšœä¸éªŒè¯">æ’éšœä¸éªŒè¯</h2>
<p>æ¯æ¬¡ä¿®æ”¹é…ç½®åï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯éƒ¨ç½²çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:8000/v1/models
</span></span></code></pre></div><p>éªŒè¯ç»“æœæ˜¾ç¤ºæ¨¡å‹å·²æˆåŠŸéƒ¨ç½²ï¼Œå¹¶è¿”å›äº†ä»¥ä¸‹å®é™…è¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;object&#34;</span>: <span style="color:#e6db74">&#34;list&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;data&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;coder&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;object&#34;</span>: <span style="color:#e6db74">&#34;model&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;created&#34;</span>: <span style="color:#ae81ff">1749289780</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;owned_by&#34;</span>: <span style="color:#e6db74">&#34;vllm&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;root&#34;</span>: <span style="color:#e6db74">&#34;/models&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;parent&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;max_model_len&#34;</span>: <span style="color:#ae81ff">65536</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;permission&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;modelperm-ee339bc1702c402f8ae06ea2f1b05c7c&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;object&#34;</span>: <span style="color:#e6db74">&#34;model_permission&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;created&#34;</span>: <span style="color:#ae81ff">1749289780</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_create_engine&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_sampling&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_logprobs&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_search_indices&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_view&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;allow_fine_tuning&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;organization&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;group&#34;</span>: <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;is_blocking&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»è¿”å›çš„JSONå“åº”ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤æ¨¡å‹éƒ¨ç½²æˆåŠŸå¹¶è§£è¯»ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li><strong>id</strong>: &ldquo;coder&rdquo; - ç¡®è®¤æˆ‘ä»¬çš„æ¨¡å‹æœåŠ¡åç§°å·²æ­£ç¡®è®¾ç½®</li>
<li><strong>max_model_len</strong>: 65536 - éªŒè¯äº†æˆ‘ä»¬è®¾ç½®çš„ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸º65536 tokens</li>
<li><strong>owned_by</strong>: &ldquo;vllm&rdquo; - è¡¨æ˜æ¨¡å‹ç”±vLLMæœåŠ¡ç®¡ç†</li>
<li><strong>permission</strong>å¯¹è±¡ä¸­ï¼š
<ul>
<li><strong>allow_sampling</strong>: true - æ”¯æŒé‡‡æ ·ç”Ÿæˆï¼ˆtemperatureã€top_pç­‰å‚æ•°ï¼‰</li>
<li><strong>allow_logprobs</strong>: true - æ”¯æŒè¾“å‡ºtokenæ¦‚ç‡</li>
<li><strong>organization</strong>: &ldquo;*&rdquo; - å…è®¸æ‰€æœ‰ç»„ç»‡è®¿é—®æ¨¡å‹</li>
</ul>
</li>
</ul>
<p>è¿™äº›å‚æ•°ç¡®è®¤äº†æˆ‘ä»¬çš„éƒ¨ç½²é…ç½®å·²ç»æ­£ç¡®åº”ç”¨ï¼Œä¸”æ¨¡å‹æœåŠ¡å·²å‡†å¤‡å¥½æ¥æ”¶æ¨ç†è¯·æ±‚ã€‚</p>
<h2 id="ä¸“ç”¨ç¼–ç¨‹æç¤ºè¯æ¨¡æ¿">ä¸“ç”¨ç¼–ç¨‹æç¤ºè¯æ¨¡æ¿</h2>
<p>ç”±äºDeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ç‰¹åˆ«é€‚åˆç¼–ç¨‹ä»»åŠ¡ï¼Œæˆ‘ä»¬åœ¨éƒ¨ç½²ä¸­åŠ å…¥äº†ä¸“é—¨çš„æç¤ºè¯æ¨¡æ¿æ¥ä¼˜åŒ–å…¶ç¼–ç¨‹èƒ½åŠ›ã€‚æˆ‘ä»¬å·²ç»é€šè¿‡<code>--chat-template</code>å‚æ•°æŒ‡å®šäº†æ¨¡æ¿è·¯å¾„ï¼Œæ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jinja" data-lang="jinja"><span style="display:flex;"><span><span style="color:#75715e">{# Enhanced template for Qwen3 optimized for programming tasks #}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">if</span> messages<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span><span style="color:#e6db74">&#39;role&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;system&#39;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">set</span> loop_messages <span style="color:#f92672">=</span> messages<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:]</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">set</span> system_message <span style="color:#f92672">=</span> messages<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span><span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">else</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">set</span> loop_messages <span style="color:#f92672">=</span> messages <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">set</span> system_message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You are a programming assistant specialized in writing clean, efficient, and well-documented code. Provide direct code solutions without unnecessary explanations unless requested. Focus on best practices, optimal algorithms, and proper error handling. When multiple approaches exist, choose the most efficient one by default. Always include necessary imports and dependencies.&#34;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">endif</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{# Always include system message for programming optimization #}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;system
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> system_message <span style="color:#75715e">}}</span>&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">for</span> message <span style="color:#66d9ef">in</span> loop_messages <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">if</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;role&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;user
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">}}</span>&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">elif</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;role&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;assistant&#39;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;assistant
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">}}</span>&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">elif</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;role&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;tool&#39;</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;tool
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">}}</span>&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">else</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;<span style="color:#75715e">{{</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;role&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> message<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">]</span> <span style="color:#75715e">}}</span>&lt;|im_end|&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{%</span> <span style="color:#66d9ef">endif</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">endfor</span> <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">if</span> add_generation_prompt <span style="color:#75715e">%}</span>
</span></span><span style="display:flex;"><span>&lt;|im_start|&gt;assistant
</span></span><span style="display:flex;"><span><span style="color:#75715e">{%</span> <span style="color:#66d9ef">endif</span> <span style="color:#75715e">%}</span>
</span></span></code></pre></div><p>æ­¤æ¨¡æ¿å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li><strong>ä¸“ä¸šç¼–ç¨‹æŒ‡ä»¤</strong>ï¼šé»˜è®¤ç³»ç»Ÿæç¤ºè¯ä¸“é—¨é’ˆå¯¹ç¼–ç¨‹ä»»åŠ¡ä¼˜åŒ–ï¼Œå¼ºè°ƒä»£ç è´¨é‡ã€æ•ˆç‡å’Œæ–‡æ¡£</li>
<li><strong>ç›´æ¥è¾“å‡º</strong>ï¼šå€¾å‘äºç›´æ¥æä¾›ä»£ç è§£å†³æ–¹æ¡ˆï¼Œå‡å°‘ä¸å¿…è¦çš„è§£é‡Šï¼ˆé™¤éç‰¹åˆ«è¦æ±‚ï¼‰</li>
<li><strong>æ ‡å‡†åŒ–æ ¼å¼</strong>ï¼šä½¿ç”¨<code>&lt;|im_start|&gt;</code>å’Œ<code>&lt;|im_end|&gt;</code>æ ‡è®°æ¸…æ™°ç•Œå®šä¸åŒè§’è‰²çš„æ¶ˆæ¯</li>
<li><strong>çµæ´»æ€§</strong>ï¼šå…è®¸è¦†ç›–é»˜è®¤ç³»ç»Ÿæç¤ºè¯ï¼Œä»¥é€‚åº”ç‰¹å®šç¼–ç¨‹åœºæ™¯</li>
</ol>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¯ä»¥å°†è¯¥æ¨¡æ¿ä¸vLLMçš„APIè°ƒç”¨ç»“åˆï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost:8000/v1/chat/completions&#34;</span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;model&#34;</span>: <span style="color:#e6db74">&#34;coder&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;messages&#34;</span>: [
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;å†™ä¸€ä¸ªPythonå‡½æ•°è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç¬¬né¡¹ï¼Œè¦æ±‚ä½¿ç”¨åŠ¨æ€è§„åˆ’ä¼˜åŒ–æ€§èƒ½&#34;</span>}
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;temperature&#34;</span>: <span style="color:#ae81ff">0.2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;response_format&#34;</span>: {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url, headers<span style="color:#f92672">=</span>headers, json<span style="color:#f92672">=</span>payload)
</span></span><span style="display:flex;"><span>print(response<span style="color:#f92672">.</span>json())
</span></span></code></pre></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†å‘æŒ¥æ¨¡å‹åœ¨ç¼–ç¨‹é¢†åŸŸçš„ä¸“é•¿ï¼Œè·å¾—æ›´é«˜è´¨é‡ã€æ›´ç¬¦åˆå·¥ç¨‹å®è·µçš„ä»£ç è¾“å‡ºã€‚</p>
<h2 id="ç»“è®ºä¸æœªæ¥æ–¹å‘">ç»“è®ºä¸æœªæ¥æ–¹å‘</h2>
<p>é€šè¿‡ç²¾å¿ƒè°ƒæ•´vLLMå‚æ•°ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹çš„é«˜æ•ˆéƒ¨ç½²ï¼Œåœ¨æœ‰é™çš„RTX 2080 Tiæ˜¾å¡ä¸Šå®ç°äº†æœ€å¤§åŒ–çš„æ€§èƒ½å’Œä¸Šä¸‹æ–‡é•¿åº¦ã€‚</p>
<p>æœªæ¥çš„ä¼˜åŒ–æ–¹å‘å¯ä»¥æ¢ç´¢ï¼š</p>
<ol>
<li><strong>è¿›ä¸€æ­¥é‡åŒ–ç ”ç©¶</strong>ï¼šæ¢ç´¢int8é‡åŒ–å¯¹æ€§èƒ½å’Œè´¨é‡çš„å½±å“</li>
<li><strong>è°ƒåº¦ç­–ç•¥ä¼˜åŒ–</strong>ï¼šé€šè¿‡<code>--scheduler-delay-factor</code>å’Œ<code>--preemption-mode</code>å‚æ•°ä¼˜åŒ–å¤šç”¨æˆ·åœºæ™¯</li>
<li><strong>è‡ªåŠ¨æ‰©ç¼©å®¹æ–¹æ¡ˆ</strong>ï¼šæ ¹æ®è´Ÿè½½åŠ¨æ€è°ƒæ•´GPUåˆ†é…</li>
</ol>
<p>å¸Œæœ›è¿™ä»½éƒ¨ç½²ä¼˜åŒ–å®è·µèƒ½ä¸ºæ›´å¤šå·¥ç¨‹å¸ˆæä¾›å‚è€ƒï¼Œåœ¨å¤§æ¨¡å‹éƒ¨ç½²ä¸­æ‰¾åˆ°æ€§èƒ½ä¸ç¨³å®šæ€§çš„æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ol>
<li><a href="https://docs.vllm.ai/">vLLMå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://github.com/QwenLM/Qwen">Qwen3ç³»åˆ—æ¨¡å‹è¯´æ˜</a></li>
<li><a href="https://github.com/deepseek-ai">DeepSeek R1æ¨¡å‹ç³»åˆ—ä»‹ç»</a></li>
</ol>
]]></content:encoded></item><item><title>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/</link><pubDate>Wed, 04 Jun 2025 14:30:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/</guid><description>&lt;h1 id="qwen3-30b-æŠ€æœ¯ä¼˜åŒ–å®è·µäºŒæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡">Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡&lt;/h1>
&lt;blockquote>
&lt;p>æœ¬æ–‡æ˜¯&lt;a href="blog-post.md">ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹&lt;/a>çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚&lt;/p>&lt;/blockquote>
&lt;p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼š&lt;strong>æ€è€ƒæ¨¡å¼æ§åˆ¶&lt;/strong>åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚&lt;/p>
&lt;h2 id="-æ€è€ƒæ¨¡å¼reasoning-modeè§£æ">ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ&lt;/h2>
&lt;h3 id="ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼">ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ&lt;/h3>
&lt;p>æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨&lt;code>&amp;lt;think&amp;gt;...&amp;lt;/think&amp;gt;&lt;/code>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§&amp;quot;æ€è€ƒè¿‡ç¨‹&amp;quot;æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚&lt;/p>
&lt;p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;think&amp;gt;
é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚
æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚
åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š
1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰
2. è¯»å–æˆ–å†™å…¥å†…å®¹
3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­
&amp;lt;/think&amp;gt;
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š
```python
# å†™å…¥æ–‡ä»¶
with open(&amp;#39;example.txt&amp;#39;, &amp;#39;w&amp;#39;) as file:
file.write(&amp;#39;Hello, World!&amp;#39;)
# è¯»å–æ–‡ä»¶
with open(&amp;#39;example.txt&amp;#39;, &amp;#39;r&amp;#39;) as file:
content = file.read()
print(content)
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>
### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶
vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š
1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨
2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶
æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚
## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç°
### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ
ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š
```jinja
{% if messages %}
{% set loop_messages = messages %}
{% else %}
{% set loop_messages = [{&amp;#39;role&amp;#39;: &amp;#39;system&amp;#39;, &amp;#39;content&amp;#39;: &amp;#39;&amp;#39;}] %}
{% endif %}
{% for message in loop_messages %}
{% if message[&amp;#39;role&amp;#39;] == &amp;#39;user&amp;#39; %}
&amp;lt;|im_start|&amp;gt;user
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% elif message[&amp;#39;role&amp;#39;] == &amp;#39;assistant&amp;#39; %}
&amp;lt;|im_start|&amp;gt;assistant
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% elif message[&amp;#39;role&amp;#39;] == &amp;#39;system&amp;#39; %}
&amp;lt;|im_start|&amp;gt;system
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% endif %}
{% endfor %}
&amp;lt;|im_start|&amp;gt;assistant
{% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %}
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯&lt;strong>ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘&lt;/strong>ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ&lt;code>&amp;lt;think&amp;gt;...&amp;lt;/think&amp;gt;&lt;/code>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚&lt;/p></description><content:encoded><![CDATA[<h1 id="qwen3-30b-æŠ€æœ¯ä¼˜åŒ–å®è·µäºŒæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡">Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡</h1>
<blockquote>
<p>æœ¬æ–‡æ˜¯<a href="blog-post.md">ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹</a>çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚</p></blockquote>
<p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼š<strong>æ€è€ƒæ¨¡å¼æ§åˆ¶</strong>åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚</p>
<h2 id="-æ€è€ƒæ¨¡å¼reasoning-modeè§£æ">ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ</h2>
<h3 id="ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼">ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ</h3>
<p>æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨<code>&lt;think&gt;...&lt;/think&gt;</code>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§&quot;æ€è€ƒè¿‡ç¨‹&quot;æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚</p>
<p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>&lt;think&gt;
é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚
æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚
åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š
1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰
2. è¯»å–æˆ–å†™å…¥å†…å®¹
3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­
&lt;/think&gt;

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š

```python
# å†™å…¥æ–‡ä»¶
with open(&#39;example.txt&#39;, &#39;w&#39;) as file:
    file.write(&#39;Hello, World!&#39;)

# è¯»å–æ–‡ä»¶
with open(&#39;example.txt&#39;, &#39;r&#39;) as file:
    content = file.read()
    print(content)
</code></pre><pre tabindex="0"><code>
### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶

vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š

1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨
   
2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶

æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚

## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç°

### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ

ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š

```jinja
{% if messages %}
{% set loop_messages = messages %}
{% else %}
{% set loop_messages = [{&#39;role&#39;: &#39;system&#39;, &#39;content&#39;: &#39;&#39;}] %}
{% endif %}

{% for message in loop_messages %}
{% if message[&#39;role&#39;] == &#39;user&#39; %}
&lt;|im_start|&gt;user
{{ message[&#39;content&#39;] }}&lt;|im_end|&gt;
{% elif message[&#39;role&#39;] == &#39;assistant&#39; %}
&lt;|im_start|&gt;assistant
{{ message[&#39;content&#39;] }}&lt;|im_end|&gt;
{% elif message[&#39;role&#39;] == &#39;system&#39; %}
&lt;|im_start|&gt;system
{{ message[&#39;content&#39;] }}&lt;|im_end|&gt;
{% endif %}
{% endfor %}
&lt;|im_start|&gt;assistant
{% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %}
</code></pre><p>è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯<strong>ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘</strong>ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ<code>&lt;think&gt;...&lt;/think&gt;</code>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚</p>
<h3 id="éƒ¨ç½²è„šæœ¬ä¿®æ”¹">éƒ¨ç½²è„šæœ¬ä¿®æ”¹</h3>
<p>ä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†éƒ¨ç½²è„šæœ¬ï¼Œæ·»åŠ äº†ä»¥ä¸‹å…³é”®å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># é‡è¦ï¼š1. æŒ‚è½½å·¥ä½œç›®å½•ä½¿æ¨¡æ¿æ–‡ä»¶å¯è®¿é—®</span>
</span></span><span style="display:flex;"><span>-v /home/llm/workspace/deploy-qwen:/workspace/deploy-qwen <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é‡è¦ï¼š2. ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿å½»åº•ç¦ç”¨æ€è€ƒæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>--chat-template /workspace/deploy-qwen/qwen3_nonthinking.jinja
</span></span></code></pre></div><p>åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨è„šæœ¬ä¸­æ·»åŠ äº†è¯¦ç»†æ³¨é‡Šï¼Œä¾¿äºåœ¨ä¸åŒåœºæ™¯ä¸‹å¿«é€Ÿåˆ‡æ¢æ¨¡å¼ã€‚</p>
<h2 id="-æ€§èƒ½æå‡æµ‹é‡ä¸åˆ†æ">ğŸ“Š æ€§èƒ½æå‡æµ‹é‡ä¸åˆ†æ</h2>
<h3 id="å®æµ‹æ€§èƒ½æ•°æ®">å®æµ‹æ€§èƒ½æ•°æ®</h3>
<p>æˆ‘ä»¬é€šè¿‡å®é™…éƒ¨ç½²æµ‹è¯•ï¼Œè§‚å¯Ÿåˆ°ç¦ç”¨æ€è€ƒæ¨¡å¼å¸¦æ¥çš„æ€§èƒ½æå‡ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æŒ‡æ ‡</th>
          <th>å¯ç”¨æ€è€ƒæ¨¡å¼</th>
          <th>ç¦ç”¨æ€è€ƒæ¨¡å¼</th>
          <th>æå‡æ¯”ä¾‹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ç”Ÿæˆé€Ÿåº¦</td>
          <td>~12-14 tokens/s</td>
          <td>~17-19 tokens/s</td>
          <td>+15-20%</td>
      </tr>
      <tr>
          <td>GPU KVç¼“å­˜ä½¿ç”¨ç‡</td>
          <td>~12-15%</td>
          <td>~8-9%</td>
          <td>-30-40%</td>
      </tr>
      <tr>
          <td>å†…å­˜å ç”¨</td>
          <td>è¾ƒé«˜</td>
          <td>è¾ƒä½</td>
          <td>-20-25%</td>
      </tr>
      <tr>
          <td>è¾“å‡ºä¸€è‡´æ€§</td>
          <td>å‡ºç°æ¨ç†è¿‡ç¨‹</td>
          <td>ç›´æ¥è¾“å‡ºç»“æœ</td>
          <td>æ›´åŠ ç®€æ´</td>
      </tr>
  </tbody>
</table>
<p>ä¸€ä¸ªå…¸å‹çš„æ€§èƒ½æ—¥å¿—ç‰‡æ®µæ˜¾ç¤ºï¼š</p>
<pre tabindex="0"><code>INFO 06-03 23:06:14 [metrics.py:486] Avg prompt throughput: 2315.5 tokens/s, Avg generation throughput: 12.4 tokens/s, Running: 2 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 8.7%, CPU KV cache usage: 0.0%.
INFO 06-03 23:06:19 [metrics.py:486] Avg prompt throughput: 506.3 tokens/s, Avg generation throughput: 17.4 tokens/s, Running: 2 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 8.7%, CPU KV cache usage: 0.0%.
</code></pre><h3 id="æ€§èƒ½æå‡åŸç†åˆ†æ">æ€§èƒ½æå‡åŸç†åˆ†æ</h3>
<p>ç¦ç”¨æ€è€ƒæ¨¡å¼å¸¦æ¥æ€§èƒ½æå‡çš„ä¸»è¦åŸå› åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p><strong>è®¡ç®—è´Ÿè½½å‡å°‘</strong>ï¼šä¸å†ç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œå‡å°‘äº†æ€»ä½“éœ€è¦ç”Ÿæˆçš„tokenæ•°é‡</p>
</li>
<li>
<p><strong>æ³¨æ„åŠ›è®¡ç®—ç®€åŒ–</strong>ï¼šæ¨ç†è¿‡ç¨‹é€šå¸¸éœ€è¦æ¨¡å‹åœ¨æ›´å¤§çš„ä¸Šä¸‹æ–‡çª—å£ä¸­è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ï¼Œç¦ç”¨åæ³¨æ„åŠ›æœºåˆ¶æ›´èšç„¦</p>
</li>
<li>
<p><strong>å†…å­˜ä½¿ç”¨ä¼˜åŒ–</strong>ï¼šæ— éœ€ä¸ºæ€è€ƒè¿‡ç¨‹åˆ†é…é¢å¤–çš„KVç¼“å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨131Kè¶…é•¿ä¸Šä¸‹æ–‡æ¨¡å¼ä¸‹ï¼Œè¿™ä¸€ä¼˜åŠ¿æ›´ä¸ºæ˜¾è‘—</p>
</li>
<li>
<p><strong>å†…éƒ¨çŠ¶æ€è·Ÿè¸ªç®€åŒ–</strong>ï¼šæ¨¡å‹ä¸å†éœ€è¦ç»´æŠ¤å’Œç®¡ç†é¢å¤–çš„æ€è€ƒçŠ¶æ€ï¼Œå‡å°‘äº†å†…éƒ¨çŠ¶æ€è½¬æ¢çš„å¤æ‚åº¦</p>
</li>
</ol>
<h2 id="-é€‚ç”¨åœºæ™¯ä¸å‚æ•°è°ƒä¼˜">ğŸ”§ é€‚ç”¨åœºæ™¯ä¸å‚æ•°è°ƒä¼˜</h2>
<h3 id="æœ€é€‚åˆç¦ç”¨æ€è€ƒæ¨¡å¼çš„åœºæ™¯">æœ€é€‚åˆç¦ç”¨æ€è€ƒæ¨¡å¼çš„åœºæ™¯</h3>
<ol>
<li><strong>ä»£ç ç”Ÿæˆä»»åŠ¡</strong>ï¼šç›´æ¥è¾“å‡ºä»£ç è€Œéè¯¦ç»†è§£é‡Šè¿‡ç¨‹</li>
<li><strong>ç®€æ´é—®ç­”</strong>ï¼šéœ€è¦ç®€çŸ­ç›´æ¥ç­”æ¡ˆçš„åœºæ™¯</li>
<li><strong>APIé›†æˆ</strong>ï¼šä½œä¸ºåç«¯æœåŠ¡é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿæ—¶</li>
<li><strong>é«˜å¹¶å‘æœåŠ¡</strong>ï¼šéœ€è¦å¤„ç†å¤§é‡è¯·æ±‚æ—¶</li>
<li><strong>å†…å­˜å—é™ç¯å¢ƒ</strong>ï¼šç¡¬ä»¶èµ„æºç›¸å¯¹æœ‰é™æ—¶</li>
</ol>
<h3 id="ç¼–ç¨‹ä»»åŠ¡æœ€ä½³å‚æ•°ç»„åˆ">ç¼–ç¨‹ä»»åŠ¡æœ€ä½³å‚æ•°ç»„åˆ</h3>
<p>åŸºäºæˆ‘ä»¬çš„æµ‹è¯•ï¼Œç¦ç”¨æ€è€ƒæ¨¡å¼åï¼Œç¼–ç¨‹ä»»åŠ¡æ¨èä»¥ä¸‹å‚æ•°è®¾ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;temperature&#34;</span>: <span style="color:#ae81ff">0.2</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;top_p&#34;</span>: <span style="color:#ae81ff">0.6</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;top_k&#34;</span>: <span style="color:#ae81ff">50</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;presence_penalty&#34;</span>: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;frequency_penalty&#34;</span>: <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¿™ç»„å‚æ•°æä¾›äº†é«˜ç¡®å®šæ€§å’Œä¸€è‡´æ€§ï¼Œä½¿ç¼–ç è¾“å‡ºæ›´å¯é ã€‚</p>
<h2 id="-æ¨¡å¼åˆ‡æ¢æ–¹æ³•">ğŸ”„ æ¨¡å¼åˆ‡æ¢æ–¹æ³•</h2>
<p>æˆ‘ä»¬åœ¨éƒ¨ç½²è„šæœ¬ä¸­æä¾›äº†è¯¦ç»†çš„åˆ‡æ¢æŒ‡å—ï¼š</p>
<h3 id="ä¿æŒç¦ç”¨æ€è€ƒæ¨¡å¼é»˜è®¤é…ç½®">ä¿æŒç¦ç”¨æ€è€ƒæ¨¡å¼ï¼ˆé»˜è®¤é…ç½®ï¼‰</h3>
<ul>
<li>ä¿ç•™<code>--chat-template</code>å‚æ•°</li>
<li>åˆ é™¤<code>--enable-reasoning</code>å’Œ<code>--reasoning-parser</code>å‚æ•°</li>
</ul>
<h3 id="å¯ç”¨æ€è€ƒæ¨¡å¼">å¯ç”¨æ€è€ƒæ¨¡å¼</h3>
<ul>
<li>åˆ é™¤<code>--chat-template</code>å‚æ•°</li>
<li>æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>--enable-reasoning <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--reasoning-parser deepseek_r1
</span></span></code></pre></div></li>
</ul>
<h3 id="åº”ç”¨æ›´æ”¹">åº”ç”¨æ›´æ”¹</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker stop coder <span style="color:#f92672">&amp;&amp;</span> docker rm coder <span style="color:#f92672">&amp;&amp;</span> ./deploy-32k.sh  <span style="color:#75715e"># æˆ– ./deploy-131k.sh</span>
</span></span></code></pre></div><h2 id="-ä¸yarnæ‰©å±•çš„ååŒä¼˜åŒ–">ğŸ§© ä¸YaRNæ‰©å±•çš„ååŒä¼˜åŒ–</h2>
<p>ç¦ç”¨æ€è€ƒæ¨¡å¼ä¸YaRNä¸Šä¸‹æ–‡æ‰©å±•æŠ€æœ¯ç»“åˆä½¿ç”¨æ—¶ï¼Œèƒ½å¸¦æ¥æ›´å…¨é¢çš„æ€§èƒ½å’Œèƒ½åŠ›æå‡ï¼š</p>
<ol>
<li>
<p><strong>å†…å­˜æ•ˆç‡å€å¢</strong>ï¼šåœ¨è¶…é•¿ä¸Šä¸‹æ–‡åœºæ™¯ä¸‹ï¼Œç¦ç”¨æ€è€ƒæ¨¡å¼èƒ½æ˜¾è‘—é™ä½YaRNæ‰©å±•å¸¦æ¥çš„é¢å¤–å†…å­˜å‹åŠ›</p>
</li>
<li>
<p><strong>æ‰©å±•æ½œåŠ›æé«˜</strong>ï¼šç†è®ºä¸Šï¼Œé€šè¿‡ç¦ç”¨æ€è€ƒæ¨¡å¼ï¼ŒYaRNå› å­å¯ä»¥è¿›ä¸€æ­¥æé«˜ï¼ˆä¾‹å¦‚ä»4.0åˆ°4.5æˆ–æ›´é«˜ï¼‰ï¼Œå®ç°æ›´é•¿ä¸Šä¸‹æ–‡</p>
</li>
<li>
<p><strong>å“åº”é€Ÿåº¦æå‡</strong>ï¼šç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹ä»£ç åº“æˆ–é•¿æ–‡æ¡£æ—¶ï¼Œç¦ç”¨æ€è€ƒæ¨¡å¼æä¾›äº†æ›´å¿«çš„tokenç”Ÿæˆé€Ÿåº¦</p>
</li>
</ol>
<h2 id="-æœªæ¥ä¼˜åŒ–æ–¹å‘">ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘</h2>
<p>åŸºäºæˆ‘ä»¬çš„ç»éªŒï¼Œæ¨èä»¥ä¸‹ä¼˜åŒ–æ–¹å‘è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼š</p>
<ol>
<li>
<p><strong>å¯å‘å¼è·¯ç”±</strong>ï¼šæ„å»ºæ™ºèƒ½è·¯ç”±å±‚ï¼Œæ ¹æ®è¾“å…¥ç±»å‹è‡ªåŠ¨é€‰æ‹©å¯ç”¨æˆ–ç¦ç”¨æ€è€ƒæ¨¡å¼</p>
</li>
<li>
<p><strong>åœºæ™¯è‡ªé€‚åº”</strong>ï¼šå¼€å‘èƒ½æ ¹æ®è¾“å…¥åŠ¨æ€è°ƒæ•´æ€è€ƒæ¨¡å¼çš„æ··åˆç­–ç•¥</p>
</li>
<li>
<p><strong>Promptå·¥ç¨‹ä¼˜åŒ–</strong>ï¼šç ”ç©¶ç‰¹å®špromptæ¨¡å¼ï¼Œåœ¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„åŒæ—¶ä¿æŒé«˜è´¨é‡æ¨ç†èƒ½åŠ›</p>
</li>
<li>
<p><strong>é‡åŒ–ä¸æ€è€ƒæ¨¡å¼ååŒä¼˜åŒ–</strong>ï¼šæ¢ç´¢å°†4ä½æˆ–8ä½é‡åŒ–ä¸æ€è€ƒæ¨¡å¼ç¦ç”¨ç»“åˆï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½</p>
</li>
</ol>
<h2 id="-ç»“è®º">ğŸ ç»“è®º</h2>
<p>é€šè¿‡æ·±å…¥ç ”ç©¶å’Œå®è·µï¼Œæˆ‘ä»¬è¯æ˜äº†å¯¹Qwen3-30Bæ¨¡å‹æ€è€ƒæ¨¡å¼çš„æ§åˆ¶æ˜¯ä¸€ç§æ•ˆæœæ˜¾è‘—çš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ã€‚ç¦ç”¨æ€è€ƒæ¨¡å¼èƒ½å¸¦æ¥15-20%çš„é€Ÿåº¦æå‡å’Œæ›´é«˜çš„å†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹ä»»åŠ¡å’Œéœ€è¦ç›´æ¥è¾“å‡ºçš„åœºæ™¯ã€‚</p>
<p>è¿™ç§æŠ€æœ¯ä¸éœ€è¦æ¨¡å‹å¾®è°ƒæˆ–å¤æ‚çš„GPUä¼˜åŒ–ï¼Œä»…é€šè¿‡æ¨¡æ¿å’Œé…ç½®ä¿®æ”¹å°±èƒ½å®ç°ï¼Œæ˜¯ä¸€ç§ä½æˆæœ¬ã€é«˜æ”¶ç›Šçš„ä¼˜åŒ–æ–¹æ¡ˆã€‚ç»“åˆYaRNä¸Šä¸‹æ–‡æ‰©å±•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»ºä¸€ä¸ªå…¼å…·é«˜æ€§èƒ½å’Œå¼ºå¤§èƒ½åŠ›çš„å¤§æ¨¡å‹æœåŠ¡ã€‚</p>
<hr>
<blockquote>
<p>ä½œè€…è¯´æ˜ï¼šæœ¬æ–‡æ‰€æœ‰æµ‹è¯•å‡åŸºäºQwen3-30B-A3Bæ¨¡å‹åœ¨4Ã—NVIDIA GPUä¸Šä½¿ç”¨vLLM v0.8.5è¿›è¡Œï¼Œå…·ä½“ç¡¬ä»¶ç¯å¢ƒä¸º4Ã—GPU(æ¯å¡22GB VRAM)ï¼Œ512GB RAMï¼Œ56æ ¸CPUï¼Œ2TB SSDã€‚å®é™…æ€§èƒ½å¯èƒ½å› ç¡¬ä»¶é…ç½®ã€æ¨¡å‹ç‰ˆæœ¬å’Œå·¥ä½œè´Ÿè½½ç‰¹æ€§è€Œæœ‰æ‰€ä¸åŒã€‚</p></blockquote>
]]></content:encoded></item></channel></rss>