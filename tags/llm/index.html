<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LLM | AI é¿éš¾æ‰€</title><meta name=keywords content><meta name=description content><meta name=author content="Jacky Pan"><link rel=canonical href=https://jackypanster.github.io/ai-stream/tags/llm/><link crossorigin=anonymous href=/ai-stream/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://jackypanster.github.io/ai-stream/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jackypanster.github.io/ai-stream/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jackypanster.github.io/ai-stream/favicon-32x32.png><link rel=apple-touch-icon href=https://jackypanster.github.io/ai-stream/apple-touch-icon.png><link rel=mask-icon href=https://jackypanster.github.io/ai-stream/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://jackypanster.github.io/ai-stream/tags/llm/index.xml><link rel=alternate hreflang=en href=https://jackypanster.github.io/ai-stream/tags/llm/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jackypanster.github.io/ai-stream/tags/llm/"><meta property="og:site_name" content="AI é¿éš¾æ‰€"><meta property="og:title" content="LLM"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="LLM"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jackypanster.github.io/ai-stream/ accesskey=h title="AI é¿éš¾æ‰€ (Alt + H)">AI é¿éš¾æ‰€</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jackypanster.github.io/ai-stream/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://jackypanster.github.io/ai-stream/>Home</a>&nbsp;Â»&nbsp;<a href=https://jackypanster.github.io/ai-stream/tags/>Tags</a></div><h1>LLM
<a href=/ai-stream/tags/llm/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ä»å•å¡ç“¶é¢ˆåˆ°å››å¡é½é£ï¼šä¸€æ¬¡å®Œæ•´çš„Ollamaå¤šGPUæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–å®æˆ˜</h2></header><div class=entry-content><p>å‰è¨€ æœåŠ¡å™¨ï¼š4å—NVIDIA RTX 2080 Tiï¼Œæ¯å¼ æ‹¥æœ‰22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBçš„VRAMã€‚ç›®æ ‡ï¼šè®©Ollamaåœ¨è¿™å°æœºå™¨ä¸Šç«åŠ›å…¨å¼€ï¼Œä¸ºå¤§è¯­è¨€æ¨¡å‹æä¾›å¼ºåŠ²çš„æ¨ç†æœåŠ¡ã€‚
ç„¶è€Œï¼Œæœ€åˆçš„æƒ³æ³•â€”â€”â€œå¦‚ä½•ç”¨å…‰æ‰€æœ‰æ˜¾å­˜ï¼Ÿâ€â€”â€”å¾ˆå¿«è¢«è¯æ˜æ˜¯ä¸€ä¸ªè¯¯åŒºã€‚çœŸæ­£çš„ç›®æ ‡åº”è¯¥æ˜¯ï¼šå¦‚ä½•æœ€é«˜æ•ˆåœ°åˆ©ç”¨æ‰€æœ‰GPUèµ„æºï¼Œå®ç°æœ€å¤§çš„ååé‡å’Œæœ€ä½çš„å»¶è¿Ÿï¼Ÿ
æœ¬æ–‡å°†å®Œæ•´è®°å½•ä»æœ€åˆçš„é…ç½®æ¢ç´¢ï¼Œåˆ°å‘ç°å¹¶è§£å†³æ€§èƒ½ç“¶é¢ˆï¼Œå†åˆ°æœ€ç»ˆæ­å»ºèµ·ä¸€ä¸ªå¥å£®çš„4-GPUè´Ÿè½½å‡è¡¡æœåŠ¡é›†ç¾¤çš„å…¨è¿‡ç¨‹ã€‚è¿™ä¸ä»…æ˜¯ä¸€ä»½æ“ä½œæŒ‡å—ï¼Œæ›´æ˜¯ä¸€æ¬¡å……æ»¡æ´è§çš„æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…ã€‚
ç¬¬ä¸€ç« ï¼šåˆæ¢é…ç½®ï¼Œå•å¡è¿è¡Œçš„â€œçœŸç›¸â€ é¦–å…ˆï¼Œç¡®è®¤ç¡¬ä»¶å·²è¢«ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ã€‚
$ nvidia-smi -L GPU 0: NVIDIA GeForce RTX 2080 Ti (UUID: GPU-b5040762-a75e-f78a-87eb-d288e4725f64) GPU 1: NVIDIA GeForce RTX 2080 Ti (UUID: GPU-651b0fe5-cdad-1851-df5d-e122f85ff10c) GPU 2: NVIDIA GeForce RTX 2080 Ti (UUID: GPU-7674114f-1e22-374d-982f-7446da0ce35f) GPU 3: NVIDIA GeForce RTX 2080 Ti (UUID: GPU-04eaff5d-28e2-94f3-3dd6-c0985dfdad24) å››å¼ å¡éƒ½åœ¨ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚é€šè¿‡systemdæ¥ç®¡ç†OllamaæœåŠ¡ï¼Œå¹¶è®©å®ƒèƒ½â€œçœ‹åˆ°â€æ‰€æœ‰GPUã€‚
sudo systemctl edit ollama.service åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®äº†ä»¥ä¸‹å…³é”®ç¯å¢ƒå˜é‡ï¼š
[Service] Environment="OLLAMA_HOST=0.0.0.0:9000" Environment="CUDA_VISIBLE_DEVICES=0,1,2,3" # å…¶ä»–æ€§èƒ½ç›¸å…³é…ç½®... é‡å¯æœåŠ¡åï¼Œè¿è¡Œäº†ä¸€ä¸ªçº¦7.5GBçš„gemma3næ¨¡å‹ã€‚é€šè¿‡nvidia-smiè§‚å¯Ÿï¼Œä¸€ä¸ªå…³é”®ç°è±¡å‡ºç°äº†ï¼šåªæœ‰ä¸€å—GPUçš„æ˜¾å­˜è¢«å ç”¨äº†ï¼
ç»“è®ºä¸€ï¼šOllamaè¶³å¤Ÿæ™ºèƒ½ã€‚ å¯¹äºè¿œå°äºå•å¡æ˜¾å­˜çš„æ¨¡å‹ï¼Œå®ƒä¼šä¼˜å…ˆåœ¨å•å¼ å¡å†…å®Œæˆæ‰€æœ‰è®¡ç®—ï¼Œä»¥é¿å…è·¨GPUé€šä¿¡å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚è¿™æ˜¯æœ€é«˜æ•ˆçš„åšæ³•ï¼Œä¹Ÿæ‰“ç ´äº†â€œå¿…é¡»ç”¨å…‰æ‰€æœ‰æ˜¾å­˜â€çš„è¿·æ€ã€‚
ç¬¬äºŒç« ï¼šå‹åŠ›æµ‹è¯•ï¼Œæ­å¼€è½¯ä»¶ç“¶é¢ˆçš„é¢çº± æ—¢ç„¶æ˜¯å•å¡åœ¨å·¥ä½œï¼Œé‚£å®ƒçš„æ€§èƒ½æé™åœ¨å“ªé‡Œï¼Ÿç¼–å†™äº†ä¸€ä¸ªPythonå¼‚æ­¥å‹æµ‹è„šæœ¬ï¼Œæ¨¡æ‹Ÿå¤šä¸ªå¹¶å‘ç”¨æˆ·ã€‚
å‹æµ‹è„šæœ¬ benchmark.py (æ ¸å¿ƒé€»è¾‘): ä½¿ç”¨asyncioå’Œaiohttpåº“ï¼Œåˆ›å»ºå¤šä¸ªå¹¶å‘çš„workerï¼Œå‘Ollamaçš„/api/generateæµå¼ç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œå¹¶æ”¶é›†æˆåŠŸç‡ã€é¦–å­—å“åº”æ—¶é—´ï¼ˆTTFTï¼‰å’Œååé‡ï¼ˆTPSï¼‰ç­‰æŒ‡æ ‡ã€‚
å¯¹å½“å‰é…ç½®ï¼ˆOLLAMA_NUM_PARALLEL=4ï¼‰è¿›è¡Œäº†æµ‹è¯•ã€‚
å¹¶å‘ç”¨æˆ·æ•° å¹³å‡é¦–å­—å“åº” (TTFT) æ•´ä½“æœåŠ¡ååé‡ (TPS) 5 4.4 ç§’ 89.06 tokens/ç§’ 10 13.5 ç§’ 105.71 tokens/ç§’ 20 36.7 ç§’ 104.73 tokens/ç§’ ç»“æœè§¦ç›®æƒŠå¿ƒï¼
...</p></div><footer class=entry-footer><span title='2025-07-09 00:00:00 +0000 UTC'>July 9, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;288 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to ä»å•å¡ç“¶é¢ˆåˆ°å››å¡é½é£ï¼šä¸€æ¬¡å®Œæ•´çš„Ollamaå¤šGPUæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–å®æˆ˜" href=https://jackypanster.github.io/ai-stream/posts/the-ultimate-guide-to-multi-gpu-ollama-deployment/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>ä¸ºä»€ä¹ˆé€‰æ‹©Gemini 2.5 Flashé©±åŠ¨K8s MCP Agentï¼šæ·±åº¦æŠ€æœ¯é€‰å‹åˆ†æ</h2></header><div class=entry-content><p>æœ¬æ–‡æ·±å…¥åˆ†æä¸ºä»€ä¹ˆé€‰æ‹©Google Gemini 2.5 Flashä½œä¸ºK8s MCP Agentçš„æ ¸å¿ƒLLMï¼Œè¯¦ç»†é˜è¿°æŠ€æœ¯é€‰å‹èƒŒåçš„æ·±å±‚è€ƒé‡ï¼ŒåŒ…æ‹¬MCPå·¥å…·è°ƒç”¨å…¼å®¹æ€§ã€å¤§ä¸Šä¸‹æ–‡èƒ½åŠ›ã€fail-fastæ¶æ„è®¾è®¡ç­‰å…³é”®å› ç´ ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-18 00:00:00 +0000 UTC'>June 18, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;798 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to ä¸ºä»€ä¹ˆé€‰æ‹©Gemini 2.5 Flashé©±åŠ¨K8s MCP Agentï¼šæ·±åº¦æŠ€æœ¯é€‰å‹åˆ†æ" href=https://jackypanster.github.io/ai-stream/posts/gemini-2.5-flash-mcp-tech-selection/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–</h2></header><div class=entry-content><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ vLLM é«˜æ•ˆéƒ¨ç½² Qwen3-32B-AWQ é‡åŒ–æ¨¡å‹ï¼Œå®ç° 32K ä¸Šä¸‹æ–‡çª—å£ã€OpenAI å…¼å®¹ APIï¼Œå¹¶ç¦ç”¨æ€è€ƒæ¨¡å¼ã€‚é€šè¿‡å¯¹ Docker åŠ vLLM å‚æ•°çš„ç²¾ç»†è°ƒä¼˜ï¼Œæœ€å¤§åŒ–æ¨¡å‹åœ¨å¤š GPU ç¯å¢ƒä¸‹çš„æ¨ç†æ€§èƒ½ã€‚</p></div><footer class=entry-footer><span title='2025-06-10 20:45:00 +0800 +0800'>June 10, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;732 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-32b-awq-vllm-guide/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ</h2></header><div class=entry-content><p>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µï¼šæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯ åœ¨AIå¤§æ¨¡å‹éƒ¨ç½²é¢†åŸŸï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•å¯¹DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ä½¿ç”¨vLLMè¿›è¡Œéƒ¨ç½²ä¼˜åŒ–çš„å…¨è¿‡ç¨‹ï¼Œé‡ç‚¹å…³æ³¨ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸ç¡¬ä»¶èµ„æºåˆ©ç”¨çš„å¹³è¡¡è°ƒä¼˜ã€‚
ç¯å¢ƒä¸åŸºç¡€è®¾æ–½ æˆ‘ä»¬çš„éƒ¨ç½²ç¯å¢ƒå…·å¤‡ä»¥ä¸‹é…ç½®ï¼š
GPU: 4 x NVIDIA RTX 2080 Tiï¼ˆæ¯å¼ 22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBæ˜¾å­˜ï¼‰ æ¶æ„: Turing è®¡ç®—èƒ½åŠ›: 7.5 CPU: 56æ ¸ å†…å­˜: 512GB RAM å­˜å‚¨: 2TB SSD æ“ä½œç³»ç»Ÿ: Ubuntu 24.04 å®¹å™¨é•œåƒ: vllm/vllm-openai:v0.8.5 NVIDIAé©±åŠ¨: 570.153.02ï¼ˆCUDA 12.8ï¼‰ ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ æˆ‘ä»¬æœ€åˆçš„éƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š
docker run \ -d \ --gpus all \ --name coder \ --shm-size 16g \ --ulimit memlock=-1 \ --restart always \ --ipc=host \ -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models \ -p 8000:8000 \ -e CUDA_MODULE_LOADING=LAZY \ vllm/vllm-openai:v0.8.5 \ --model /models \ --served-model-name coder \ --tensor-parallel-size 4 \ --gpu-memory-utilization 0.93 \ --dtype float16 \ --max-model-len 65536 \ --trust-remote-code \ --load-format safetensors \ --disable-custom-all-reduce é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š
...</p></div><footer class=entry-footer><span title='2025-06-07 17:50:00 +0800 +0800'>June 7, 2025</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;561 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ" href=https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡</h2></header><div class=entry-content><p>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡ æœ¬æ–‡æ˜¯ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚
åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚
ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨&lt;think>...&lt;/think>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§"æ€è€ƒè¿‡ç¨‹"æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚
åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š
&lt;think> é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚ æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚ åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š 1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰ 2. è¯»å–æˆ–å†™å…¥å†…å®¹ 3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­ &lt;/think> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š ```python # å†™å…¥æ–‡ä»¶ with open('example.txt', 'w') as file: file.write('Hello, World!') # è¯»å–æ–‡ä»¶ with open('example.txt', 'r') as file: content = file.read() print(content) ### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶ vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š 1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨ 2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶ æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚ ## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç° ### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š ```jinja {% if messages %} {% set loop_messages = messages %} {% else %} {% set loop_messages = [{'role': 'system', 'content': ''}] %} {% endif %} {% for message in loop_messages %} {% if message['role'] == 'user' %} &lt;|im_start|>user {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'assistant' %} &lt;|im_start|>assistant {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'system' %} &lt;|im_start|>system {{ message['content'] }}&lt;|im_end|> {% endif %} {% endfor %} &lt;|im_start|>assistant {% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %} è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ&lt;think>...&lt;/think>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-04 14:30:00 +0800 +0800'>June 4, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;329 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—</h2></header><div class=entry-content><p>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å— ğŸ“‹ æ¦‚è¿° æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨vLLMé«˜æ•ˆéƒ¨ç½²Qwen3-30B-A3Bæ¨¡å‹ï¼Œå®ç°32Kä¸Šä¸‹æ–‡çª—å£å’ŒOpenAIå…¼å®¹APIï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚é€šè¿‡ç²¾ç»†è°ƒæ•´éƒ¨ç½²å‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ‰é™çš„GPUèµ„æºä¸‹æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½ã€‚
ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚ ç¡¬ä»¶é…ç½® 4å—NVIDIA GPU (æ¯å—22GBæ˜¾å­˜ï¼Œæ€»è®¡88GB) 512GBç³»ç»Ÿå†…å­˜ 2TB SSDå­˜å‚¨ 56æ ¸CPU è½¯ä»¶ç¯å¢ƒ Ubuntu 24.04 NVIDIAé©±åŠ¨ 550.144.03 CUDA 12.4 Docker + NVIDIA Container Toolkit ğŸ§  æ¨¡å‹ä¸æ¶æ„ Qwen3-30B-A3Bæ˜¯é˜¿é‡Œäº‘å‘å¸ƒçš„é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
30Bå‚æ•°é‡ åŸç”Ÿæ”¯æŒ32Kä¸Šä¸‹æ–‡é•¿åº¦ æ”¯æŒæ€è€ƒæ¨¡å¼(Chain-of-Thought) ä¼˜å¼‚çš„å¤šè¯­è¨€ä¸ä»£ç èƒ½åŠ› æˆ‘ä»¬ä½¿ç”¨vLLMä½œä¸ºæ¨ç†å¼•æ“ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒé‡ï¼š
é«˜æ•ˆå†…å­˜ç®¡ç†ï¼šé€šè¿‡PagedAttentionæŠ€æœ¯ä¼˜åŒ–KVç¼“å­˜ å¼ é‡å¹¶è¡Œï¼šè‡ªåŠ¨è·¨å¤šGPUåˆ†å¸ƒæ¨¡å‹æƒé‡ OpenAIå…¼å®¹APIï¼šç›´æ¥æ›¿ä»£OpenAI APIï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰åº”ç”¨ åŠ¨æ€æ‰¹å¤„ç†ï¼šè‡ªåŠ¨æ‰¹å¤„ç†å¤šè¯·æ±‚ï¼Œæé«˜ååé‡ ğŸ³ éƒ¨ç½²è„šæœ¬ ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç”¨äºéƒ¨ç½²çš„Dockerå‘½ä»¤ï¼Œç»è¿‡ç²¾å¿ƒè°ƒä¼˜ä»¥å¹³è¡¡æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ï¼š
docker run -d \ --runtime=nvidia \ --gpus=all \ --name coder \ -v /home/llm/model/qwen/qwen3-30b-a3b:/qwen/qwen3-30b-a3b \ -p 8000:8000 \ --cpuset-cpus 0-55 \ --ulimit memlock=-1 \ --ulimit stack=67108864 \ --restart always \ --ipc=host \ vllm/vllm-openai:v0.8.5 \ --model /qwen/qwen3-30b-a3b \ --served-model-name coder \ --tensor-parallel-size 4 \ --dtype half \ --max-model-len 32768 \ --max-num-batched-tokens 4096 \ --gpu-memory-utilization 0.93 \ --block-size 32 \ --enable-chunked-prefill \ --swap-space 16 \ --tokenizer-pool-size 56 \ --disable-custom-all-reduce ğŸ”§ å‚æ•°è¯¦è§£ä¸ä¼˜åŒ–ç­–ç•¥ Dockerå®¹å™¨é…ç½® å‚æ•° å€¼ ä½œç”¨ --runtime=nvidia å¯ç”¨NVIDIAå®¹å™¨è¿è¡Œæ—¶ --gpus=all å°†æ‰€æœ‰GPUæš´éœ²ç»™å®¹å™¨ --cpuset-cpus 0-55 é™åˆ¶å®¹å™¨ä½¿ç”¨0-55å·CPUæ ¸å¿ƒ --ulimit memlock=-1 ç§»é™¤å†…å­˜é”å®šé™åˆ¶ï¼Œæé«˜æ€§èƒ½ --ipc=host ä½¿ç”¨ä¸»æœºIPCå‘½åç©ºé—´ï¼Œå¯¹å…±äº«å†…å­˜å¾ˆé‡è¦ vLLMå¼•æ“é…ç½® 1. å¼ é‡å¹¶è¡Œç­–ç•¥ --tensor-parallel-size 4 æˆ‘ä»¬ä½¿ç”¨4è·¯å¼ é‡å¹¶è¡Œï¼Œå°†æ¨¡å‹åˆ†å¸ƒåœ¨4å—GPUä¸Šã€‚è¿™æ˜¯åŸºäºå®éªŒå¾—å‡ºçš„æœ€ä½³é…ç½® - åœ¨æˆ‘ä»¬çš„ç¡¬ä»¶ä¸Šï¼Œæ¯å—22GBæ˜¾å­˜çš„GPUæ— æ³•å•ç‹¬åŠ è½½å®Œæ•´çš„30Bæ¨¡å‹ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-03 16:00:00 +0800 +0800'>June 3, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;308 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://jackypanster.github.io/ai-stream/>AI é¿éš¾æ‰€</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>