<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.147.8"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AI é¿éš¾æ‰€</title><meta name=description content><meta name=author content="Jacky Pan"><link rel=canonical href=https://jackypanster.github.io/ai-stream/><link crossorigin=anonymous href=/ai-stream/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://jackypanster.github.io/ai-stream/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jackypanster.github.io/ai-stream/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jackypanster.github.io/ai-stream/favicon-32x32.png><link rel=apple-touch-icon href=https://jackypanster.github.io/ai-stream/apple-touch-icon.png><link rel=mask-icon href=https://jackypanster.github.io/ai-stream/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://jackypanster.github.io/ai-stream/index.xml><link rel=alternate type=application/json href=https://jackypanster.github.io/ai-stream/index.json><link rel=alternate hreflang=en href=https://jackypanster.github.io/ai-stream/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jackypanster.github.io/ai-stream/"><meta property="og:site_name" content="AI é¿éš¾æ‰€"><meta property="og:title" content="AI é¿éš¾æ‰€"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="AI é¿éš¾æ‰€"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"AI é¿éš¾æ‰€","url":"https://jackypanster.github.io/ai-stream/","description":"","logo":"https://jackypanster.github.io/ai-stream/favicon.ico","sameAs":[]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jackypanster.github.io/ai-stream/ accesskey=h title="AI é¿éš¾æ‰€ (Alt + H)">AI é¿éš¾æ‰€</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jackypanster.github.io/ai-stream/categories/ title=åˆ†ç±»><span>åˆ†ç±»</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://jackypanster.github.io/ai-stream/search/ title="æœç´¢ (Alt + /)" accesskey=/><span>æœç´¢</span></a></li></ul></nav></header><main class=main><article class=first-entry><header class=entry-header><h2 class=entry-hint-parent>ä¸ºä»€ä¹ˆé€‰æ‹©Gemini 2.5 Flashé©±åŠ¨K8s MCP Agentï¼šæ·±åº¦æŠ€æœ¯é€‰å‹åˆ†æ</h2></header><div class=entry-content><p>æœ¬æ–‡æ·±å…¥åˆ†æä¸ºä»€ä¹ˆé€‰æ‹©Google Gemini 2.5 Flashä½œä¸ºK8s MCP Agentçš„æ ¸å¿ƒLLMï¼Œè¯¦ç»†é˜è¿°æŠ€æœ¯é€‰å‹èƒŒåçš„æ·±å±‚è€ƒé‡ï¼ŒåŒ…æ‹¬MCPå·¥å…·è°ƒç”¨å…¼å®¹æ€§ã€å¤§ä¸Šä¸‹æ–‡èƒ½åŠ›ã€fail-fastæ¶æ„è®¾è®¡ç­‰å…³é”®å› ç´ ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-18 00:00:00 +0000 UTC'>June 18, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;798 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to ä¸ºä»€ä¹ˆé€‰æ‹©Gemini 2.5 Flashé©±åŠ¨K8s MCP Agentï¼šæ·±åº¦æŠ€æœ¯é€‰å‹åˆ†æ" href=https://jackypanster.github.io/ai-stream/posts/gemini-2.5-flash-mcp-tech-selection/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä¼˜åŒ–CI/CDç®¡é“ï¼šå®ç°Dockeré•œåƒç™½åå•ç»§æ‰¿æœºåˆ¶</h2></header><div class=entry-content><p>ğŸ“‹ æ¦‚è¿° åœ¨CI/CDæµç¨‹ä¸­ï¼ŒDockeré•œåƒå¤§å°ç®¡ç†è‡³å…³é‡è¦ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ä¸€ä¸ªæ ¸å¿ƒä¼˜åŒ–ï¼šDockeré•œåƒç™½åå•ç»§æ‰¿æœºåˆ¶ã€‚è¿™ä¸€æœºåˆ¶è§£å†³äº†åŸºäºç™½åå•ä¸­åŸºç¡€é•œåƒæ„å»ºçš„ä¸šåŠ¡é•œåƒæ— æ³•è‡ªåŠ¨è·å¾—ç™½åå•è±å…çš„é—®é¢˜ï¼Œå¤§å¹…ç®€åŒ–äº†ç™½åå•é…ç½®ç®¡ç†ï¼Œæå‡äº†å›¢é˜Ÿå¼€å‘æ•ˆç‡ã€‚
ğŸ§© èƒŒæ™¯ä¸é—®é¢˜åˆ†æ é—®é¢˜èƒŒæ™¯ åœ¨Jenkins CI/CDç®¡é“ä¸­ï¼Œä¸ºæ§åˆ¶Dockeré•œåƒä½“ç§¯ï¼Œæˆ‘ä»¬é™åˆ¶é•œåƒå¤§å°ä¸è¶…è¿‡2GBã€‚ç„¶è€Œï¼ŒAI/MLé¢†åŸŸçš„åŸºç¡€é•œåƒï¼ˆå¦‚PyTorchã€TensorFlowï¼‰å¤©ç„¶è¶…è¿‡æ­¤é™åˆ¶ï¼Œå› æ­¤å®ç°äº†ç™½åå•æœºåˆ¶å…è®¸ç‰¹å®šé•œåƒè·³è¿‡å¤§å°æ£€æŸ¥ã€‚
æ ¸å¿ƒéš¾é¢˜ ç™½åå•æ— æ³•è¦†ç›–æ´¾ç”Ÿé•œåƒï¼šå½“å·¥ç¨‹å¸ˆåŸºäºç™½åå•ä¸­çš„åŸºç¡€é•œåƒï¼ˆå¦‚pytorch/pytorch:1.9.0ï¼‰æ„å»ºè‡ªå®šä¹‰é•œåƒï¼ˆå¦‚company/ml-model:v1ï¼‰æ—¶ï¼Œç”±äºæ–°é•œåƒåç§°ä¸åœ¨ç™½åå•ä¸­ï¼Œå¯¼è‡´CIæµç¨‹å› å¤§å°é™åˆ¶è€Œå¤±è´¥ã€‚è¿™è¿«ä½¿å›¢é˜Ÿé¢‘ç¹æ›´æ–°ç™½åå•ï¼Œç»´æŠ¤æˆæœ¬é«˜æ˜‚ã€‚
ç°æœ‰æµç¨‹ æ£€æŸ¥åŸºç¡€é•œåƒå¤§å° â†’ æ£€æŸ¥åŸºç¡€é•œåƒæ˜¯å¦åœ¨ç™½åå•ä¸­ â†’ æ„å»ºæ–°é•œåƒ â†’ æ£€æŸ¥æ„å»ºé•œåƒå¤§å° â†’ æ£€æŸ¥æ„å»ºé•œåƒæ˜¯å¦åœ¨ç™½åå•ä¸­ â†’ æµæ°´çº¿ç»§ç»­/å¤±è´¥ ğŸ” æ–¹æ¡ˆè®¾è®¡ä¸åŸç† ç™½åå•ç»§æ‰¿æ€è·¯ è®¾è®¡ä¸€ç§"ç»§æ‰¿æœºåˆ¶"ï¼Œä½¿åŸºäºç™½åå•ä¸­åŸºç¡€é•œåƒæ„å»ºçš„é•œåƒèƒ½å¤Ÿè‡ªåŠ¨è·å¾—ç™½åå•è±å…æƒé™ï¼Œå³ä½¿æ–°é•œåƒåç§°ä¸åœ¨ç™½åå•ä¸­ã€‚
ä¼˜åŒ–æ ¸å¿ƒåŸç† åœ¨æ£€æµ‹åŸºç¡€é•œåƒæ—¶ï¼Œè®°å½•å…¶ç™½åå•çŠ¶æ€ åœ¨æ£€æµ‹æ„å»ºé•œåƒæ—¶ï¼Œè€ƒè™‘ä¸¤ç§ç™½åå•æ¡ä»¶ï¼š é•œåƒåç§°æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼ˆåŸå§‹æœºåˆ¶ï¼‰ åŸºç¡€é•œåƒæ˜¯å¦åœ¨ç™½åå•ä¸­ï¼ˆæ–°å¢ç»§æ‰¿æœºåˆ¶ï¼‰ å¦‚æœæ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼Œåˆ™å…è®¸é•œåƒé€šè¿‡å¤§å°æ£€æŸ¥ åŸºç¡€é•œåƒç™½åå•çŠ¶æ€ â†’ ä¼ é€’ç»™æ„å»ºé•œåƒæ£€æµ‹ â†’ æ„å»ºé•œåƒæ£€æµ‹åŒæ—¶è€ƒè™‘è‡ªèº«ç™½åå•çŠ¶æ€å’ŒåŸºç¡€é•œåƒç™½åå•çŠ¶æ€ ğŸ› ï¸ æ ¸å¿ƒå®ç°æ­¥éª¤ æ”¹è¿›åŸºç¡€é•œåƒæ£€æµ‹å‡½æ•° ä¿®æ”¹checkBaseImageSizeå‡½æ•°ï¼Œå¢åŠ è¿”å›åŸºç¡€é•œåƒç™½åå•çŠ¶æ€ï¼š
def checkBaseImageSize(String dockerFilePath) { def baseImageName = sh(script: "cat ${dockerFilePath} | grep FROM | head -n 1 | awk '{print \$2}'", returnStdout: true).trim() echo "åŸºç¡€é•œåƒ: ${baseImageName}" // è·å–é•œåƒå¤§å° def baseImageSize = sh(script: "docker images --format '{{.Size}}' ${baseImageName} | head -n 1", returnStdout: true).trim() def sizeMB = baseImageSize.contains('MB') ? baseImageSize.replace('MB', '').trim().toFloat() : (baseImageSize.contains('GB') ? baseImageSize.replace('GB', '').trim().toFloat() * 1024 : 0) def warnSizeMB = env.BASE_IMAGE_WARN_SIZE_MB ? env.BASE_IMAGE_WARN_SIZE_MB.toInteger() : 2048 echo "åŸºç¡€é•œåƒå¤§å°: ${sizeMB}MB, è­¦å‘Šé˜ˆå€¼: ${warnSizeMB}MB" // å…³é”®ç‚¹ï¼šæ£€æŸ¥åŸºç¡€é•œåƒæ˜¯å¦åœ¨ç™½åå•ä¸­ boolean inWhitelist = isImageInWhitelist(baseImageName) // å¤§å°æ£€æŸ¥é€»è¾‘ if (sizeMB > warnSizeMB) { if (!inWhitelist) { throw newReasonException("åŸºç¡€é•œåƒ ${baseImageName} å¤§å° ${sizeMB}MB è¶…è¿‡äº†è­¦å‘Šé˜ˆå€¼ ${warnSizeMB}MB") } else { echoWarning("åŸºç¡€é•œåƒ ${baseImageName} å¤§å°ä¸º ${sizeMB}MBï¼Œè¶…è¿‡å…è®¸çš„ ${warnSizeMB}MBï¼Œä½†åœ¨ç™½åå•ä¸­ï¼Œå…è®¸ç»§ç»­") } } // è¿”å›åŒ…å«ç™½åå•çŠ¶æ€çš„ä¿¡æ¯ return [baseImage: baseImageName, size: sizeMB, inWhitelist: inWhitelist] } ä¼˜åŒ–æ„å»ºé•œåƒæ£€æµ‹å‡½æ•° ä¿®æ”¹checkImageSizeå‡½æ•°ï¼Œå®ç°ç™½åå•ç»§æ‰¿æœºåˆ¶ï¼š
...</p></div><footer class=entry-footer><span title='2025-06-17 15:26:29 +0800 +0800'>June 17, 2025</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;429 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to ä¼˜åŒ–CI/CDç®¡é“ï¼šå®ç°Dockeré•œåƒç™½åå•ç»§æ‰¿æœºåˆ¶" href=https://jackypanster.github.io/ai-stream/posts/check-docker-image-size/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–</h2></header><div class=entry-content><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ vLLM é«˜æ•ˆéƒ¨ç½² Qwen3-32B-AWQ é‡åŒ–æ¨¡å‹ï¼Œå®ç° 32K ä¸Šä¸‹æ–‡çª—å£ã€OpenAI å…¼å®¹ APIï¼Œå¹¶ç¦ç”¨æ€è€ƒæ¨¡å¼ã€‚é€šè¿‡å¯¹ Docker åŠ vLLM å‚æ•°çš„ç²¾ç»†è°ƒä¼˜ï¼Œæœ€å¤§åŒ–æ¨¡å‹åœ¨å¤š GPU ç¯å¢ƒä¸‹çš„æ¨ç†æ€§èƒ½ã€‚</p></div><footer class=entry-footer><span title='2025-06-10 20:45:00 +0800 +0800'>June 10, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;732 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-32b-awq-vllm-guide/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AppArmoré…ç½®æ®‹ç•™é—®é¢˜æ’æŸ¥ä¸å½»åº•è§£å†³ï¼šä»æŠ¥é”™åˆ°ç³»ç»Ÿå‡€åŒ–çš„å®Œæ•´å®è·µ</h2></header><div class=entry-content><p>ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šè­¦å‘Šé¢‘å‘çš„SSSDé…ç½®æ®‹ç•™ åœ¨UbuntuæœåŠ¡å™¨ç»´æŠ¤è¿‡ç¨‹ä¸­ï¼Œé•¿æœŸè¢«AppArmoræœåŠ¡çš„SSSDç›¸å…³è­¦å‘Šå›°æ‰°ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š
æ¯æ¬¡é‡å¯AppArmoræœåŠ¡æ—¶ï¼Œæ—¥å¿—é¢‘ç¹æç¤ºWarning: found usr.sbin.sssd in /etc/apparmor.d/force-complain apparmor_statusæŒç»­æ˜¾ç¤º/usr/sbin/sssdé…ç½®å­˜åœ¨ï¼Œä½†å®é™…å·²å¸è½½SSSDæœåŠ¡ ç³»ç»Ÿæ—¥å¿—ä¸­ä¼´éšCaching disabled for: 'usr.sbin.sssd' due to force complainè­¦å‘Šï¼Œå½±å“æœåŠ¡ç¨³å®šæ€§è¯„ä¼° äºŒã€æŠ€æœ¯åˆ†æï¼šæ·±å…¥AppArmorçš„é…ç½®é€»è¾‘ 1. AppArmorçš„é…ç½®åŠ è½½æœºåˆ¶ ä¸»é…ç½®ç›®å½•ï¼š/etc/apparmor.d/ å­˜æ”¾ç³»ç»Ÿçº§é…ç½® æœ¬åœ°è¦†ç›–ç›®å½•ï¼š/etc/apparmor.d.local/ ä¼˜å…ˆçº§é«˜äºä¸»ç›®å½•ï¼Œç”¨äºæœ¬åœ°è‡ªå®šä¹‰ç­–ç•¥ è¿è¡Œæ—¶ç¼“å­˜ï¼šAppArmorä¼šå°†é…ç½®åŠ è½½åˆ°å†…æ ¸å¹¶ç¼“å­˜ï¼Œå³ä½¿åˆ é™¤æ–‡ä»¶ä¹Ÿå¯èƒ½æ®‹ç•™è¿è¡Œæ—¶çŠ¶æ€ 2. SSSDæœåŠ¡çš„ç‰¹æ®Šæ€§ è¯¥æœåŠ¡é»˜è®¤éšUbuntuéƒ¨åˆ†ç‰ˆæœ¬å®‰è£…ï¼Œæä¾›LDAP/NISç­‰è®¤è¯åŠŸèƒ½ å¸è½½æ—¶é»˜è®¤ä¿ç•™é…ç½®æ–‡ä»¶ï¼ˆ/etc/apparmor.d/usr.sbin.sssdï¼‰ï¼Œå¯¼è‡´AppArmoræŒç»­å°è¯•åŠ è½½å·²åˆ é™¤æœåŠ¡çš„ç­–ç•¥ 3. å…³é”®æŠ¥é”™æº¯æº# æ ¸å¿ƒé”™è¯¯æ—¥å¿— apparmor.systemd[12435]: /lib/apparmor/apparmor.systemd: 148: [: Illegal number: yes apparmor.systemd[12546]: Warning: found usr.sbin.sssd in /etc/apparmor.d/force-complain, forcing complain mode- è¯­æ³•é”™è¯¯æºäºrc.apparmor.functionsä¸­æ•°å€¼æ¯”è¾ƒç¬¦è¯¯ç”¨ï¼ˆ-eqæœªè½¬ä¹‰å­—ç¬¦ä¸²ï¼‰
è­¦å‘Šæœ¬è´¨æ˜¯æ®‹ç•™é…ç½®ä¸è¿è¡Œæ—¶çŠ¶æ€çš„å†²çª ä¸‰ã€åˆ†æ­¥è§£å†³æ–¹æ¡ˆï¼šä»æ‰‹åŠ¨æ¸…ç†åˆ°å†…æ ¸çº§é‡ç½® 1. è¯­æ³•ä¿®å¤ï¼šä¿®æ­£AppArmorå‡½æ•°åº“# å®šä½å…³é”®å‡½æ•° sudo nano /lib/apparmor/rc.apparmor.functions
ä¿®æ”¹check_usernså‡½æ•°ä¸­çš„æ¯”è¾ƒç¬¦ åŸä»£ç ï¼š if [ â€œ$userns_restrictedâ€ -eq 1 ]; then ä¿®æ­£åï¼š if [ â€œ$userns_restrictedâ€ = â€œ1â€ ]; then 2. æœåŠ¡å¸è½½ä¸é…ç½®æ¸…ç†# å½»åº•å¸è½½SSSD sudo apt remove â€“purge sssd sssd-tools
...</p></div><footer class=entry-footer><span title='2025-06-09 11:19:33 +0800 +0800'>June 9, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;172 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to AppArmoré…ç½®æ®‹ç•™é—®é¢˜æ’æŸ¥ä¸å½»åº•è§£å†³ï¼šä»æŠ¥é”™åˆ°ç³»ç»Ÿå‡€åŒ–çš„å®Œæ•´å®è·µ" href=https://jackypanster.github.io/ai-stream/posts/apparmor-troubleshooting/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ</h2></header><div class=entry-content><p>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µï¼šæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯ åœ¨AIå¤§æ¨¡å‹éƒ¨ç½²é¢†åŸŸï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•å¯¹DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ä½¿ç”¨vLLMè¿›è¡Œéƒ¨ç½²ä¼˜åŒ–çš„å…¨è¿‡ç¨‹ï¼Œé‡ç‚¹å…³æ³¨ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸ç¡¬ä»¶èµ„æºåˆ©ç”¨çš„å¹³è¡¡è°ƒä¼˜ã€‚
ç¯å¢ƒä¸åŸºç¡€è®¾æ–½ æˆ‘ä»¬çš„éƒ¨ç½²ç¯å¢ƒå…·å¤‡ä»¥ä¸‹é…ç½®ï¼š
GPU: 4 x NVIDIA RTX 2080 Tiï¼ˆæ¯å¼ 22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBæ˜¾å­˜ï¼‰ æ¶æ„: Turing è®¡ç®—èƒ½åŠ›: 7.5 CPU: 56æ ¸ å†…å­˜: 512GB RAM å­˜å‚¨: 2TB SSD æ“ä½œç³»ç»Ÿ: Ubuntu 24.04 å®¹å™¨é•œåƒ: vllm/vllm-openai:v0.8.5 NVIDIAé©±åŠ¨: 570.153.02ï¼ˆCUDA 12.8ï¼‰ ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ æˆ‘ä»¬æœ€åˆçš„éƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š
docker run \ -d \ --gpus all \ --name coder \ --shm-size 16g \ --ulimit memlock=-1 \ --restart always \ --ipc=host \ -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models \ -p 8000:8000 \ -e CUDA_MODULE_LOADING=LAZY \ vllm/vllm-openai:v0.8.5 \ --model /models \ --served-model-name coder \ --tensor-parallel-size 4 \ --gpu-memory-utilization 0.93 \ --dtype float16 \ --max-model-len 65536 \ --trust-remote-code \ --load-format safetensors \ --disable-custom-all-reduce é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š
...</p></div><footer class=entry-footer><span title='2025-06-07 17:50:00 +0800 +0800'>June 7, 2025</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;561 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ" href=https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡</h2></header><div class=entry-content><p>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡ æœ¬æ–‡æ˜¯ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚
åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚
ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨&lt;think>...&lt;/think>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§"æ€è€ƒè¿‡ç¨‹"æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚
åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š
&lt;think> é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚ æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚ åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š 1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰ 2. è¯»å–æˆ–å†™å…¥å†…å®¹ 3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­ &lt;/think> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š ```python # å†™å…¥æ–‡ä»¶ with open('example.txt', 'w') as file: file.write('Hello, World!') # è¯»å–æ–‡ä»¶ with open('example.txt', 'r') as file: content = file.read() print(content) ### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶ vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š 1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨ 2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶ æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚ ## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç° ### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š ```jinja {% if messages %} {% set loop_messages = messages %} {% else %} {% set loop_messages = [{'role': 'system', 'content': ''}] %} {% endif %} {% for message in loop_messages %} {% if message['role'] == 'user' %} &lt;|im_start|>user {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'assistant' %} &lt;|im_start|>assistant {{ message['content'] }}&lt;|im_end|> {% elif message['role'] == 'system' %} &lt;|im_start|>system {{ message['content'] }}&lt;|im_end|> {% endif %} {% endfor %} &lt;|im_start|>assistant {% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %} è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ&lt;think>...&lt;/think>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-04 14:30:00 +0800 +0800'>June 4, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;329 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—</h2></header><div class=entry-content><p>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å— ğŸ“‹ æ¦‚è¿° æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨vLLMé«˜æ•ˆéƒ¨ç½²Qwen3-30B-A3Bæ¨¡å‹ï¼Œå®ç°32Kä¸Šä¸‹æ–‡çª—å£å’ŒOpenAIå…¼å®¹APIï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚é€šè¿‡ç²¾ç»†è°ƒæ•´éƒ¨ç½²å‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ‰é™çš„GPUèµ„æºä¸‹æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½ã€‚
ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚ ç¡¬ä»¶é…ç½® 4å—NVIDIA GPU (æ¯å—22GBæ˜¾å­˜ï¼Œæ€»è®¡88GB) 512GBç³»ç»Ÿå†…å­˜ 2TB SSDå­˜å‚¨ 56æ ¸CPU è½¯ä»¶ç¯å¢ƒ Ubuntu 24.04 NVIDIAé©±åŠ¨ 550.144.03 CUDA 12.4 Docker + NVIDIA Container Toolkit ğŸ§  æ¨¡å‹ä¸æ¶æ„ Qwen3-30B-A3Bæ˜¯é˜¿é‡Œäº‘å‘å¸ƒçš„é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
30Bå‚æ•°é‡ åŸç”Ÿæ”¯æŒ32Kä¸Šä¸‹æ–‡é•¿åº¦ æ”¯æŒæ€è€ƒæ¨¡å¼(Chain-of-Thought) ä¼˜å¼‚çš„å¤šè¯­è¨€ä¸ä»£ç èƒ½åŠ› æˆ‘ä»¬ä½¿ç”¨vLLMä½œä¸ºæ¨ç†å¼•æ“ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒé‡ï¼š
é«˜æ•ˆå†…å­˜ç®¡ç†ï¼šé€šè¿‡PagedAttentionæŠ€æœ¯ä¼˜åŒ–KVç¼“å­˜ å¼ é‡å¹¶è¡Œï¼šè‡ªåŠ¨è·¨å¤šGPUåˆ†å¸ƒæ¨¡å‹æƒé‡ OpenAIå…¼å®¹APIï¼šç›´æ¥æ›¿ä»£OpenAI APIï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰åº”ç”¨ åŠ¨æ€æ‰¹å¤„ç†ï¼šè‡ªåŠ¨æ‰¹å¤„ç†å¤šè¯·æ±‚ï¼Œæé«˜ååé‡ ğŸ³ éƒ¨ç½²è„šæœ¬ ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç”¨äºéƒ¨ç½²çš„Dockerå‘½ä»¤ï¼Œç»è¿‡ç²¾å¿ƒè°ƒä¼˜ä»¥å¹³è¡¡æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ï¼š
docker run -d \ --runtime=nvidia \ --gpus=all \ --name coder \ -v /home/llm/model/qwen/qwen3-30b-a3b:/qwen/qwen3-30b-a3b \ -p 8000:8000 \ --cpuset-cpus 0-55 \ --ulimit memlock=-1 \ --ulimit stack=67108864 \ --restart always \ --ipc=host \ vllm/vllm-openai:v0.8.5 \ --model /qwen/qwen3-30b-a3b \ --served-model-name coder \ --tensor-parallel-size 4 \ --dtype half \ --max-model-len 32768 \ --max-num-batched-tokens 4096 \ --gpu-memory-utilization 0.93 \ --block-size 32 \ --enable-chunked-prefill \ --swap-space 16 \ --tokenizer-pool-size 56 \ --disable-custom-all-reduce ğŸ”§ å‚æ•°è¯¦è§£ä¸ä¼˜åŒ–ç­–ç•¥ Dockerå®¹å™¨é…ç½® å‚æ•° å€¼ ä½œç”¨ --runtime=nvidia å¯ç”¨NVIDIAå®¹å™¨è¿è¡Œæ—¶ --gpus=all å°†æ‰€æœ‰GPUæš´éœ²ç»™å®¹å™¨ --cpuset-cpus 0-55 é™åˆ¶å®¹å™¨ä½¿ç”¨0-55å·CPUæ ¸å¿ƒ --ulimit memlock=-1 ç§»é™¤å†…å­˜é”å®šé™åˆ¶ï¼Œæé«˜æ€§èƒ½ --ipc=host ä½¿ç”¨ä¸»æœºIPCå‘½åç©ºé—´ï¼Œå¯¹å…±äº«å†…å­˜å¾ˆé‡è¦ vLLMå¼•æ“é…ç½® 1. å¼ é‡å¹¶è¡Œç­–ç•¥ --tensor-parallel-size 4 æˆ‘ä»¬ä½¿ç”¨4è·¯å¼ é‡å¹¶è¡Œï¼Œå°†æ¨¡å‹åˆ†å¸ƒåœ¨4å—GPUä¸Šã€‚è¿™æ˜¯åŸºäºå®éªŒå¾—å‡ºçš„æœ€ä½³é…ç½® - åœ¨æˆ‘ä»¬çš„ç¡¬ä»¶ä¸Šï¼Œæ¯å—22GBæ˜¾å­˜çš„GPUæ— æ³•å•ç‹¬åŠ è½½å®Œæ•´çš„30Bæ¨¡å‹ã€‚
...</p></div><footer class=entry-footer><span title='2025-06-03 16:00:00 +0800 +0800'>June 3, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;308 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—" href=https://jackypanster.github.io/ai-stream/posts/deploy-qwen3/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AIè¾…åŠ©ç¼–ç¨‹å®æˆ˜ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½•</h2></header><div class=entry-content><p>AIè¾…åŠ©ç¼–ç¨‹å®æˆ˜ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½• å¼•è¨€ æœ¬æ–‡çœŸå®è¿˜åŸäº†æˆ‘ä¸AIåŠ©æ‰‹åä½œå®ç°Dockeré•œåƒå¤§å°ç›‘æ§åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚é€šè¿‡è¿™æ¬¡å®è·µï¼Œå¯ä»¥çœ‹åˆ°AIä¸ä»…èƒ½è¾…åŠ©å¼€å‘è€…æ¢³ç†éœ€æ±‚ã€è®¾è®¡æ–¹æ¡ˆï¼Œè¿˜èƒ½åœ¨ä»£ç å®ç°ã€æ–‡æ¡£ç¼–å†™ç­‰ç¯èŠ‚æä¾›é«˜æ•ˆå¸®åŠ©ã€‚æ•´ä¸ªæµç¨‹è‡ªç„¶æµç•…ï¼Œæå¤§æå‡äº†å¼€å‘ä½“éªŒã€‚
1. éœ€æ±‚åˆ†æä¸æ–¹æ¡ˆè®¾è®¡ åˆå§‹éœ€æ±‚æè¿° ç”¨æˆ·ï¼š æˆ‘ä»¬éœ€è¦åœ¨Jenkinså…±äº«åº“ä¸­å¢åŠ Dockeré•œåƒå¤§å°ç›‘æ§åŠŸèƒ½ï¼Œå½“é•œåƒè¶…è¿‡4GBæ—¶å‘å‡ºè­¦å‘Šã€‚è¯·å¸®å¿™åˆ†æä¸€ä¸‹å®ç°æ€è·¯ã€‚ AIçš„åˆæ­¥åˆ†æä¸å»ºè®® AIï¼š è®©æˆ‘å…ˆçœ‹çœ‹é¡¹ç›®çš„ç»“æ„â€¦â€¦ è¿™æ˜¯ä¸€ä¸ªJenkinså…±äº«åº“é¡¹ç›®ï¼Œæ ¸å¿ƒä»£ç éƒ½åœ¨`vars/`ç›®å½•ã€‚é’ˆå¯¹é•œåƒå¤§å°ç›‘æ§ï¼Œæˆ‘å»ºè®®ç›´æ¥åœ¨`buildDocker`æ–¹æ³•é‡ŒåŠ é€»è¾‘ï¼š 1. é•œåƒæ„å»ºå®Œæˆåç”¨`du`å‘½ä»¤è·å–å¤§å° 2. ä¸4GBé˜ˆå€¼æ¯”è¾ƒ 3. è¶…è¿‡é˜ˆå€¼å°±è¾“å‡ºè­¦å‘Š 4. ç›¸å…³æŒ‡æ ‡å†™æ—¥å¿—ï¼Œæ–¹ä¾¿åç»­åˆ†æ è¿™ä¸ªæ–¹æ¡ˆæ‚¨è§‰å¾—åˆé€‚å—ï¼Ÿæœ‰æ— è¡¥å……ï¼Ÿ éœ€æ±‚ç¡®è®¤ä¸ç»†åŒ– ç”¨æˆ·ï¼š è¿™ä¸ªæ€è·¯å¯ä»¥ï¼Œä¸è¿‡è¿˜éœ€è¦ï¼š 1. é˜ˆå€¼è¦å¯é…ç½®ï¼Œé»˜è®¤4GB 2. æ—¥å¿—é‡Œè¦æœ‰é•œåƒåã€å¤§å°ã€æ—¶é—´æˆ³ç­‰è¯¦ç»†ä¿¡æ¯ 3. è¾“å‡ºä¼˜åŒ–å»ºè®® å¦å¤–ï¼Œå¼‚å¸¸å¤„ç†ä¹Ÿè¦è€ƒè™‘å¾—æ›´ä¼˜é›…äº›ã€‚ 2. ä»£ç å®ç° åˆå§‹ä»£ç å®ç° AIï¼š æ˜ç™½ï¼Œæˆ‘æ¥å®ç°ã€‚ä¼šåœ¨`buildDocker`æ–¹æ³•é‡Œï¼š 1. ç”¨`getEnvOrDefault`æ”¯æŒé˜ˆå€¼é…ç½® 2. è¯¦ç»†è®°å½•æŒ‡æ ‡ 3. åŠ å¼ºé”™è¯¯å¤„ç† 4. è¾“å‡ºä¼˜åŒ–å»ºè®® å®ç°é€»è¾‘æ‚¨çœ‹è¿˜æœ‰ä»€ä¹ˆè¦è°ƒæ•´çš„å—ï¼Ÿ ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ– ç”¨æˆ·ï¼š æ•´ä½“ä¸é”™ï¼Œä¸è¿‡è­¦å‘Šè¦æ”¹æˆæŠ›å¼‚å¸¸ç›´æ¥ä¸­æ–­æ„å»ºã€‚å¦å¤–ï¼Œèƒ½ä¸èƒ½é¡ºä¾¿åŠ ä¸ŠåŸºç¡€é•œåƒå¤§å°æ£€æµ‹ï¼Ÿ å¼‚å¸¸å¤„ç†ä¼˜åŒ– AIï¼š æ˜ç™½æ‚¨çš„éœ€æ±‚ï¼Œä»£ç æˆ‘ä¼šè¿™æ ·ä¼˜åŒ–ï¼š 1. è¶…æ ‡ç›´æ¥æŠ›å¼‚å¸¸ä¸­æ–­æµæ°´çº¿ 2. å¢åŠ åŸºç¡€é•œåƒå¤§å°æ£€æµ‹ 3. æ˜ç¡®åŒºåˆ†ä¸šåŠ¡å¼‚å¸¸ï¼ˆæ¯”å¦‚é•œåƒè¿‡å¤§ï¼‰å’ŒæŠ€æœ¯å¼‚å¸¸ï¼ˆæ¯”å¦‚å‘½ä»¤å¤±è´¥ï¼‰ åŸºç¡€é•œåƒæ£€æµ‹è¿™å—ï¼Œæˆ‘å»ºè®®ï¼š - è§£æDockerfileçš„FROM - æ‹‰å–å¹¶æ£€æµ‹åŸºç¡€é•œåƒå¤§å° - è¶…é™å°±ç»™å‡ºalpineç­‰è½»é‡é•œåƒå»ºè®® è¿™æ ·å¤„ç†æ‚¨è§‰å¾—OKå—ï¼Ÿ 3. æµ‹è¯•ä¸éªŒè¯ æµ‹è¯•æ–¹æ¡ˆè®¨è®º ç”¨æˆ·ï¼š æ€ä¹ˆéªŒè¯è¿™ä¸ªåŠŸèƒ½ï¼Ÿ AIï¼š å»ºè®®è¿™æ ·æµ‹è¯•ï¼š 1. é•œåƒå¤§å°æ­£å¸¸ 2. æ°å¥½ç­‰äºé˜ˆå€¼ 3. è¶…è¿‡é˜ˆå€¼ 4. Dockerfileè§£æå¼‚å¸¸ ä¹Ÿå¯ä»¥ä¸´æ—¶æŠŠé˜ˆå€¼è°ƒå°ï¼Œå¿«é€ŸéªŒè¯å‘Šè­¦é€»è¾‘ã€‚ 4. æ–‡æ¡£ä¸æ²Ÿé€š å˜æ›´æ—¥å¿—ç”Ÿæˆ AIï¼š æˆ‘å·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†CHANGELOGï¼ŒåŒ…æ‹¬ï¼š - åŠŸèƒ½è¯´æ˜ - æŠ€æœ¯å®ç°ç»†èŠ‚ - é…ç½®å‚æ•°è¯´æ˜ - åç»­ä¼˜åŒ–è®¡åˆ’ å¦‚éœ€è°ƒæ•´ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ã€‚ å›¢é˜Ÿé€šçŸ¥ ç”¨æˆ·ï¼š è¦å‘ä¸ªé€šçŸ¥ç»™å›¢é˜Ÿï¼Œè¯´æ˜æˆ‘ä»¬è¦é™åˆ¶é•œåƒå¤§å°ã€‚ AIï¼š å»ºè®®åˆ†é˜¶æ®µæ¨è¿›ï¼š 1. å…ˆç›‘æ§å’Œé€šçŸ¥ 2. å†è¿›å…¥è­¦å‘ŠæœŸ 3. æœ€åå¼ºåˆ¶é™åˆ¶ è¿™æ ·å¤§å®¶æœ‰ç¼“å†²æœŸï¼Œå¯ä»¥é€æ­¥ä¼˜åŒ–Dockerfileã€‚éœ€è¦å¸®å¿™èµ·è‰é€šçŸ¥å—ï¼Ÿ 5. ç»éªŒæ€»ç»“ æŠ€æœ¯æ”¶è· AIè¾…åŠ©æ•ˆç‡
...</p></div><footer class=entry-footer><span title='2025-06-03 13:28:50 +0800 +0800'>June 3, 2025</span>&nbsp;Â·&nbsp;1 min&nbsp;Â·&nbsp;125 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to AIè¾…åŠ©ç¼–ç¨‹å®æˆ˜ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½•" href=https://jackypanster.github.io/ai-stream/posts/coding-with-ai/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>åŸºäºFunAudioLLM/SenseVoiceSmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯</h2></header><div class=entry-content><p>åŸºäºFunAudioLLM/SenseVoiceSmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯ é¡¹ç›®æ¦‚è¿° å®ç°ä¸€ä¸ªè¯­éŸ³è½¬å½•æ–‡æœ¬ï¼ˆASRï¼‰çš„æœåŠ¡ï¼Œç›®æ ‡æ˜¯èƒ½å¤Ÿé«˜æ•ˆåœ°å°†ç”¨æˆ·ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶è½¬æ¢ä¸ºæ–‡å­—ã€‚å‡ºäºä¸­æ–‡è¯­éŸ³çš„è€ƒè™‘ï¼Œé€‰æ‹©äº†æ¥è‡ª FunAudioLLM çš„ SenseVoiceSmall æ¨¡å‹ï¼Œå®ƒä»¥å…¶å¤šè¯­ç§æ”¯æŒã€é«˜æ•ˆç‡ä»¥åŠé›†æˆçš„è¯­éŸ³ç†è§£èƒ½åŠ›ï¼ˆå¦‚æƒ…æ„Ÿè¯†åˆ«ã€äº‹ä»¶æ£€æµ‹ï¼‰å¸å¼•äº†æˆ‘ã€‚æœ¬æ–‡å°†è¯¦ç»†è®°å½•ä»ç¯å¢ƒé…ç½®ã€æ ¸å¿ƒåŠŸèƒ½å®ç°åˆ°è¸©å‘è§£å†³çš„å…¨è¿‡ç¨‹ï¼Œå¹¶åˆ†äº«ä¸€äº›å…³äºæ¨¡å‹é€‰å‹çš„æ€è€ƒã€‚
å®Œæ•´ä»£ç å·²å¼€æºåœ¨ GitHub ä»“åº“ï¼šhttps://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall
é¡¹ç›®éœ€æ±‚æ–‡æ¡£ï¼ˆprd.mdï¼‰å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š
æ¨¡å‹: FunAudioLLM/SenseVoice (å…·ä½“ä¸º SenseVoiceSmall) æœ¬åœ°æ¨¡å‹è·¯å¾„: /home/llm/model/iic/SenseVoiceSmall (ä» ModelScope ä¸‹è½½) APIæ¡†æ¶: FastAPI Pythonç¯å¢ƒç®¡ç†: uv ç¯å¢ƒé…ç½® ä¸ºäº†ä¿æŒå¼€å‘ç¯å¢ƒçš„çº¯å‡€å’Œé«˜æ•ˆï¼Œé‡‡ç”¨äº† uv æ¥ç®¡ç† Python ä¾èµ–ã€‚
åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (å¦‚æœå°šæœªåˆ›å»º):
uv venv .venv source .venv/bin/activate å®‰è£…æ ¸å¿ƒä¾èµ–: åˆå§‹çš„ requirements.txt åŒ…å«äº† fastapi, uvicorn, python-multipart ç­‰åŸºç¡€åº“ã€‚åç»­æ ¹æ®æ¨¡å‹åŠ è½½å’Œå¤„ç†çš„éœ€æ±‚ï¼Œé€æ­¥æ·»åŠ äº† torch, torchaudio, numpy, transformers, sentencepiece, ä»¥åŠæœ€ç»ˆè§£å†³æ¨¡å‹åŠ è½½é—®é¢˜çš„æ ¸å¿ƒåº“ funasrã€‚
uv pip install -r requirements.txt æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ é¡¹ç›®ç»“æ„ é¡¹ç›®çš„ä¸»è¦ç»“æ„åŒ…æ‹¬ï¼š
app/main.py: FastAPI åº”ç”¨å…¥å£ï¼Œå®šä¹‰ API è·¯ç”±å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚æ¨¡å‹åŠ è½½ï¼‰ã€‚ app/models/sensevoice_loader.py: è´Ÿè´£åŠ è½½ SenseVoiceSmall æ¨¡å‹ï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼ã€‚ app/services/asr_service.py: å°è£…è¯­éŸ³å¤„ç†å’Œæ¨¡å‹æ¨ç†çš„æ ¸å¿ƒé€»è¾‘ã€‚ app/schemas.py: å®šä¹‰ API çš„è¯·æ±‚å’Œå“åº”æ•°æ®æ¨¡å‹ (Pydantic models)ã€‚ API ç«¯ç‚¹ å…³é”®çš„ API ç«¯ç‚¹è®¾è®¡ä¸ºï¼š
...</p></div><footer class=entry-footer><span title='2025-05-21 15:43:08 +0800 +0800'>May 21, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;400 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to åŸºäºFunAudioLLM/SenseVoiceSmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯" href=https://jackypanster.github.io/ai-stream/posts/howto-use-sensevoicesmall/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)</h2></header><div class=entry-content><p>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR) é¡¹ç›®æ¦‚è¿° æœ¬é¡¹ç›®åŸºäºQwen2.5-Omni-7Bæ¨¡å‹ï¼Œå®ç°äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³ è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ï¼šå°†è¯­éŸ³æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒæ ‡å‡†ASRå’Œçº¯ASRä¸¤ç§æ¨¡å¼ é¡¹ç›®åœ°å€ï¼šhttps://github.com/jackypanster/qwen-omni
ç¯å¢ƒé…ç½® æ¨èä½¿ç”¨condaç®¡ç†Pythonç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–å®‰è£…çš„ç¨³å®šæ€§ï¼š
# åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ conda create -n qwen-tts python=3.10 conda activate qwen-tts # å®‰è£…PyTorchï¼ˆGPUç‰ˆæœ¬ï¼‰ conda install pytorch=2.5.1 pytorch-cuda=12.1 -c pytorch -c nvidia conda install torchvision torchaudio -c pytorch # å®‰è£…å…¶ä»–ä¾èµ– conda install streamlit python-soundfile -c conda-forge pip install git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview pip install qwen-omni-utils æ ¸å¿ƒåŠŸèƒ½å®ç° 1. æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ def text_to_speech(text_input, output_audio_path="output/output.wav", speaker="Chelsie"): # åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨ model = Qwen2_5OmniForConditionalGeneration.from_pretrained( model_path, config=config, torch_dtype="auto", device_map="auto" ) processor = Qwen2_5OmniProcessor.from_pretrained(model_path) # æ„é€ å¯¹è¯ conversation = [ {"role": "system", "content": [{"type": "text", "text": "You are Qwen..."}]}, {"role": "user", "content": [{"type": "text", "text": text_input}]} ] # ç”Ÿæˆè¯­éŸ³ with torch.no_grad(): text_ids, audio = model.generate( **inputs, speaker=speaker, do_sample=True, temperature=0.8, top_p=0.95, max_new_tokens=1024 ) 2. è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ def audio_to_text(audio_path: str) -> str: # æ ‡å‡†ASRæ¨¡å¼ conversation = [ {"role": "system", "content": [{"type": "text", "text": "ä½ æ˜¯Qwen..."}]}, {"role": "user", "content": [{"type": "audio", "audio": audio_path}]} ] # ç”Ÿæˆæ–‡æœ¬ with torch.no_grad(): text_ids = model.generate( **inputs, do_sample=False, max_new_tokens=1024, return_audio=False ) Webç•Œé¢å®ç° ä½¿ç”¨Streamlitæ„å»ºäº†ç®€æ´çš„Webç•Œé¢ï¼š
...</p></div><footer class=entry-footer><span title='2025-05-20 20:24:06 +0800 +0800'>May 20, 2025</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;251 words&nbsp;Â·&nbsp;Jacky Pan</footer><a class=entry-link aria-label="post link to å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)" href=https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://jackypanster.github.io/ai-stream/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://jackypanster.github.io/ai-stream/>AI é¿éš¾æ‰€</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>