<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Posts on Code Whispers</title><link>https://jackypanster.github.io/ai-stream/posts/</link><description>Recent content in Posts on Code Whispers</description><generator>Hugo -- 0.148.1</generator><language>zh-cn</language><lastBuildDate>Wed, 16 Jul 2025 18:14:40 +0800</lastBuildDate><atom:link href="https://jackypanster.github.io/ai-stream/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Ubuntu 24.04 ç»ˆææ€§èƒ½è°ƒä¼˜æŒ‡å—ï¼šä»ç³»ç»Ÿè‡ƒè‚¿åˆ°å†…æ ¸å®šåˆ¶</title><link>https://jackypanster.github.io/ai-stream/posts/ubuntu-24-04-performance-tuning-guide/</link><pubDate>Wed, 16 Jul 2025 18:14:40 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/ubuntu-24-04-performance-tuning-guide/</guid><description>ä¸€ä»½é¢å‘å¼€å‘è€…çš„æ·±åº¦æŒ‡å—ï¼Œè®°å½•äº†å¦‚ä½•é€šè¿‡ç§»é™¤ Snapã€æ›´æ¢ XanMod å†…æ ¸ã€ç¦ç”¨ CPU å®‰å…¨ç¼“è§£ç­‰ä¸€ç³»åˆ—ç¡¬æ ¸æ“ä½œï¼Œå°†ä¸€å°æ ‡å‡† Ubuntu 24.04 å·¥ä½œç«™æ‰“é€ æˆæè‡´æ€§èƒ½çš„å¼€å‘æœºå™¨ã€‚</description></item><item><title>Qwen3-32B-AWQ vLLM å¤šå¡ 2080 Ti æé™éƒ¨ç½²å®æˆ˜</title><link>https://jackypanster.github.io/ai-stream/posts/qwen3-32b-2080ti-vllm-deploy/</link><pubDate>Wed, 16 Jul 2025 13:19:48 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/qwen3-32b-2080ti-vllm-deploy/</guid><description>&lt;blockquote>
&lt;p>ä½¿ç”¨æ—§æ˜¾å¡ä¹Ÿèƒ½è·‘ 32B å¤§æ¨¡å‹ï¼Ÿæœ¬æ–‡æ‰‹æŠŠæ‰‹æ¼”ç¤ºå¦‚ä½•åœ¨ &lt;strong>4Ã—RTX 2080 Ti (å…± 88 GB æ˜¾å­˜)&lt;/strong> æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡ vLLM 0.8.5 + AWQ é‡åŒ–ï¼Œè·‘èµ· &lt;strong>Qwen3-32B&lt;/strong> å¹¶æ”¯æŒ &lt;strong>32 K tokens&lt;/strong> è¶…é•¿ä¸Šä¸‹æ–‡ä¸é«˜ååæ¨ç†ã€‚å…¨æ–‡è®°å½•äº†è¸©å‘è¿‡ç¨‹ä¸å‚æ•°æƒè¡¡ï¼Œå¸Œæœ›ç»™åŒæ ·é¢„ç®—æœ‰é™ã€ç¡¬ä»¶å—é™çš„å·¥ç¨‹å¸ˆå¸¦æ¥å€Ÿé‰´ã€‚&lt;/p>&lt;/blockquote>
&lt;p>{{.TableOfContents}}&lt;/p>
&lt;h2 id="1-é¡¹ç›®èƒŒæ™¯">1 é¡¹ç›®èƒŒæ™¯&lt;/h2>
&lt;ul>
&lt;li>ä¸»è§’ï¼š&lt;code>Qwen3-32B-AWQ&lt;/code> é‡åŒ–æ¨¡å‹ ï¼ˆâ‰ˆ 18 GBï¼‰&lt;/li>
&lt;li>ç›®æ ‡ï¼šåœ¨æ¶ˆè´¹çº§ &lt;strong>Turing&lt;/strong> æ¶æ„æ˜¾å¡ï¼ˆ2080 Tiï¼‰ä¸Šæœ€å¤§åŒ–åˆ©ç”¨æ˜¾å­˜ä¸ååã€‚&lt;/li>
&lt;li>æ¡†æ¶ï¼š&lt;code>vLLM 0.8.5&lt;/code> (openai-compatible server)&lt;/li>
&lt;li>å–èˆï¼šç‰ºç‰²éƒ¨åˆ†å»¶è¿Ÿ / ç¨³å®šæ€§ â†’ æ¢å– &lt;strong>åå + ä¸Šä¸‹æ–‡é•¿åº¦&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="2-ç¡¬ä»¶ä¸ç³»ç»Ÿç¯å¢ƒ">2 ç¡¬ä»¶ä¸ç³»ç»Ÿç¯å¢ƒ&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>ç»„ä»¶&lt;/th>
&lt;th>è§„æ ¼&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>GPU&lt;/td>
&lt;td>4 Ã— RTX 2080 Ti, 22 GB &lt;em>each&lt;/em>, Compute Capability 7.5&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CPU&lt;/td>
&lt;td>â‰¥ 56 cores (vLLM çº¿ç¨‹å¯åƒæ»¡)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RAM&lt;/td>
&lt;td>512 GB&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Storage&lt;/td>
&lt;td>NVMe SSD 2 TB (æ¨¡å‹ + KV ç¼“å†²)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OS&lt;/td>
&lt;td>Ubuntu 24.04&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Driver&lt;/td>
&lt;td>NVIDIA 570.153.02&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CUDA&lt;/td>
&lt;td>12.8&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="21-nvidia-smi-åŸºçº¿ä¿¡æ¯">2.1 NVIDIA-SMI åŸºçº¿ä¿¡æ¯&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>nvidia-smi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Wed Jul &lt;span style="color:#ae81ff">16&lt;/span> 13:27:17 &lt;span style="color:#ae81ff">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+-----------------------------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>| NVIDIA-SMI 570.153.02 Driver Version: 570.153.02 CUDA Version: 12.8 |
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>+-----------------------------------------------------------------------------------------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>å¯ä»¥çœ‹åˆ°é©±åŠ¨ä¸ CUDA ç‰ˆæœ¬ä¸ä¸Šè¡¨ä¸€è‡´ï¼Œç¡®è®¤ç¯å¢ƒæ— åå·®ã€‚&lt;/p></description></item><item><title>ä»å•å¡ç“¶é¢ˆåˆ°å››å¡é½é£ï¼šä¸€æ¬¡å®Œæ•´çš„Ollamaå¤šGPUæœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–å®æˆ˜</title><link>https://jackypanster.github.io/ai-stream/posts/the-ultimate-guide-to-multi-gpu-ollama-deployment/</link><pubDate>Wed, 09 Jul 2025 00:00:00 +0000</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/the-ultimate-guide-to-multi-gpu-ollama-deployment/</guid><description>è®°å½•å¦‚ä½•å°†ä¸€å°æ‹¥æœ‰4å—RTX 2080 Tiçš„æœåŠ¡å™¨ï¼Œä»æœ€åˆçš„Ollamaå•ç‚¹æœåŠ¡ï¼Œé€æ­¥ä¼˜åŒ–ï¼Œæœ€ç»ˆæ­å»ºæˆä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„è´Ÿè½½å‡è¡¡é›†ç¾¤çš„å…¨è¿‡ç¨‹ã€‚</description></item><item><title>ä¸ºä»€ä¹ˆé€‰æ‹©Gemini 2.5 Flashé©±åŠ¨K8s MCP Agentï¼šæ·±åº¦æŠ€æœ¯é€‰å‹åˆ†æ</title><link>https://jackypanster.github.io/ai-stream/posts/gemini-2.5-flash-mcp-tech-selection/</link><pubDate>Wed, 18 Jun 2025 00:00:00 +0000</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/gemini-2.5-flash-mcp-tech-selection/</guid><description>æ·±å…¥åˆ†æGoogle Gemini 2.5 Flashåœ¨MCPå·¥å…·è°ƒç”¨æ–¹é¢çš„æŠ€æœ¯ä¼˜åŠ¿ï¼Œå¯¹æ¯”ä¸»æµLLMåœ¨å·¥å…·è°ƒç”¨å…¼å®¹æ€§æ–¹é¢çš„å·®å¼‚ï¼Œåˆ†äº«K8sè¿ç»´åœºæ™¯ä¸‹çš„æœ€ä½³å®è·µã€‚</description></item><item><title>ä¼˜åŒ–CI/CDç®¡é“ï¼šå®ç°Dockeré•œåƒç™½åå•ç»§æ‰¿æœºåˆ¶</title><link>https://jackypanster.github.io/ai-stream/posts/check-docker-image-size/</link><pubDate>Tue, 17 Jun 2025 15:26:29 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/check-docker-image-size/</guid><description>æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Jenkinså…±äº«åº“ä¸­ä¼˜åŒ–Dockeré•œåƒå¤§å°æ£€æµ‹ï¼Œå®ç°åŸºç¡€é•œåƒç™½åå•ç»§æ‰¿æœºåˆ¶ï¼Œè§£å†³æ„å»ºé•œåƒä¸ç™½åå•ä¸åŒ¹é…é—®é¢˜ã€‚</description></item><item><title>Qwen3-32B-AWQ é«˜æ•ˆéƒ¨ç½²ï¼šåŸºäº vLLM çš„æ·±åº¦å®è·µä¸ä¼˜åŒ–</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-32b-awq-vllm-guide/</link><pubDate>Tue, 10 Jun 2025 20:45:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-32b-awq-vllm-guide/</guid><description>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ vLLM é«˜æ•ˆéƒ¨ç½² Qwen3-32B-AWQ é‡åŒ–æ¨¡å‹ï¼Œå®ç° 32K ä¸Šä¸‹æ–‡çª—å£ã€OpenAI å…¼å®¹ APIï¼Œå¹¶ç¦ç”¨æ€è€ƒæ¨¡å¼ã€‚é€šè¿‡å¯¹ Docker åŠ vLLM å‚æ•°çš„ç²¾ç»†è°ƒä¼˜ï¼Œæœ€å¤§åŒ–æ¨¡å‹åœ¨å¤š GPU ç¯å¢ƒä¸‹çš„æ¨ç†æ€§èƒ½ã€‚</description></item><item><title>AppArmoré…ç½®æ®‹ç•™é—®é¢˜æ’æŸ¥ä¸å½»åº•è§£å†³ï¼šä»æŠ¥é”™åˆ°ç³»ç»Ÿå‡€åŒ–çš„å®Œæ•´å®è·µ</title><link>https://jackypanster.github.io/ai-stream/posts/apparmor-troubleshooting/</link><pubDate>Mon, 09 Jun 2025 11:19:33 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/apparmor-troubleshooting/</guid><description>æ·±å…¥è§£æUbuntuç³»ç»Ÿä¸­AppArmoræœåŠ¡çš„SSSDé…ç½®æ®‹ç•™é—®é¢˜ï¼Œä»åŸç†åˆ†æåˆ°å½»åº•è§£å†³çš„å®Œæ•´æŠ€æœ¯æŒ‡å—ï¼Œé€‚åˆç³»ç»Ÿè¿ç»´å·¥ç¨‹å¸ˆå‚è€ƒã€‚</description></item><item><title>DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µ</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/</link><pubDate>Sat, 07 Jun 2025 17:50:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-deepseek-r1-qwen3-8b-optimization/</guid><description>&lt;h1 id="deepseek-r1-0528-qwen3-8béƒ¨ç½²ä¼˜åŒ–å®è·µæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯">DeepSeek-R1-0528-Qwen3-8Béƒ¨ç½²ä¼˜åŒ–å®è·µï¼šæ€§èƒ½ä¸ç¨³å®šæ€§çš„å¹³è¡¡è‰ºæœ¯&lt;/h1>
&lt;p>åœ¨AIå¤§æ¨¡å‹éƒ¨ç½²é¢†åŸŸï¼Œæœ¬æ–‡è¯¦ç»†è®°å½•å¯¹DeepSeek-R1-0528-Qwen3-8Bæ¨¡å‹ä½¿ç”¨vLLMè¿›è¡Œéƒ¨ç½²ä¼˜åŒ–çš„å…¨è¿‡ç¨‹ï¼Œé‡ç‚¹å…³æ³¨ä¸Šä¸‹æ–‡çª—å£é•¿åº¦ä¸ç¡¬ä»¶èµ„æºåˆ©ç”¨çš„å¹³è¡¡è°ƒä¼˜ã€‚&lt;/p>
&lt;h2 id="ç¯å¢ƒä¸åŸºç¡€è®¾æ–½">ç¯å¢ƒä¸åŸºç¡€è®¾æ–½&lt;/h2>
&lt;p>æˆ‘ä»¬çš„éƒ¨ç½²ç¯å¢ƒå…·å¤‡ä»¥ä¸‹é…ç½®ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>GPU&lt;/strong>: 4 x NVIDIA RTX 2080 Tiï¼ˆæ¯å¼ 22GBæ˜¾å­˜ï¼Œæ€»è®¡88GBæ˜¾å­˜ï¼‰
&lt;ul>
&lt;li>æ¶æ„: Turing&lt;/li>
&lt;li>è®¡ç®—èƒ½åŠ›: 7.5&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>CPU&lt;/strong>: 56æ ¸&lt;/li>
&lt;li>&lt;strong>å†…å­˜&lt;/strong>: 512GB RAM&lt;/li>
&lt;li>&lt;strong>å­˜å‚¨&lt;/strong>: 2TB SSD&lt;/li>
&lt;li>&lt;strong>æ“ä½œç³»ç»Ÿ&lt;/strong>: Ubuntu 24.04&lt;/li>
&lt;li>&lt;strong>å®¹å™¨é•œåƒ&lt;/strong>: &lt;code>vllm/vllm-openai:v0.8.5&lt;/code>&lt;/li>
&lt;li>&lt;strong>NVIDIAé©±åŠ¨&lt;/strong>: 570.153.02ï¼ˆCUDA 12.8ï¼‰&lt;/li>
&lt;/ul>
&lt;h2 id="ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ">ä¼˜åŒ–å‰çš„éƒ¨ç½²è„šæœ¬åˆ†æ&lt;/h2>
&lt;p>æˆ‘ä»¬æœ€åˆçš„éƒ¨ç½²è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpus all &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --shm-size 16g &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ulimit memlock&lt;span style="color:#f92672">=&lt;/span>-1 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ipc&lt;span style="color:#f92672">=&lt;/span>host &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/llm/model/deepseek/DeepSeek-R1-0528-Qwen3-8B:/models &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8000:8000 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -e CUDA_MODULE_LOADING&lt;span style="color:#f92672">=&lt;/span>LAZY &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> vllm/vllm-openai:v0.8.5 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --model /models &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --served-model-name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --tensor-parallel-size &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpu-memory-utilization 0.93 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --dtype float16 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --max-model-len &lt;span style="color:#ae81ff">65536&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --trust-remote-code &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --load-format safetensors &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --disable-custom-all-reduce
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°å‡ ä¸ªå¯ä»¥ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼š&lt;/p></description></item><item><title>Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸15-20%æ€§èƒ½æå‡</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/</link><pubDate>Wed, 04 Jun 2025 14:30:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3-part2/</guid><description>&lt;h1 id="qwen3-30b-æŠ€æœ¯ä¼˜åŒ–å®è·µäºŒæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡">Qwen3-30B æŠ€æœ¯ä¼˜åŒ–å®è·µï¼ˆäºŒï¼‰ï¼šæ€è€ƒæ¨¡å¼æ§åˆ¶ä¸æ€§èƒ½æå‡&lt;/h1>
&lt;blockquote>
&lt;p>æœ¬æ–‡æ˜¯&lt;a href="blog-post.md">ã€Šä»32Kåˆ°131Kï¼šQwen3-30Bå¤§æ¨¡å‹ä¸Šä¸‹æ–‡æ‰©å±•å®è·µã€‹&lt;/a>çš„ç»­ç¯‡ï¼Œèšç„¦äºæ¨¡å‹æ€§èƒ½è°ƒä¼˜ç‰¹åˆ«æ˜¯æ€è€ƒæ¨¡å¼ï¼ˆreasoning modeï¼‰æ§åˆ¶çš„æŠ€æœ¯ç»†èŠ‚ä¸å®è·µç»éªŒã€‚&lt;/p>&lt;/blockquote>
&lt;p>åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨YaRNæŠ€æœ¯å°†Qwen3-30Bçš„ä¸Šä¸‹æ–‡é•¿åº¦ä»32Kæ‰©å±•åˆ°131Kã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–ç»´åº¦ï¼š&lt;strong>æ€è€ƒæ¨¡å¼æ§åˆ¶&lt;/strong>åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚é€šè¿‡ä¸€ç³»åˆ—å®éªŒå’Œè°ƒä¼˜ï¼Œæˆ‘ä»¬å‘ç°ç¦ç”¨æ€è€ƒæ¨¡å¼å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å“åº”é€Ÿåº¦å’Œå†…å­˜æ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç¼–ç¨‹å’Œç›´æ¥è¾“å‡ºç±»ä»»åŠ¡åœºæ™¯ã€‚&lt;/p>
&lt;h2 id="-æ€è€ƒæ¨¡å¼reasoning-modeè§£æ">ğŸ” æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼‰è§£æ&lt;/h2>
&lt;h3 id="ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼">ä»€ä¹ˆæ˜¯æ€è€ƒæ¨¡å¼ï¼Ÿ&lt;/h3>
&lt;p>æ€è€ƒæ¨¡å¼ï¼ˆReasoning Modeï¼Œä¹Ÿç§°ä¸ºThinking Modeï¼‰æ˜¯Qwen3ç³»åˆ—æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆä¸­é—´æ€è€ƒæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«åŒ…å«åœ¨&lt;code>&amp;lt;think&amp;gt;...&amp;lt;/think&amp;gt;&lt;/code>æ ‡ç­¾å†…ã€‚ç†è®ºä¸Šï¼Œè¿™ç§&amp;quot;æ€è€ƒè¿‡ç¨‹&amp;quot;æœ‰åŠ©äºæ¨¡å‹è¿›è¡Œæ›´å¤æ‚çš„æ¨ç†ï¼Œä½†åŒæ—¶ä¹Ÿå¼•å…¥äº†é¢å¤–çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚&lt;/p>
&lt;p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒQwen3æ¨¡å‹ä¼šå¯ç”¨æ€è€ƒæ¨¡å¼ï¼Œäº§ç”Ÿç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;think&amp;gt;
é¦–å…ˆï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å†™åŠŸèƒ½ã€‚
æˆ‘åº”è¯¥ä½¿ç”¨Pythonçš„å†…ç½®æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚
åŸºæœ¬æ­¥éª¤åº”è¯¥æ˜¯ï¼š
1. æ‰“å¼€æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨withè¯­å¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼‰
2. è¯»å–æˆ–å†™å…¥å†…å®¹
3. ç¡®ä¿æ–‡ä»¶æ­£ç¡®å…³é—­
&amp;lt;/think&amp;gt;
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonæ–‡ä»¶è¯»å†™ç¤ºä¾‹ï¼š
```python
# å†™å…¥æ–‡ä»¶
with open(&amp;#39;example.txt&amp;#39;, &amp;#39;w&amp;#39;) as file:
file.write(&amp;#39;Hello, World!&amp;#39;)
# è¯»å–æ–‡ä»¶
with open(&amp;#39;example.txt&amp;#39;, &amp;#39;r&amp;#39;) as file:
content = file.read()
print(content)
&lt;/code>&lt;/pre>&lt;pre tabindex="0">&lt;code>
### æ€è€ƒæ¨¡å¼å®ç°æœºåˆ¶
vLLMéƒ¨ç½²Qwen3æ¨¡å‹æ—¶ï¼Œæ€è€ƒæ¨¡å¼é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°æ§åˆ¶ï¼š
1. **æœåŠ¡å™¨çº§æ§åˆ¶**ï¼šé€šè¿‡éƒ¨ç½²å‚æ•°`--enable-reasoning`å’Œ`--reasoning-parser deepseek_r1`å¯ç”¨
2. **APIçº§æ§åˆ¶**ï¼šé€šè¿‡APIè°ƒç”¨ä¸­çš„`chat_template_kwargs`å‚æ•°æˆ–`enable_thinking`å‚æ•°åŠ¨æ€æ§åˆ¶
æˆ‘ä»¬çš„å‘ç°æ˜¯ï¼Œ**ä»…åˆ é™¤æœåŠ¡å™¨çº§åˆ«çš„å‚æ•°å¹¶ä¸è¶³å¤Ÿå®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼**ï¼Œæ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹ä»ä¼šäº§ç”Ÿæ€è€ƒè¿‡ç¨‹ã€‚æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿ã€‚
## ğŸ’¡ ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æŠ€æœ¯å®ç°
### è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ–¹æ¡ˆ
ç»è¿‡ç ”ç©¶Qwenå®˜æ–¹æ–‡æ¡£å’Œå®éªŒï¼Œæˆ‘ä»¬å‘ç°ä½¿ç”¨è‡ªå®šä¹‰èŠå¤©æ¨¡æ¿æ˜¯å®Œå…¨ç¦ç”¨æ€è€ƒæ¨¡å¼çš„æœ€å¯é æ–¹æ³•ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`qwen3_nonthinking.jinja`çš„æ¨¡æ¿æ–‡ä»¶ï¼š
```jinja
{% if messages %}
{% set loop_messages = messages %}
{% else %}
{% set loop_messages = [{&amp;#39;role&amp;#39;: &amp;#39;system&amp;#39;, &amp;#39;content&amp;#39;: &amp;#39;&amp;#39;}] %}
{% endif %}
{% for message in loop_messages %}
{% if message[&amp;#39;role&amp;#39;] == &amp;#39;user&amp;#39; %}
&amp;lt;|im_start|&amp;gt;user
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% elif message[&amp;#39;role&amp;#39;] == &amp;#39;assistant&amp;#39; %}
&amp;lt;|im_start|&amp;gt;assistant
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% elif message[&amp;#39;role&amp;#39;] == &amp;#39;system&amp;#39; %}
&amp;lt;|im_start|&amp;gt;system
{{ message[&amp;#39;content&amp;#39;] }}&amp;lt;|im_end|&amp;gt;
{% endif %}
{% endfor %}
&amp;lt;|im_start|&amp;gt;assistant
{% if add_generation_prompt is defined and add_generation_prompt %}{{ generation_prompt }}{% endif %}
&lt;/code>&lt;/pre>&lt;p>è¿™ä¸ªæ¨¡æ¿çš„å…³é”®ç‚¹æ˜¯&lt;strong>ç§»é™¤äº†æ‰€æœ‰ä¸æ€è€ƒæ¨¡å¼ç›¸å…³çš„æ ‡ç­¾å’Œå¤„ç†é€»è¾‘&lt;/strong>ï¼Œç¡®ä¿æ¨¡å‹æ— æ³•ç”Ÿæˆ&lt;code>&amp;lt;think&amp;gt;...&amp;lt;/think&amp;gt;&lt;/code>å—ï¼Œå³ä½¿APIè¯·æ±‚ä¸­å°è¯•å¯ç”¨æ€è€ƒæ¨¡å¼ã€‚&lt;/p></description></item><item><title>é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—</title><link>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3/</link><pubDate>Tue, 03 Jun 2025 16:00:00 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/deploy-qwen3/</guid><description>&lt;h1 id="é«˜æ€§èƒ½éƒ¨ç½²qwen3-30bvllmä¼˜åŒ–å®è·µæŒ‡å—">é«˜æ€§èƒ½éƒ¨ç½²Qwen3-30Bï¼švLLMä¼˜åŒ–å®è·µæŒ‡å—&lt;/h1>
&lt;h2 id="-æ¦‚è¿°">ğŸ“‹ æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨vLLMé«˜æ•ˆéƒ¨ç½²Qwen3-30B-A3Bæ¨¡å‹ï¼Œå®ç°32Kä¸Šä¸‹æ–‡çª—å£å’ŒOpenAIå…¼å®¹APIï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚é€šè¿‡ç²¾ç»†è°ƒæ•´éƒ¨ç½²å‚æ•°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æœ‰é™çš„GPUèµ„æºä¸‹æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½ã€‚&lt;/p>
&lt;h2 id="-ç³»ç»Ÿè¦æ±‚">ğŸ–¥ï¸ ç³»ç»Ÿè¦æ±‚&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>ç¡¬ä»¶é…ç½®&lt;/strong>
&lt;ul>
&lt;li>4å—NVIDIA GPU (æ¯å—22GBæ˜¾å­˜ï¼Œæ€»è®¡88GB)&lt;/li>
&lt;li>512GBç³»ç»Ÿå†…å­˜&lt;/li>
&lt;li>2TB SSDå­˜å‚¨&lt;/li>
&lt;li>56æ ¸CPU&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>è½¯ä»¶ç¯å¢ƒ&lt;/strong>
&lt;ul>
&lt;li>Ubuntu 24.04&lt;/li>
&lt;li>NVIDIAé©±åŠ¨ 550.144.03&lt;/li>
&lt;li>CUDA 12.4&lt;/li>
&lt;li>Docker + NVIDIA Container Toolkit&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="-æ¨¡å‹ä¸æ¶æ„">ğŸ§  æ¨¡å‹ä¸æ¶æ„&lt;/h2>
&lt;p>Qwen3-30B-A3Bæ˜¯é˜¿é‡Œäº‘å‘å¸ƒçš„é€šç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>30Bå‚æ•°é‡&lt;/li>
&lt;li>åŸç”Ÿæ”¯æŒ32Kä¸Šä¸‹æ–‡é•¿åº¦&lt;/li>
&lt;li>æ”¯æŒæ€è€ƒæ¨¡å¼(Chain-of-Thought)&lt;/li>
&lt;li>ä¼˜å¼‚çš„å¤šè¯­è¨€ä¸ä»£ç èƒ½åŠ›&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä½¿ç”¨vLLMä½œä¸ºæ¨ç†å¼•æ“ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒé‡ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>é«˜æ•ˆå†…å­˜ç®¡ç†&lt;/strong>ï¼šé€šè¿‡PagedAttentionæŠ€æœ¯ä¼˜åŒ–KVç¼“å­˜&lt;/li>
&lt;li>&lt;strong>å¼ é‡å¹¶è¡Œ&lt;/strong>ï¼šè‡ªåŠ¨è·¨å¤šGPUåˆ†å¸ƒæ¨¡å‹æƒé‡&lt;/li>
&lt;li>&lt;strong>OpenAIå…¼å®¹API&lt;/strong>ï¼šç›´æ¥æ›¿ä»£OpenAI APIï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰åº”ç”¨&lt;/li>
&lt;li>&lt;strong>åŠ¨æ€æ‰¹å¤„ç†&lt;/strong>ï¼šè‡ªåŠ¨æ‰¹å¤„ç†å¤šè¯·æ±‚ï¼Œæé«˜ååé‡&lt;/li>
&lt;/ol>
&lt;h2 id="-éƒ¨ç½²è„šæœ¬">ğŸ³ éƒ¨ç½²è„šæœ¬&lt;/h2>
&lt;p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç”¨äºéƒ¨ç½²çš„Dockerå‘½ä»¤ï¼Œç»è¿‡ç²¾å¿ƒè°ƒä¼˜ä»¥å¹³è¡¡æ€§èƒ½ä¸èµ„æºåˆ©ç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker run -d &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --runtime&lt;span style="color:#f92672">=&lt;/span>nvidia &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpus&lt;span style="color:#f92672">=&lt;/span>all &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -v /home/llm/model/qwen/qwen3-30b-a3b:/qwen/qwen3-30b-a3b &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> -p 8000:8000 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --cpuset-cpus 0-55 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ulimit memlock&lt;span style="color:#f92672">=&lt;/span>-1 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ulimit stack&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">67108864&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --restart always &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --ipc&lt;span style="color:#f92672">=&lt;/span>host &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> vllm/vllm-openai:v0.8.5 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --model /qwen/qwen3-30b-a3b &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --served-model-name coder &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --tensor-parallel-size &lt;span style="color:#ae81ff">4&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --dtype half &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --max-model-len &lt;span style="color:#ae81ff">32768&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --max-num-batched-tokens &lt;span style="color:#ae81ff">4096&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --gpu-memory-utilization 0.93 &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --block-size &lt;span style="color:#ae81ff">32&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --enable-chunked-prefill &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --swap-space &lt;span style="color:#ae81ff">16&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --tokenizer-pool-size &lt;span style="color:#ae81ff">56&lt;/span> &lt;span style="color:#ae81ff">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ae81ff">&lt;/span> --disable-custom-all-reduce
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="-å‚æ•°è¯¦è§£ä¸ä¼˜åŒ–ç­–ç•¥">ğŸ”§ å‚æ•°è¯¦è§£ä¸ä¼˜åŒ–ç­–ç•¥&lt;/h2>
&lt;h3 id="dockerå®¹å™¨é…ç½®">Dockerå®¹å™¨é…ç½®&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>å‚æ•°&lt;/th>
&lt;th>å€¼&lt;/th>
&lt;th>ä½œç”¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>--runtime=nvidia&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;td>å¯ç”¨NVIDIAå®¹å™¨è¿è¡Œæ—¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--gpus=all&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;td>å°†æ‰€æœ‰GPUæš´éœ²ç»™å®¹å™¨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--cpuset-cpus&lt;/code>&lt;/td>
&lt;td>&lt;code>0-55&lt;/code>&lt;/td>
&lt;td>é™åˆ¶å®¹å™¨ä½¿ç”¨0-55å·CPUæ ¸å¿ƒ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--ulimit memlock=-1&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;td>ç§»é™¤å†…å­˜é”å®šé™åˆ¶ï¼Œæé«˜æ€§èƒ½&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--ipc=host&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;td>ä½¿ç”¨ä¸»æœºIPCå‘½åç©ºé—´ï¼Œå¯¹å…±äº«å†…å­˜å¾ˆé‡è¦&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="vllmå¼•æ“é…ç½®">vLLMå¼•æ“é…ç½®&lt;/h3>
&lt;h4 id="1-å¼ é‡å¹¶è¡Œç­–ç•¥">1. å¼ é‡å¹¶è¡Œç­–ç•¥&lt;/h4>
&lt;pre tabindex="0">&lt;code>--tensor-parallel-size 4
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬ä½¿ç”¨4è·¯å¼ é‡å¹¶è¡Œï¼Œå°†æ¨¡å‹åˆ†å¸ƒåœ¨4å—GPUä¸Šã€‚è¿™æ˜¯åŸºäºå®éªŒå¾—å‡ºçš„æœ€ä½³é…ç½® - åœ¨æˆ‘ä»¬çš„ç¡¬ä»¶ä¸Šï¼Œæ¯å—22GBæ˜¾å­˜çš„GPUæ— æ³•å•ç‹¬åŠ è½½å®Œæ•´çš„30Bæ¨¡å‹ã€‚&lt;/p></description></item><item><title>AIè¾…åŠ©ç¼–ç¨‹å®æˆ˜ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½•</title><link>https://jackypanster.github.io/ai-stream/posts/coding-with-ai/</link><pubDate>Tue, 03 Jun 2025 13:28:50 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/coding-with-ai/</guid><description>&lt;h1 id="aiè¾…åŠ©ç¼–ç¨‹å®æˆ˜ä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½•">AIè¾…åŠ©ç¼–ç¨‹å®æˆ˜ï¼šä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´å¯¹è¯è®°å½•&lt;/h1>
&lt;h2 id="å¼•è¨€">å¼•è¨€&lt;/h2>
&lt;p>æœ¬æ–‡çœŸå®è¿˜åŸäº†æˆ‘ä¸AIåŠ©æ‰‹åä½œå®ç°Dockeré•œåƒå¤§å°ç›‘æ§åŠŸèƒ½çš„å…¨è¿‡ç¨‹ã€‚é€šè¿‡è¿™æ¬¡å®è·µï¼Œå¯ä»¥çœ‹åˆ°AIä¸ä»…èƒ½è¾…åŠ©å¼€å‘è€…æ¢³ç†éœ€æ±‚ã€è®¾è®¡æ–¹æ¡ˆï¼Œè¿˜èƒ½åœ¨ä»£ç å®ç°ã€æ–‡æ¡£ç¼–å†™ç­‰ç¯èŠ‚æä¾›é«˜æ•ˆå¸®åŠ©ã€‚æ•´ä¸ªæµç¨‹è‡ªç„¶æµç•…ï¼Œæå¤§æå‡äº†å¼€å‘ä½“éªŒã€‚&lt;/p>
&lt;h2 id="1-éœ€æ±‚åˆ†æä¸æ–¹æ¡ˆè®¾è®¡">1. éœ€æ±‚åˆ†æä¸æ–¹æ¡ˆè®¾è®¡&lt;/h2>
&lt;h3 id="åˆå§‹éœ€æ±‚æè¿°">åˆå§‹éœ€æ±‚æè¿°&lt;/h3>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·ï¼š
æˆ‘ä»¬éœ€è¦åœ¨Jenkinså…±äº«åº“ä¸­å¢åŠ Dockeré•œåƒå¤§å°ç›‘æ§åŠŸèƒ½ï¼Œå½“é•œåƒè¶…è¿‡4GBæ—¶å‘å‡ºè­¦å‘Šã€‚è¯·å¸®å¿™åˆ†æä¸€ä¸‹å®ç°æ€è·¯ã€‚
&lt;/code>&lt;/pre>&lt;h3 id="aiçš„åˆæ­¥åˆ†æä¸å»ºè®®">AIçš„åˆæ­¥åˆ†æä¸å»ºè®®&lt;/h3>
&lt;pre tabindex="0">&lt;code>AIï¼š
è®©æˆ‘å…ˆçœ‹çœ‹é¡¹ç›®çš„ç»“æ„â€¦â€¦
è¿™æ˜¯ä¸€ä¸ªJenkinså…±äº«åº“é¡¹ç›®ï¼Œæ ¸å¿ƒä»£ç éƒ½åœ¨`vars/`ç›®å½•ã€‚é’ˆå¯¹é•œåƒå¤§å°ç›‘æ§ï¼Œæˆ‘å»ºè®®ç›´æ¥åœ¨`buildDocker`æ–¹æ³•é‡ŒåŠ é€»è¾‘ï¼š
1. é•œåƒæ„å»ºå®Œæˆåç”¨`du`å‘½ä»¤è·å–å¤§å°
2. ä¸4GBé˜ˆå€¼æ¯”è¾ƒ
3. è¶…è¿‡é˜ˆå€¼å°±è¾“å‡ºè­¦å‘Š
4. ç›¸å…³æŒ‡æ ‡å†™æ—¥å¿—ï¼Œæ–¹ä¾¿åç»­åˆ†æ
è¿™ä¸ªæ–¹æ¡ˆæ‚¨è§‰å¾—åˆé€‚å—ï¼Ÿæœ‰æ— è¡¥å……ï¼Ÿ
&lt;/code>&lt;/pre>&lt;h3 id="éœ€æ±‚ç¡®è®¤ä¸ç»†åŒ–">éœ€æ±‚ç¡®è®¤ä¸ç»†åŒ–&lt;/h3>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·ï¼š
è¿™ä¸ªæ€è·¯å¯ä»¥ï¼Œä¸è¿‡è¿˜éœ€è¦ï¼š
1. é˜ˆå€¼è¦å¯é…ç½®ï¼Œé»˜è®¤4GB
2. æ—¥å¿—é‡Œè¦æœ‰é•œåƒåã€å¤§å°ã€æ—¶é—´æˆ³ç­‰è¯¦ç»†ä¿¡æ¯
3. è¾“å‡ºä¼˜åŒ–å»ºè®®
å¦å¤–ï¼Œå¼‚å¸¸å¤„ç†ä¹Ÿè¦è€ƒè™‘å¾—æ›´ä¼˜é›…äº›ã€‚
&lt;/code>&lt;/pre>&lt;h2 id="2-ä»£ç å®ç°">2. ä»£ç å®ç°&lt;/h2>
&lt;h3 id="åˆå§‹ä»£ç å®ç°">åˆå§‹ä»£ç å®ç°&lt;/h3>
&lt;pre tabindex="0">&lt;code>AIï¼š
æ˜ç™½ï¼Œæˆ‘æ¥å®ç°ã€‚ä¼šåœ¨`buildDocker`æ–¹æ³•é‡Œï¼š
1. ç”¨`getEnvOrDefault`æ”¯æŒé˜ˆå€¼é…ç½®
2. è¯¦ç»†è®°å½•æŒ‡æ ‡
3. åŠ å¼ºé”™è¯¯å¤„ç†
4. è¾“å‡ºä¼˜åŒ–å»ºè®®
å®ç°é€»è¾‘æ‚¨çœ‹è¿˜æœ‰ä»€ä¹ˆè¦è°ƒæ•´çš„å—ï¼Ÿ
&lt;/code>&lt;/pre>&lt;h3 id="ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ–">ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ–&lt;/h3>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·ï¼š
æ•´ä½“ä¸é”™ï¼Œä¸è¿‡è­¦å‘Šè¦æ”¹æˆæŠ›å¼‚å¸¸ç›´æ¥ä¸­æ–­æ„å»ºã€‚å¦å¤–ï¼Œèƒ½ä¸èƒ½é¡ºä¾¿åŠ ä¸ŠåŸºç¡€é•œåƒå¤§å°æ£€æµ‹ï¼Ÿ
&lt;/code>&lt;/pre>&lt;h3 id="å¼‚å¸¸å¤„ç†ä¼˜åŒ–">å¼‚å¸¸å¤„ç†ä¼˜åŒ–&lt;/h3>
&lt;pre tabindex="0">&lt;code>AIï¼š
æ˜ç™½æ‚¨çš„éœ€æ±‚ï¼Œä»£ç æˆ‘ä¼šè¿™æ ·ä¼˜åŒ–ï¼š
1. è¶…æ ‡ç›´æ¥æŠ›å¼‚å¸¸ä¸­æ–­æµæ°´çº¿
2. å¢åŠ åŸºç¡€é•œåƒå¤§å°æ£€æµ‹
3. æ˜ç¡®åŒºåˆ†ä¸šåŠ¡å¼‚å¸¸ï¼ˆæ¯”å¦‚é•œåƒè¿‡å¤§ï¼‰å’ŒæŠ€æœ¯å¼‚å¸¸ï¼ˆæ¯”å¦‚å‘½ä»¤å¤±è´¥ï¼‰
åŸºç¡€é•œåƒæ£€æµ‹è¿™å—ï¼Œæˆ‘å»ºè®®ï¼š
- è§£æDockerfileçš„FROM
- æ‹‰å–å¹¶æ£€æµ‹åŸºç¡€é•œåƒå¤§å°
- è¶…é™å°±ç»™å‡ºalpineç­‰è½»é‡é•œåƒå»ºè®®
è¿™æ ·å¤„ç†æ‚¨è§‰å¾—OKå—ï¼Ÿ
&lt;/code>&lt;/pre>&lt;h2 id="3-æµ‹è¯•ä¸éªŒè¯">3. æµ‹è¯•ä¸éªŒè¯&lt;/h2>
&lt;h3 id="æµ‹è¯•æ–¹æ¡ˆè®¨è®º">æµ‹è¯•æ–¹æ¡ˆè®¨è®º&lt;/h3>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·ï¼š
æ€ä¹ˆéªŒè¯è¿™ä¸ªåŠŸèƒ½ï¼Ÿ
AIï¼š
å»ºè®®è¿™æ ·æµ‹è¯•ï¼š
1. é•œåƒå¤§å°æ­£å¸¸
2. æ°å¥½ç­‰äºé˜ˆå€¼
3. è¶…è¿‡é˜ˆå€¼
4. Dockerfileè§£æå¼‚å¸¸
ä¹Ÿå¯ä»¥ä¸´æ—¶æŠŠé˜ˆå€¼è°ƒå°ï¼Œå¿«é€ŸéªŒè¯å‘Šè­¦é€»è¾‘ã€‚
&lt;/code>&lt;/pre>&lt;h2 id="4-æ–‡æ¡£ä¸æ²Ÿé€š">4. æ–‡æ¡£ä¸æ²Ÿé€š&lt;/h2>
&lt;h3 id="å˜æ›´æ—¥å¿—ç”Ÿæˆ">å˜æ›´æ—¥å¿—ç”Ÿæˆ&lt;/h3>
&lt;pre tabindex="0">&lt;code>AIï¼š
æˆ‘å·²ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†CHANGELOGï¼ŒåŒ…æ‹¬ï¼š
- åŠŸèƒ½è¯´æ˜
- æŠ€æœ¯å®ç°ç»†èŠ‚
- é…ç½®å‚æ•°è¯´æ˜
- åç»­ä¼˜åŒ–è®¡åˆ’
å¦‚éœ€è°ƒæ•´ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ã€‚
&lt;/code>&lt;/pre>&lt;h3 id="å›¢é˜Ÿé€šçŸ¥">å›¢é˜Ÿé€šçŸ¥&lt;/h3>
&lt;pre tabindex="0">&lt;code>ç”¨æˆ·ï¼š
è¦å‘ä¸ªé€šçŸ¥ç»™å›¢é˜Ÿï¼Œè¯´æ˜æˆ‘ä»¬è¦é™åˆ¶é•œåƒå¤§å°ã€‚
AIï¼š
å»ºè®®åˆ†é˜¶æ®µæ¨è¿›ï¼š
1. å…ˆç›‘æ§å’Œé€šçŸ¥
2. å†è¿›å…¥è­¦å‘ŠæœŸ
3. æœ€åå¼ºåˆ¶é™åˆ¶
è¿™æ ·å¤§å®¶æœ‰ç¼“å†²æœŸï¼Œå¯ä»¥é€æ­¥ä¼˜åŒ–Dockerfileã€‚éœ€è¦å¸®å¿™èµ·è‰é€šçŸ¥å—ï¼Ÿ
&lt;/code>&lt;/pre>&lt;h2 id="5-ç»éªŒæ€»ç»“">5. ç»éªŒæ€»ç»“&lt;/h2>
&lt;h3 id="æŠ€æœ¯æ”¶è·">æŠ€æœ¯æ”¶è·&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>AIè¾…åŠ©æ•ˆç‡&lt;/strong>&lt;/p></description></item><item><title>åŸºäºFunAudioLLM/SenseVoiceSmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯</title><link>https://jackypanster.github.io/ai-stream/posts/howto-use-sensevoicesmall/</link><pubDate>Wed, 21 May 2025 15:43:08 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/howto-use-sensevoicesmall/</guid><description>&lt;h1 id="åŸºäºfunaudiollmsensevoicesmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯">åŸºäºFunAudioLLM/SenseVoiceSmallæ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯&lt;/h1>
&lt;h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°&lt;/h2>
&lt;p>å®ç°ä¸€ä¸ªè¯­éŸ³è½¬å½•æ–‡æœ¬ï¼ˆASRï¼‰çš„æœåŠ¡ï¼Œç›®æ ‡æ˜¯èƒ½å¤Ÿé«˜æ•ˆåœ°å°†ç”¨æˆ·ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶è½¬æ¢ä¸ºæ–‡å­—ã€‚å‡ºäºä¸­æ–‡è¯­éŸ³çš„è€ƒè™‘ï¼Œé€‰æ‹©äº†æ¥è‡ª &lt;code>FunAudioLLM&lt;/code> çš„ &lt;code>SenseVoiceSmall&lt;/code> æ¨¡å‹ï¼Œå®ƒä»¥å…¶å¤šè¯­ç§æ”¯æŒã€é«˜æ•ˆç‡ä»¥åŠé›†æˆçš„è¯­éŸ³ç†è§£èƒ½åŠ›ï¼ˆå¦‚æƒ…æ„Ÿè¯†åˆ«ã€äº‹ä»¶æ£€æµ‹ï¼‰å¸å¼•äº†æˆ‘ã€‚æœ¬æ–‡å°†è¯¦ç»†è®°å½•ä»ç¯å¢ƒé…ç½®ã€æ ¸å¿ƒåŠŸèƒ½å®ç°åˆ°è¸©å‘è§£å†³çš„å…¨è¿‡ç¨‹ï¼Œå¹¶åˆ†äº«ä¸€äº›å…³äºæ¨¡å‹é€‰å‹çš„æ€è€ƒã€‚&lt;/p>
&lt;p>å®Œæ•´ä»£ç å·²å¼€æºåœ¨ GitHub ä»“åº“ï¼š&lt;a href="https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall">https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall&lt;/a>&lt;/p>
&lt;p>é¡¹ç›®éœ€æ±‚æ–‡æ¡£ï¼ˆ&lt;code>prd.md&lt;/code>ï¼‰å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ¨¡å‹&lt;/strong>: FunAudioLLM/SenseVoice (å…·ä½“ä¸º &lt;code>SenseVoiceSmall&lt;/code>)&lt;/li>
&lt;li>&lt;strong>æœ¬åœ°æ¨¡å‹è·¯å¾„&lt;/strong>: &lt;code>/home/llm/model/iic/SenseVoiceSmall&lt;/code> (ä» ModelScope ä¸‹è½½)&lt;/li>
&lt;li>&lt;strong>APIæ¡†æ¶&lt;/strong>: FastAPI&lt;/li>
&lt;li>&lt;strong>Pythonç¯å¢ƒç®¡ç†&lt;/strong>: &lt;code>uv&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h2>
&lt;p>ä¸ºäº†ä¿æŒå¼€å‘ç¯å¢ƒçš„çº¯å‡€å’Œé«˜æ•ˆï¼Œé‡‡ç”¨äº† &lt;code>uv&lt;/code> æ¥ç®¡ç† Python ä¾èµ–ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ&lt;/strong> (å¦‚æœå°šæœªåˆ›å»º):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv venv .venv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source .venv/bin/activate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>å®‰è£…æ ¸å¿ƒä¾èµ–&lt;/strong>:
åˆå§‹çš„ &lt;code>requirements.txt&lt;/code> åŒ…å«äº† &lt;code>fastapi&lt;/code>, &lt;code>uvicorn&lt;/code>, &lt;code>python-multipart&lt;/code> ç­‰åŸºç¡€åº“ã€‚åç»­æ ¹æ®æ¨¡å‹åŠ è½½å’Œå¤„ç†çš„éœ€æ±‚ï¼Œé€æ­¥æ·»åŠ äº† &lt;code>torch&lt;/code>, &lt;code>torchaudio&lt;/code>, &lt;code>numpy&lt;/code>, &lt;code>transformers&lt;/code>, &lt;code>sentencepiece&lt;/code>, ä»¥åŠæœ€ç»ˆè§£å†³æ¨¡å‹åŠ è½½é—®é¢˜çš„æ ¸å¿ƒåº“ &lt;code>funasr&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ">æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ&lt;/h2>
&lt;h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„&lt;/h3>
&lt;p>é¡¹ç›®çš„ä¸»è¦ç»“æ„åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>app/main.py&lt;/code>: FastAPI åº”ç”¨å…¥å£ï¼Œå®šä¹‰ API è·¯ç”±å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚æ¨¡å‹åŠ è½½ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>app/models/sensevoice_loader.py&lt;/code>: è´Ÿè´£åŠ è½½ &lt;code>SenseVoiceSmall&lt;/code> æ¨¡å‹ï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼ã€‚&lt;/li>
&lt;li>&lt;code>app/services/asr_service.py&lt;/code>: å°è£…è¯­éŸ³å¤„ç†å’Œæ¨¡å‹æ¨ç†çš„æ ¸å¿ƒé€»è¾‘ã€‚&lt;/li>
&lt;li>&lt;code>app/schemas.py&lt;/code>: å®šä¹‰ API çš„è¯·æ±‚å’Œå“åº”æ•°æ®æ¨¡å‹ (Pydantic models)ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="api-ç«¯ç‚¹">API ç«¯ç‚¹&lt;/h3>
&lt;p>å…³é”®çš„ API ç«¯ç‚¹è®¾è®¡ä¸ºï¼š&lt;/p></description></item><item><title>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)</title><link>https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/</link><pubDate>Tue, 20 May 2025 20:24:06 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/</guid><description>&lt;h1 id="å¦‚ä½•ä½¿ç”¨qwen25-omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³ttså’Œè¯­éŸ³è½¬æ–‡æœ¬asr">å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)&lt;/h1>
&lt;h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬é¡¹ç›®åŸºäºQwen2.5-Omni-7Bæ¨¡å‹ï¼Œå®ç°äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š&lt;/p>
&lt;ol>
&lt;li>æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³&lt;/li>
&lt;li>è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ï¼šå°†è¯­éŸ³æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒæ ‡å‡†ASRå’Œçº¯ASRä¸¤ç§æ¨¡å¼&lt;/li>
&lt;/ol>
&lt;p>é¡¹ç›®åœ°å€ï¼š&lt;a href="https://github.com/jackypanster/qwen-omni">https://github.com/jackypanster/qwen-omni&lt;/a>&lt;/p>
&lt;h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h2>
&lt;p>æ¨èä½¿ç”¨condaç®¡ç†Pythonç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–å®‰è£…çš„ç¨³å®šæ€§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda create -n qwen-tts python&lt;span style="color:#f92672">=&lt;/span>3.10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda activate qwen-tts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®‰è£…PyTorchï¼ˆGPUç‰ˆæœ¬ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install pytorch&lt;span style="color:#f92672">=&lt;/span>2.5.1 pytorch-cuda&lt;span style="color:#f92672">=&lt;/span>12.1 -c pytorch -c nvidia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install torchvision torchaudio -c pytorch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®‰è£…å…¶ä»–ä¾èµ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install streamlit python-soundfile -c conda-forge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pip install git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pip install qwen-omni-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°">æ ¸å¿ƒåŠŸèƒ½å®ç°&lt;/h2>
&lt;h3 id="1-æ–‡æœ¬è½¬è¯­éŸ³tts">1. æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">text_to_speech&lt;/span>(text_input, output_audio_path&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;output/output.wav&amp;#34;&lt;/span>, speaker&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniForConditionalGeneration&lt;span style="color:#f92672">.&lt;/span>from_pretrained(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">=&lt;/span>config,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> torch_dtype&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> device_map&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processor &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniProcessor&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># æ„é€ å¯¹è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;You are Qwen...&amp;#34;&lt;/span>}]},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: text_input}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç”Ÿæˆè¯­éŸ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids, audio &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>speaker,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> temperature&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.8&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top_p&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.95&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-è¯­éŸ³è½¬æ–‡æœ¬asr">2. è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">audio_to_text&lt;/span>(audio_path: str) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> str:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># æ ‡å‡†ASRæ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;ä½ æ˜¯Qwen...&amp;#34;&lt;/span>}]},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;audio&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;audio&amp;#34;&lt;/span>: audio_path}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç”Ÿæˆæ–‡æœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return_audio&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="webç•Œé¢å®ç°">Webç•Œé¢å®ç°&lt;/h2>
&lt;p>ä½¿ç”¨Streamlitæ„å»ºäº†ç®€æ´çš„Webç•Œé¢ï¼š&lt;/p></description></item><item><title>Qwen2.5-Omni-7B æ–‡æœ¬è½¬è¯­éŸ³éƒ¨ç½²æŒ‡å—</title><link>https://jackypanster.github.io/ai-stream/posts/how-to-setup-qwen-omni/</link><pubDate>Mon, 19 May 2025 10:54:50 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/how-to-setup-qwen-omni/</guid><description>&lt;p>&lt;img alt="Qwen2.5-Omni-7B TTS" loading="lazy" src="https://via.placeholder.com/800x400.png/007bff/ffffff?text=Qwen2.5-Omni-7B+TTS">&lt;/p>
&lt;h2 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬è„šæœ¬åŸºäº Qwen2.5-Omni-7B å¤šæ¨¡æ€æ¨¡å‹å®ç°æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰åŠŸèƒ½ï¼Œæ”¯æŒç”Ÿæˆè‡ªç„¶æµç•…çš„ä¸­æ–‡ / è‹±æ–‡è¯­éŸ³ï¼Œå¹¶æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹ï¼ˆå¥³æ€§ â€œChelsieâ€ã€ç”·æ€§ â€œEthanâ€ï¼‰ã€‚è„šæœ¬å¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼ˆ.wavæ ¼å¼ï¼‰ï¼Œé€‚ç”¨äºè¯­éŸ³åŠ©æ‰‹ã€å†…å®¹åˆ›ä½œã€æ— éšœç¢æœåŠ¡ç­‰åœºæ™¯ã€‚&lt;/p>
&lt;h2 id="ä¸»è¦ç‰¹æ€§">ä¸»è¦ç‰¹æ€§&lt;/h2>
&lt;ul>
&lt;li>ğŸ™ï¸ æ”¯æŒè‡ªç„¶æµç•…çš„ &lt;strong>ä¸­æ–‡/è‹±æ–‡&lt;/strong> è¯­éŸ³åˆæˆ&lt;/li>
&lt;li>ğŸ‘¥ æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹é€‰æ‹©ï¼š
&lt;ul>
&lt;li>å¥³æ€§å£°çº¿ï¼š&amp;ldquo;Chelsie&amp;rdquo;&lt;/li>
&lt;li>ç”·æ€§å£°çº¿ï¼š&amp;ldquo;Ethan&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ğŸ’¾ è¾“å‡ºæ ¼å¼ï¼šæ ‡å‡† &lt;code>.wav&lt;/code> éŸ³é¢‘æ–‡ä»¶&lt;/li>
&lt;li>ğŸš€ é«˜æ€§èƒ½æ¨ç†ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ&lt;/li>
&lt;/ul>
&lt;h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹å¼€å‘&lt;/li>
&lt;li>å†…å®¹åˆ›ä½œä¸æ’­å®¢åˆ¶ä½œ&lt;/li>
&lt;li>æ— éšœç¢æœåŠ¡&lt;/li>
&lt;li>æ•™è‚²ç±»åº”ç”¨&lt;/li>
&lt;li>å¤šåª’ä½“å†…å®¹ç”Ÿæˆ&lt;/li>
&lt;/ul>
&lt;h2 id="å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨&lt;/h2>
&lt;blockquote>
&lt;p>ğŸ’¡ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Python 3.8+&lt;/li>
&lt;li>CUDA 11.7+ (å¦‚éœ€GPUåŠ é€Ÿ)&lt;/li>
&lt;li>è‡³å°‘16GBå¯ç”¨å†…å­˜&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;p>å®‰è£…ä¾èµ–åº“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv init
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add accelerate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add qwen-omni-utils&lt;span style="color:#f92672">[&lt;/span>decord&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add soundfile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add torchvision
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv sync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®Œæ•´è„šæœ¬ä»£ç ï¼ˆmain_text2audio.pyï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> os
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> soundfile &lt;span style="color:#66d9ef">as&lt;/span> sf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> torch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> transformers &lt;span style="color:#f92672">import&lt;/span> Qwen2_5OmniForConditionalGeneration, Qwen2_5OmniProcessor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> qwen_omni_utils &lt;span style="color:#f92672">import&lt;/span> process_mm_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> transformers &lt;span style="color:#f92672">import&lt;/span> AutoConfig
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">text_to_speech&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_input: str,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> output_audio_path: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;output/test_audio.wav&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;/home/llm/model/qwen/Omni/&amp;#34;&lt;/span> &lt;span style="color:#75715e"># æ”¹ä¸ºæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> æ–‡æœ¬è½¬è¯­éŸ³æ ¸å¿ƒå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param text_input: è¾“å…¥æ–‡æœ¬ï¼ˆæ”¯æŒä¸­æ–‡/è‹±æ–‡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param output_audio_path: éŸ³é¢‘è¾“å‡ºè·¯å¾„ï¼ˆå«æ–‡ä»¶åï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param speaker: è¯­éŸ³ç±»å‹ï¼ˆ&amp;#34;Chelsie&amp;#34;å¥³æ€§/&amp;#34;Ethan&amp;#34;ç”·æ€§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param model_path: æ¨¡å‹è·¯å¾„ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 1. åŠ è½½æ¨¡å‹é…ç½®ï¼ˆä¿®å¤ROPEå‚æ•°å…¼å®¹æ€§ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config &lt;span style="color:#f92672">=&lt;/span> AutoConfig&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path, local_files_only&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> hasattr(config, &lt;span style="color:#e6db74">&amp;#34;rope_scaling&amp;#34;&lt;/span>) &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#e6db74">&amp;#34;mrope_section&amp;#34;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> config&lt;span style="color:#f92672">.&lt;/span>rope_scaling:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">.&lt;/span>rope_scaling&lt;span style="color:#f92672">.&lt;/span>pop(&lt;span style="color:#e6db74">&amp;#34;mrope_section&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 2. åŠ è½½æ¨¡å‹ï¼ˆæ”¯æŒGPUè‡ªåŠ¨åˆ†é…ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniForConditionalGeneration&lt;span style="color:#f92672">.&lt;/span>from_pretrained(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">=&lt;/span>config,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> torch_dtype&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> device_map&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_files_only&lt;span style="color:#f92672">=&lt;/span>(model_path &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Qwen/Qwen2.5-Omni-7B&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processor &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniProcessor&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 3. ç³»ç»Ÿæç¤ºï¼ˆå¿…é¡»åŒ…å«è¯­éŸ³ç”Ÿæˆèƒ½åŠ›å£°æ˜ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> system_prompt &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;You are Qwen, a virtual human developed by the Qwen Team, Alibaba Group, capable of perceiving auditory and visual inputs, as well as generating text and speech.&amp;#34;&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 4. æ„å»ºå¯¹è¯ï¼ˆçº¯æ–‡æœ¬è¾“å…¥ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> system_prompt &lt;span style="color:#f92672">+&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: text_input}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 5. å¤„ç†è¾“å…¥æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text &lt;span style="color:#f92672">=&lt;/span> processor&lt;span style="color:#f92672">.&lt;/span>apply_chat_template(conversation, add_generation_prompt&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, tokenize&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> audios, images, videos &lt;span style="color:#f92672">=&lt;/span> process_mm_info(conversation, use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 6. ç”Ÿæˆè¯­éŸ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inputs &lt;span style="color:#f92672">=&lt;/span> processor(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text&lt;span style="color:#f92672">=&lt;/span>text, audio&lt;span style="color:#f92672">=&lt;/span>audios, images&lt;span style="color:#f92672">=&lt;/span>images, videos&lt;span style="color:#f92672">=&lt;/span>videos,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return_tensors&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;pt&amp;#34;&lt;/span>, padding&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )&lt;span style="color:#f92672">.&lt;/span>to(model&lt;span style="color:#f92672">.&lt;/span>device, model&lt;span style="color:#f92672">.&lt;/span>dtype)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids, audio &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>speaker,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, &lt;span style="color:#75715e"># å¯ç”¨é‡‡æ ·æ¨¡å¼ä»¥ä½¿ç”¨temperature/top_p&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> temperature&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.8&lt;/span>, &lt;span style="color:#75715e"># æ§åˆ¶éšæœºæ€§ï¼ˆ0.5-1.0è¾ƒè‡ªç„¶ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top_p&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.95&lt;/span>, &lt;span style="color:#75715e"># æ ¸é‡‡æ ·å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>, &lt;span style="color:#75715e"># æ§åˆ¶è¯­éŸ³æ—¶é•¿ï¼ˆçº¦15ç§’ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 7. ä¿å­˜ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> os&lt;span style="color:#f92672">.&lt;/span>makedirs(os&lt;span style="color:#f92672">.&lt;/span>path&lt;span style="color:#f92672">.&lt;/span>dirname(output_audio_path), exist_ok&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sf&lt;span style="color:#f92672">.&lt;/span>write(output_audio_path, audio&lt;span style="color:#f92672">.&lt;/span>reshape(&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>cpu()&lt;span style="color:#f92672">.&lt;/span>numpy(), samplerate&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">24000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;âœ… ç”Ÿæˆå®Œæˆï¼š&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>output_audio_path&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ğŸ“„ ç”Ÿæˆæ–‡æœ¬ï¼š&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>processor&lt;span style="color:#f92672">.&lt;/span>batch_decode(text_ids, skip_special_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)[&lt;span style="color:#ae81ff">0&lt;/span>]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;__main__&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç¤ºä¾‹è¾“å…¥ï¼ˆå¯æ›¿æ¢ä¸ºä»»æ„æ–‡æœ¬ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input_text &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ä½ å¥½ï¼Œè¿™æ˜¯Qwen2.5-Omniçš„æ–‡æœ¬è½¬è¯­éŸ³ç¤ºä¾‹ã€‚ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># è°ƒç”¨å‡½æ•°ï¼ˆæŒ‡å®šè¾“å‡ºè·¯å¾„å’Œè¯­éŸ³ç±»å‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_to_speech(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input_text,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> output_audio_path&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;output/hello_qwen.wav&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span> &lt;span style="color:#75715e"># å¯é€‰&amp;#34;Ethan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œè„šæœ¬&lt;/p></description></item></channel></rss>