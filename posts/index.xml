<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Posts on AI é¿éš¾æ‰€</title><link>https://jackypanster.github.io/ai-stream/posts/</link><description>Recent content in Posts on AI é¿éš¾æ‰€</description><generator>Hugo -- 0.147.4</generator><language>en-us</language><lastBuildDate>Wed, 21 May 2025 15:43:08 +0800</lastBuildDate><atom:link href="https://jackypanster.github.io/ai-stream/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>åŸºäº FunAudioLLM/SenseVoiceSmall æ­å»ºé«˜æ•ˆè¯­éŸ³è½¬å½•æœåŠ¡çš„å®è·µä¹‹è·¯</title><link>https://jackypanster.github.io/ai-stream/posts/howto-use-sensevoicesmall/</link><pubDate>Wed, 21 May 2025 15:43:08 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/howto-use-sensevoicesmall/</guid><description>&lt;h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°&lt;/h2>
&lt;p>å®ç°ä¸€ä¸ªè¯­éŸ³è½¬å½•æ–‡æœ¬ï¼ˆASRï¼‰çš„æœåŠ¡ï¼Œç›®æ ‡æ˜¯èƒ½å¤Ÿé«˜æ•ˆåœ°å°†ç”¨æˆ·ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶è½¬æ¢ä¸ºæ–‡å­—ã€‚å‡ºäºä¸­æ–‡è¯­éŸ³çš„è€ƒè™‘ï¼Œé€‰æ‹©äº†æ¥è‡ª &lt;code>FunAudioLLM&lt;/code> çš„ &lt;code>SenseVoiceSmall&lt;/code> æ¨¡å‹ï¼Œå®ƒä»¥å…¶å¤šè¯­ç§æ”¯æŒã€é«˜æ•ˆç‡ä»¥åŠé›†æˆçš„è¯­éŸ³ç†è§£èƒ½åŠ›ï¼ˆå¦‚æƒ…æ„Ÿè¯†åˆ«ã€äº‹ä»¶æ£€æµ‹ï¼‰å¸å¼•äº†æˆ‘ã€‚æœ¬æ–‡å°†è¯¦ç»†è®°å½•ä»ç¯å¢ƒé…ç½®ã€æ ¸å¿ƒåŠŸèƒ½å®ç°åˆ°è¸©å‘è§£å†³çš„å…¨è¿‡ç¨‹ï¼Œå¹¶åˆ†äº«ä¸€äº›å…³äºæ¨¡å‹é€‰å‹çš„æ€è€ƒã€‚&lt;/p>
&lt;p>å®Œæ•´ä»£ç å·²å¼€æºåœ¨ GitHub ä»“åº“ï¼š&lt;a href="https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall">https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall&lt;/a>&lt;/p>
&lt;p>é¡¹ç›®éœ€æ±‚æ–‡æ¡£ï¼ˆ&lt;code>prd.md&lt;/code>ï¼‰å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ¨¡å‹&lt;/strong>: FunAudioLLM/SenseVoice (å…·ä½“ä¸º &lt;code>SenseVoiceSmall&lt;/code>)&lt;/li>
&lt;li>&lt;strong>æœ¬åœ°æ¨¡å‹è·¯å¾„&lt;/strong>: &lt;code>/home/llm/model/iic/SenseVoiceSmall&lt;/code> (ä» ModelScope ä¸‹è½½)&lt;/li>
&lt;li>&lt;strong>APIæ¡†æ¶&lt;/strong>: FastAPI&lt;/li>
&lt;li>&lt;strong>Pythonç¯å¢ƒç®¡ç†&lt;/strong>: &lt;code>uv&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h2>
&lt;p>ä¸ºäº†ä¿æŒå¼€å‘ç¯å¢ƒçš„çº¯å‡€å’Œé«˜æ•ˆï¼Œé‡‡ç”¨äº† &lt;code>uv&lt;/code> æ¥ç®¡ç† Python ä¾èµ–ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ&lt;/strong> (å¦‚æœå°šæœªåˆ›å»º):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv venv .venv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>source .venv/bin/activate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>å®‰è£…æ ¸å¿ƒä¾èµ–&lt;/strong>:
åˆå§‹çš„ &lt;code>requirements.txt&lt;/code> åŒ…å«äº† &lt;code>fastapi&lt;/code>, &lt;code>uvicorn&lt;/code>, &lt;code>python-multipart&lt;/code> ç­‰åŸºç¡€åº“ã€‚åç»­æ ¹æ®æ¨¡å‹åŠ è½½å’Œå¤„ç†çš„éœ€æ±‚ï¼Œé€æ­¥æ·»åŠ äº† &lt;code>torch&lt;/code>, &lt;code>torchaudio&lt;/code>, &lt;code>numpy&lt;/code>, &lt;code>transformers&lt;/code>, &lt;code>sentencepiece&lt;/code>, ä»¥åŠæœ€ç»ˆè§£å†³æ¨¡å‹åŠ è½½é—®é¢˜çš„æ ¸å¿ƒåº“ &lt;code>funasr&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ">æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ&lt;/h2>
&lt;h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„&lt;/h3>
&lt;p>é¡¹ç›®çš„ä¸»è¦ç»“æ„åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>app/main.py&lt;/code>: FastAPI åº”ç”¨å…¥å£ï¼Œå®šä¹‰ API è·¯ç”±å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚æ¨¡å‹åŠ è½½ï¼‰ã€‚&lt;/li>
&lt;li>&lt;code>app/models/sensevoice_loader.py&lt;/code>: è´Ÿè´£åŠ è½½ &lt;code>SenseVoiceSmall&lt;/code> æ¨¡å‹ï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼ã€‚&lt;/li>
&lt;li>&lt;code>app/services/asr_service.py&lt;/code>: å°è£…è¯­éŸ³å¤„ç†å’Œæ¨¡å‹æ¨ç†çš„æ ¸å¿ƒé€»è¾‘ã€‚&lt;/li>
&lt;li>&lt;code>app/schemas.py&lt;/code>: å®šä¹‰ API çš„è¯·æ±‚å’Œå“åº”æ•°æ®æ¨¡å‹ (Pydantic models)ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="api-ç«¯ç‚¹">API ç«¯ç‚¹&lt;/h3>
&lt;p>å…³é”®çš„ API ç«¯ç‚¹è®¾è®¡ä¸ºï¼š&lt;/p></description><content:encoded><![CDATA[<h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°</h2>
<p>å®ç°ä¸€ä¸ªè¯­éŸ³è½¬å½•æ–‡æœ¬ï¼ˆASRï¼‰çš„æœåŠ¡ï¼Œç›®æ ‡æ˜¯èƒ½å¤Ÿé«˜æ•ˆåœ°å°†ç”¨æˆ·ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶è½¬æ¢ä¸ºæ–‡å­—ã€‚å‡ºäºä¸­æ–‡è¯­éŸ³çš„è€ƒè™‘ï¼Œé€‰æ‹©äº†æ¥è‡ª <code>FunAudioLLM</code> çš„ <code>SenseVoiceSmall</code> æ¨¡å‹ï¼Œå®ƒä»¥å…¶å¤šè¯­ç§æ”¯æŒã€é«˜æ•ˆç‡ä»¥åŠé›†æˆçš„è¯­éŸ³ç†è§£èƒ½åŠ›ï¼ˆå¦‚æƒ…æ„Ÿè¯†åˆ«ã€äº‹ä»¶æ£€æµ‹ï¼‰å¸å¼•äº†æˆ‘ã€‚æœ¬æ–‡å°†è¯¦ç»†è®°å½•ä»ç¯å¢ƒé…ç½®ã€æ ¸å¿ƒåŠŸèƒ½å®ç°åˆ°è¸©å‘è§£å†³çš„å…¨è¿‡ç¨‹ï¼Œå¹¶åˆ†äº«ä¸€äº›å…³äºæ¨¡å‹é€‰å‹çš„æ€è€ƒã€‚</p>
<p>å®Œæ•´ä»£ç å·²å¼€æºåœ¨ GitHub ä»“åº“ï¼š<a href="https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall">https://github.com/jackypanster/FunAudioLLM-SenseVoiceSmall</a></p>
<p>é¡¹ç›®éœ€æ±‚æ–‡æ¡£ï¼ˆ<code>prd.md</code>ï¼‰å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æ¨¡å‹</strong>: FunAudioLLM/SenseVoice (å…·ä½“ä¸º <code>SenseVoiceSmall</code>)</li>
<li><strong>æœ¬åœ°æ¨¡å‹è·¯å¾„</strong>: <code>/home/llm/model/iic/SenseVoiceSmall</code> (ä» ModelScope ä¸‹è½½)</li>
<li><strong>APIæ¡†æ¶</strong>: FastAPI</li>
<li><strong>Pythonç¯å¢ƒç®¡ç†</strong>: <code>uv</code></li>
</ul>
<h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h2>
<p>ä¸ºäº†ä¿æŒå¼€å‘ç¯å¢ƒçš„çº¯å‡€å’Œé«˜æ•ˆï¼Œé‡‡ç”¨äº† <code>uv</code> æ¥ç®¡ç† Python ä¾èµ–ã€‚</p>
<ol>
<li>
<p><strong>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</strong> (å¦‚æœå°šæœªåˆ›å»º):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uv venv .venv
</span></span><span style="display:flex;"><span>source .venv/bin/activate
</span></span></code></pre></div></li>
<li>
<p><strong>å®‰è£…æ ¸å¿ƒä¾èµ–</strong>:
åˆå§‹çš„ <code>requirements.txt</code> åŒ…å«äº† <code>fastapi</code>, <code>uvicorn</code>, <code>python-multipart</code> ç­‰åŸºç¡€åº“ã€‚åç»­æ ¹æ®æ¨¡å‹åŠ è½½å’Œå¤„ç†çš„éœ€æ±‚ï¼Œé€æ­¥æ·»åŠ äº† <code>torch</code>, <code>torchaudio</code>, <code>numpy</code>, <code>transformers</code>, <code>sentencepiece</code>, ä»¥åŠæœ€ç»ˆè§£å†³æ¨¡å‹åŠ è½½é—®é¢˜çš„æ ¸å¿ƒåº“ <code>funasr</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uv pip install -r requirements.txt
</span></span></code></pre></div></li>
</ol>
<h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ">æ ¸å¿ƒåŠŸèƒ½å®ç°æ¦‚è§ˆ</h2>
<h3 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h3>
<p>é¡¹ç›®çš„ä¸»è¦ç»“æ„åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>app/main.py</code>: FastAPI åº”ç”¨å…¥å£ï¼Œå®šä¹‰ API è·¯ç”±å’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆå¦‚æ¨¡å‹åŠ è½½ï¼‰ã€‚</li>
<li><code>app/models/sensevoice_loader.py</code>: è´Ÿè´£åŠ è½½ <code>SenseVoiceSmall</code> æ¨¡å‹ï¼Œé‡‡ç”¨å•ä¾‹æ¨¡å¼ã€‚</li>
<li><code>app/services/asr_service.py</code>: å°è£…è¯­éŸ³å¤„ç†å’Œæ¨¡å‹æ¨ç†çš„æ ¸å¿ƒé€»è¾‘ã€‚</li>
<li><code>app/schemas.py</code>: å®šä¹‰ API çš„è¯·æ±‚å’Œå“åº”æ•°æ®æ¨¡å‹ (Pydantic models)ã€‚</li>
</ul>
<h3 id="api-ç«¯ç‚¹">API ç«¯ç‚¹</h3>
<p>å…³é”®çš„ API ç«¯ç‚¹è®¾è®¡ä¸ºï¼š</p>
<h4 id="post-asr_pure">POST /asr_pure</h4>
<ul>
<li><strong>Content-Type</strong>: <code>multipart/form-data</code></li>
<li><strong>Body</strong>: <code>file</code> (éŸ³é¢‘æ–‡ä»¶)</li>
</ul>
<p>è¿”å›è½¬å½•åçš„æ–‡æœ¬åŠå¤„ç†æ—¶é—´ã€‚</p>
<h2 id="è¸©å‘ä¸è§£å†³ä¹‹è·¯æ¨¡å‹åŠ è½½çš„æ›²æŠ˜å†ç¨‹">è¸©å‘ä¸è§£å†³ä¹‹è·¯ï¼šæ¨¡å‹åŠ è½½çš„æ›²æŠ˜å†ç¨‹</h2>
<p>åœ¨é¡¹ç›®æ¨è¿›è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹åŠ è½½éƒ¨åˆ†æ˜¯é‡åˆ°é—®é¢˜æœ€å¤šçš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æ”¶è·æœ€å¤šçš„åœ°æ–¹ã€‚</p>
<h3 id="å‘1hugging-face-autoclass-çš„-unrecognized-model">å‘1ï¼šHugging Face <code>AutoClass</code> çš„ &ldquo;Unrecognized model&rdquo;</h3>
<p>æœ€åˆï¼Œå°è¯•ä½¿ç”¨ Hugging Face <code>transformers</code> åº“é€šç”¨çš„ <code>AutoProcessor.from_pretrained()</code> å’Œ <code>AutoModelForSpeechSeq2Seq.from_pretrained()</code> æ¥åŠ è½½æœ¬åœ°çš„ <code>SenseVoiceSmall</code> æ¨¡å‹æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># app/models/sensevoice_loader.py (æ—©æœŸå°è¯•)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># from transformers import AutoModelForSpeechSeq2Seq, AutoProcessor</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># self.processor = AutoProcessor.from_pretrained(MODEL_PATH)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># self.model = AutoModelForSpeechSeq2Seq.from_pretrained(MODEL_PATH)</span>
</span></span></code></pre></div><p>ç„¶è€Œï¼ŒæœåŠ¡å¯åŠ¨æ—¶ç«‹å³æŠ¥é”™ï¼š</p>
<pre tabindex="0"><code>ValueError: Unrecognized model in /home/llm/model/iic/SenseVoiceSmall. Should have a model_type key in its config.json...
</code></pre><p>è¿™ä¸ªé”™è¯¯è¡¨æ˜ <code>transformers</code> çš„è‡ªåŠ¨å‘ç°æœºåˆ¶æ— æ³•è¯†åˆ«æ¨¡å‹ç±»å‹ï¼Œé€šå¸¸æ˜¯å› ä¸ºæ¨¡å‹ç›®å½•ä¸‹çš„ <code>config.json</code> æ–‡ä»¶ç¼ºå°‘ <code>model_type</code> å­—æ®µï¼Œæˆ–è€…è¯¥æ¨¡å‹éœ€è¦ç‰¹å®šçš„åŠ è½½ç±»ã€‚</p>
<h3 id="å‘2è½¬å‘-funasr-ä¸-trust_remote_code-çš„åˆæ­¥æ¢ç´¢">å‘2ï¼šè½¬å‘ <code>funasr</code> ä¸ <code>trust_remote_code</code> çš„åˆæ­¥æ¢ç´¢</h3>
<p>æŸ¥é˜… <code>FunAudioLLM/SenseVoice</code> çš„å®˜æ–¹æ–‡æ¡£åå‘ç°ï¼Œæ¨èä½¿ç”¨ <code>funasr</code> åº“çš„ <code>AutoModel</code> æ¥åŠ è½½ <code>SenseVoice</code> ç³»åˆ—æ¨¡å‹ã€‚äºæ˜¯è°ƒæ•´äº†ä»£ç ï¼š</p>
<ol>
<li><strong>æ·»åŠ  <code>funasr</code> åˆ° <code>requirements.txt</code></strong>ã€‚</li>
<li><strong>ä¿®æ”¹ <code>SenseVoiceLoader</code></strong>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># app/models/sensevoice_loader.py (å¼•å…¥ funasr)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> funasr <span style="color:#f92672">import</span> AutoModel
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> AutoModel(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>FUNASR_MODEL_NAME_OR_PATH, <span style="color:#75715e"># å³æœ¬åœ°è·¯å¾„</span>
</span></span><span style="display:flex;"><span>    trust_remote_code<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    device<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>device
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div>åŒæ—¶ï¼Œ<code>asr_service.py</code> ä¸­çš„æ¨ç†é€»è¾‘ä¹Ÿç›¸åº”è°ƒæ•´ä¸ºè°ƒç”¨ <code>funasr</code> æ¨¡å‹å¯¹è±¡çš„ <code>.generate()</code> æ–¹æ³•ã€‚</li>
</ol>
<p>æœ¬ä»¥ä¸ºè¿™æ ·èƒ½è§£å†³é—®é¢˜ï¼Œä½†å¯åŠ¨æ—¶åˆé‡åˆ°äº†æ–°çš„æ—¥å¿—ï¼š</p>
<pre tabindex="0"><code>Loading remote code failed: model, No module named &#39;model&#39;
</code></pre><p>å°½ç®¡è¿™æ¡æ—¥å¿—å‡ºç°ï¼Œä½†åç»­çš„ API è°ƒç”¨æµ‹è¯•å±…ç„¶æˆåŠŸäº†ï¼è¿™è®©æˆ‘éå¸¸å›°æƒ‘ã€‚</p>
<h3 id="å‘3remote_code-å‚æ•°ä¸-modelpy-æ–‡ä»¶çš„å¹»å½±">å‘3ï¼š<code>remote_code</code> å‚æ•°ä¸ <code>model.py</code> æ–‡ä»¶çš„â€œå¹»å½±â€</h3>
<p>æ·±å…¥ç ”ç©¶ <code>funasr</code> å’Œ <code>SenseVoice</code> çš„æ–‡æ¡£ï¼Œæ³¨æ„åˆ°å¯¹äºåŒ…å«è‡ªå®šä¹‰ä»£ç ï¼ˆå¦‚ <code>model.py</code>ï¼‰çš„æ¨¡å‹ï¼Œé™¤äº† <code>trust_remote_code=True</code>ï¼Œæœ‰æ—¶è¿˜éœ€è¦æ˜ç¡®æŒ‡å®š <code>remote_code</code> å‚æ•°ã€‚</p>
<p>æˆ‘æ£€æŸ¥äº† Hugging Face ä»“åº“ <code>FunAudioLLM/SenseVoiceSmall</code> (<a href="https://huggingface.co/FunAudioLLM/SenseVoiceSmall/tree/main">https://huggingface.co/FunAudioLLM/SenseVoiceSmall/tree/main</a>)ï¼Œå‘ç°å…¶æ–‡ä»¶åˆ—è¡¨ä¸­ç¡®å®åŒ…å«ä¸€ä¸ª <code>model.py</code>ã€‚å› æ­¤ï¼Œæˆ‘å°è¯•åœ¨ <code>AutoModel</code> è°ƒç”¨ä¸­åŠ å…¥ <code>remote_code=&quot;model.py&quot;</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># app/models/sensevoice_loader.py (å°è¯•æŒ‡å®š remote_code)</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> AutoModel(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>FUNASR_MODEL_NAME_OR_PATH,
</span></span><span style="display:flex;"><span>    trust_remote_code<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    remote_code<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;model.py&#34;</span>, <span style="color:#75715e"># &lt;--- æ–°å¢</span>
</span></span><span style="display:flex;"><span>    device<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>device
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>ç»“æœï¼Œ<code>No module named 'model'</code> çš„é”™è¯¯ä¾æ—§ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆæ¾„æ¸…-modelscope-ä¸-hugging-face-çš„æ¨¡å‹æ–‡ä»¶å·®å¼‚">è§£å†³æ–¹æ¡ˆï¼šæ¾„æ¸… ModelScope ä¸ Hugging Face çš„æ¨¡å‹æ–‡ä»¶å·®å¼‚</h3>
<p>æœ¬åœ°æ¨¡å‹ <code>/home/llm/model/iic/SenseVoiceSmall</code> æ˜¯ä» <strong>ModelScope</strong> (<a href="https://www.modelscope.cn/models/iic/SenseVoiceSmall/files">https://www.modelscope.cn/models/iic/SenseVoiceSmall/files</a>) ä¸‹è½½çš„ï¼Œè€Œéç›´æ¥ clone Hugging Face çš„ä»“åº“ã€‚é€šè¿‡ <code>ls -al /home/llm/model/iic/SenseVoiceSmall/</code> æŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ï¼Œ<strong>å‘ç°ç¡®å®æ²¡æœ‰ <code>model.py</code> æ–‡ä»¶ï¼</strong></p>
<p>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæŒ‡å®š <code>remote_code=&quot;model.py&quot;</code> ä¾ç„¶æŠ¥é”™ã€‚ModelScope æä¾›çš„æ¨¡å‹åŒ…å¯èƒ½ä¸ Hugging Face ä»“åº“ä¸­çš„æ–‡ä»¶ç»“æ„ä¸å®Œå…¨ä¸€è‡´ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè¿™ç§ä¾èµ– <code>funasr</code> ç‰¹å®šåŠ è½½æ–¹å¼çš„æ¨¡å‹ã€‚</p>
<p><strong>æœ€ç»ˆçš„æ­£ç¡®é…ç½®</strong>ï¼šç§»é™¤ <code>remote_code</code> å‚æ•°ï¼Œä½†ä¿ç•™ <code>trust_remote_code=True</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># app/models/sensevoice_loader.py (æœ€ç»ˆæ­£ç¡®é…ç½®)</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>model <span style="color:#f92672">=</span> AutoModel(
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>FUNASR_MODEL_NAME_OR_PATH,
</span></span><span style="display:flex;"><span>    trust_remote_code<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, <span style="color:#75715e"># ä¿ç•™ï¼Œfunasr å¯èƒ½ä»éœ€æ­¤æƒé™å¤„ç† ModelScope æ¨¡å‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># remote_code=&#34;model.py&#34;, # ç§»é™¤ï¼Œå› ä¸ºæœ¬åœ° ModelScope ç‰ˆæœ¬æ— æ­¤æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    device<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>device
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>è¿™æ ·ä¿®æ”¹åï¼ŒæœåŠ¡å¯åŠ¨æ—¶ä»ç„¶ä¼šæ‰“å° <code>Loading remote code failed: model, No module named 'model'</code>ï¼Œä½† API è°ƒç”¨å®Œå…¨æ­£å¸¸ï¼</p>
<p><strong>åŸå› åˆ†æ</strong>ï¼š<code>funasr</code> åœ¨ <code>trust_remote_code=True</code> æ—¶ï¼Œä¼šä¼˜å…ˆå°è¯•åŠ è½½è‡ªå®šä¹‰ä»£ç ã€‚å¦‚æœæœ¬åœ°æ¨¡å‹è·¯å¾„ï¼ˆå¦‚ä» ModelScope ä¸‹è½½çš„ï¼‰æ²¡æœ‰ <code>model.py</code>ï¼Œè¿™ä¸ªå°è¯•ä¼šå¤±è´¥å¹¶æ‰“å°æ—¥å¿—ã€‚ä½†éšåï¼Œ<code>funasr</code> èƒ½å¤Ÿè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ ModelScope æ¨¡å‹è·¯å¾„ï¼Œå¹¶è½¬ç”¨å…¶å†…éƒ¨çš„æ ‡å‡†åŠ è½½æµç¨‹æˆåŠŸåŠ è½½æ¨¡å‹ã€‚å› æ­¤ï¼Œè¯¥æ—¥å¿—åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯è‰¯æ€§çš„ã€‚</p>
<h2 id="æ¨¡å‹å¯¹æ¯”ä¸é€‰å‹æ€è€ƒ">æ¨¡å‹å¯¹æ¯”ä¸é€‰å‹æ€è€ƒ</h2>
<p>åœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ¢è®¨äº† <code>FunAudioLLM/SenseVoiceSmall</code> ä¸å…¶ä»–ä¸»æµ ASR æ¨¡å‹çš„å¯¹æ¯”ï¼š</p>
<ul>
<li>
<p><strong>OpenAI Whisper ç³»åˆ—</strong> (å¦‚ <code>whisper-large-v3</code>):</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>: æé«˜çš„å‡†ç¡®ç‡ï¼Œå¼ºå¤§çš„å¤šè¯­è¨€èƒ½åŠ›ï¼Œåºå¤§çš„ç¤¾åŒºã€‚</li>
<li><strong>åŠ£åŠ¿</strong>: æ¨ç†é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼ˆå°¤å…¶å¤§æ¨¡å‹ï¼‰ï¼Œä¸ç›´æ¥æä¾›æƒ…æ„Ÿ/äº‹ä»¶æ£€æµ‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>Wav2Vec2 ç³»åˆ—</strong>:</p>
<ul>
<li><strong>ä¼˜åŠ¿</strong>: è‡ªç›‘ç£å­¦ä¹ å…¸èŒƒï¼Œå¤§é‡ç‰¹å®šè¯­è¨€å¾®è°ƒæ¨¡å‹ã€‚</li>
<li><strong>åŠ£åŠ¿</strong>: åŸºç¡€æ¨¡å‹åŠŸèƒ½ç›¸å¯¹å•ä¸€ã€‚</li>
</ul>
</li>
</ul>
<h3 id="sensevoicesmall"><strong><code>SenseVoiceSmall</code> çš„æ ¸å¿ƒä¼˜åŠ¿</strong></h3>
<ol>
<li>
<p><strong>é«˜æ•ˆæ¨ç†</strong>ï¼šå…¶æ¨¡å‹å¡å£°ç§°é‡‡ç”¨éè‡ªå›å½’ç«¯åˆ°ç«¯æ¡†æ¶ï¼Œæ¯” Whisper-Large å¿«15å€ã€‚è¿™å¯¹äºéœ€è¦ä½å»¶è¿Ÿçš„åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
</li>
<li>
<p><strong>å¤šä»»åŠ¡é›†æˆ</strong>ï¼šå†…ç½® ASRã€LIDï¼ˆè¯­ç§è¯†åˆ«ï¼‰ã€SERï¼ˆæƒ…æ„Ÿè¯†åˆ«ï¼‰ã€AEDï¼ˆäº‹ä»¶æ£€æµ‹ï¼‰ã€‚å¦‚æœåº”ç”¨åœºæ™¯éœ€è¦è¿™äº›é™„åŠ ä¿¡æ¯ï¼Œ<code>SenseVoiceSmall</code> æä¾›äº†ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li>
<p><strong>ç‰¹å®šè¯­è¨€ä¼˜åŒ–</strong>ï¼šåœ¨ä¸­æ–‡ã€ç²¤è¯­ç­‰è¯­è¨€ä¸Šè¡¨ç°çªå‡ºã€‚</p>
</li>
</ol>
<h3 id="ç»“è®º"><strong>ç»“è®º</strong></h3>
<p>æ²¡æœ‰ç»å¯¹çš„â€œæœ€å¥½â€ï¼Œåªæœ‰â€œæœ€é€‚åˆâ€ã€‚</p>
<ul>
<li>è‹¥è¿½æ±‚æè‡´å‡†ç¡®æ€§å’Œæœ€å¹¿è¯­è¨€è¦†ç›–ï¼Œä¸”å¯¹å»¶è¿Ÿä¸æ•æ„Ÿï¼ŒWhisper ä»æ˜¯é¦–é€‰ã€‚</li>
<li>è‹¥å¯¹<strong>æ¨ç†æ•ˆç‡ã€é›†æˆçš„å¤šä»»åŠ¡è¯­éŸ³ç†è§£ï¼ˆç‰¹åˆ«æ˜¯æƒ…æ„Ÿ/äº‹ä»¶ï¼‰æˆ–ä¸­æ–‡ç­‰ç‰¹å®šåœºæ™¯æœ‰é«˜è¦æ±‚</strong>ï¼Œ<code>SenseVoiceSmall</code> æ˜¯ä¸€ä¸ªæå…·ç«äº‰åŠ›çš„é€‰æ‹©ã€‚</li>
</ul>
<p>ç›®å‰é€‰æ‹©çš„ <code>SenseVoiceSmall</code>ï¼Œå°¤å…¶æ˜¯åœ¨ç¡®è®¤äº†å…¶ ModelScope ç‰ˆæœ¬èƒ½å¤Ÿé¡ºç•…è¿è¡Œåï¼Œå¯¹äºæˆ‘çš„é¡¹ç›®ç›®æ ‡æ¥è¯´æ˜¯ä¸€ä¸ªåˆé€‚çš„èµ·ç‚¹ã€‚</p>
<h2 id="å½“å‰çŠ¶æ€ä¸å±•æœ›">å½“å‰çŠ¶æ€ä¸å±•æœ›</h2>
<p>ç›®å‰ï¼ŒåŸºäº <code>FunAudioLLM/SenseVoiceSmall</code> å’Œ FastAPI çš„è¯­éŸ³è½¬å½•æœåŠ¡å·²æˆåŠŸæ­å»ºå¹¶èƒ½æ­£ç¡®å¤„ç†è¯·æ±‚ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl -X POST <span style="color:#e6db74">&#34;http://&lt;your_server_ip&gt;:8888/asr_pure&#34;</span> -F <span style="color:#e6db74">&#34;file=@test_audio.wav&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;text&#34;</span>:<span style="color:#e6db74">&#34;å¤ªå¥½äº†ï¼Œé‚£æ¥ä¸‹æ¥å’±ä»¬å¯ä»¥è¯•è¯•å…¶ä»–åŠŸèƒ½äº†ã€‚æ¯”å¦‚è¯´ä½ æƒ³æµ‹è¯•ä¸€ä¸‹è¯­éŸ³åˆæˆçš„æ•ˆæœæ€ä¹ˆæ ·ï¼Œæˆ–è€…æ˜¯çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆæ–°çš„è¯­éŸ³å¤„ç†åŠŸèƒ½å‡ºæ¥å•¦ã€‚ğŸ˜”&#34;</span>,<span style="color:#e6db74">&#34;status&#34;</span>:<span style="color:#e6db74">&#34;success&#34;</span>,<span style="color:#e6db74">&#34;processing_time_ms&#34;</span>:503.39...<span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="åç»­å¯ä¼˜åŒ–çš„æ–¹å‘"><strong>åç»­å¯ä¼˜åŒ–çš„æ–¹å‘</strong></h3>
<ul>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šè¿›ä¸€æ­¥æµ‹è¯•å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œè€ƒè™‘å¤š worker é…ç½®ã€‚</li>
<li><strong>é”™è¯¯å¤„ç†ä¸æ—¥å¿—</strong>ï¼šå®Œå–„æ›´ç»†è‡´çš„é”™è¯¯æ•è·å’Œæ—¥å¿—è®°å½•ã€‚</li>
<li><strong>åŠŸèƒ½æ‰©å±•</strong>ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥åˆ©ç”¨ <code>SenseVoiceSmall</code> çš„æƒ…æ„Ÿè¯†åˆ«å’Œäº‹ä»¶æ£€æµ‹èƒ½åŠ›ã€‚</li>
<li><strong>VAD é›†æˆ</strong>ï¼šå¯¹äºé•¿éŸ³é¢‘ï¼Œè€ƒè™‘åœ¨ <code>funasr.AutoModel</code> åŠ è½½æ—¶é›†æˆ VAD (Voice Activity Detection) åŠŸèƒ½ï¼Œä»¥å®ç°è‡ªåŠ¨åˆ†æ®µå¤„ç†ï¼Œæå‡é•¿éŸ³é¢‘å¤„ç†çš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚</li>
<li><strong>å¼‚æ­¥å¤„ç†ä¸é˜Ÿåˆ—</strong>ï¼šå¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—å’Œå¼‚æ­¥ä»»åŠ¡å¤„ç†ã€‚</li>
</ul>
]]></content:encoded></item><item><title>å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)</title><link>https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/</link><pubDate>Tue, 20 May 2025 20:24:06 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/how-to-use-qwen-omni-tts-asr/</guid><description>&lt;h1 id="å¦‚ä½•ä½¿ç”¨qwen25-omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³ttså’Œè¯­éŸ³è½¬æ–‡æœ¬asr">å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)&lt;/h1>
&lt;h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬é¡¹ç›®åŸºäºQwen2.5-Omni-7Bæ¨¡å‹ï¼Œå®ç°äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š&lt;/p>
&lt;ol>
&lt;li>æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³&lt;/li>
&lt;li>è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ï¼šå°†è¯­éŸ³æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒæ ‡å‡†ASRå’Œçº¯ASRä¸¤ç§æ¨¡å¼&lt;/li>
&lt;/ol>
&lt;p>é¡¹ç›®åœ°å€ï¼š&lt;a href="https://github.com/jackypanster/qwen-omni">https://github.com/jackypanster/qwen-omni&lt;/a>&lt;/p>
&lt;h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®&lt;/h2>
&lt;p>æ¨èä½¿ç”¨condaç®¡ç†Pythonç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–å®‰è£…çš„ç¨³å®šæ€§ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda create -n qwen-tts python&lt;span style="color:#f92672">=&lt;/span>3.10
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda activate qwen-tts
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®‰è£…PyTorchï¼ˆGPUç‰ˆæœ¬ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install pytorch&lt;span style="color:#f92672">=&lt;/span>2.5.1 pytorch-cuda&lt;span style="color:#f92672">=&lt;/span>12.1 -c pytorch -c nvidia
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install torchvision torchaudio -c pytorch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># å®‰è£…å…¶ä»–ä¾èµ–&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>conda install streamlit python-soundfile -c conda-forge
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pip install git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pip install qwen-omni-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°">æ ¸å¿ƒåŠŸèƒ½å®ç°&lt;/h2>
&lt;h3 id="1-æ–‡æœ¬è½¬è¯­éŸ³tts">1. æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">text_to_speech&lt;/span>(text_input, output_audio_path&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;output/output.wav&amp;#34;&lt;/span>, speaker&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniForConditionalGeneration&lt;span style="color:#f92672">.&lt;/span>from_pretrained(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">=&lt;/span>config,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> torch_dtype&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> device_map&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processor &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniProcessor&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># æ„é€ å¯¹è¯&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;You are Qwen...&amp;#34;&lt;/span>}]},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: text_input}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç”Ÿæˆè¯­éŸ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids, audio &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>speaker,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> temperature&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.8&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top_p&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.95&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="2-è¯­éŸ³è½¬æ–‡æœ¬asr">2. è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">audio_to_text&lt;/span>(audio_path: str) &lt;span style="color:#f92672">-&amp;gt;&lt;/span> str:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># æ ‡å‡†ASRæ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;ä½ æ˜¯Qwen...&amp;#34;&lt;/span>}]},
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;audio&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;audio&amp;#34;&lt;/span>: audio_path}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç”Ÿæˆæ–‡æœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return_audio&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="webç•Œé¢å®ç°">Webç•Œé¢å®ç°&lt;/h2>
&lt;p>ä½¿ç”¨Streamlitæ„å»ºäº†ç®€æ´çš„Webç•Œé¢ï¼š&lt;/p></description><content:encoded><![CDATA[<h1 id="å¦‚ä½•ä½¿ç”¨qwen25-omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³ttså’Œè¯­éŸ³è½¬æ–‡æœ¬asr">å¦‚ä½•ä½¿ç”¨Qwen2.5-Omniå®ç°æ–‡æœ¬è½¬è¯­éŸ³(TTS)å’Œè¯­éŸ³è½¬æ–‡æœ¬(ASR)</h1>
<h2 id="é¡¹ç›®æ¦‚è¿°">é¡¹ç›®æ¦‚è¿°</h2>
<p>æœ¬é¡¹ç›®åŸºäºQwen2.5-Omni-7Bæ¨¡å‹ï¼Œå®ç°äº†ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ol>
<li>æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³</li>
<li>è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰ï¼šå°†è¯­éŸ³æ–‡ä»¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒæ ‡å‡†ASRå’Œçº¯ASRä¸¤ç§æ¨¡å¼</li>
</ol>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/jackypanster/qwen-omni">https://github.com/jackypanster/qwen-omni</a></p>
<h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h2>
<p>æ¨èä½¿ç”¨condaç®¡ç†Pythonç¯å¢ƒï¼Œç¡®ä¿ä¾èµ–å®‰è£…çš„ç¨³å®šæ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºå¹¶æ¿€æ´»ç¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>conda create -n qwen-tts python<span style="color:#f92672">=</span>3.10
</span></span><span style="display:flex;"><span>conda activate qwen-tts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…PyTorchï¼ˆGPUç‰ˆæœ¬ï¼‰</span>
</span></span><span style="display:flex;"><span>conda install pytorch<span style="color:#f92672">=</span>2.5.1 pytorch-cuda<span style="color:#f92672">=</span>12.1 -c pytorch -c nvidia
</span></span><span style="display:flex;"><span>conda install torchvision torchaudio -c pytorch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…å…¶ä»–ä¾èµ–</span>
</span></span><span style="display:flex;"><span>conda install streamlit python-soundfile -c conda-forge
</span></span><span style="display:flex;"><span>pip install git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
</span></span><span style="display:flex;"><span>pip install qwen-omni-utils
</span></span></code></pre></div><h2 id="æ ¸å¿ƒåŠŸèƒ½å®ç°">æ ¸å¿ƒåŠŸèƒ½å®ç°</h2>
<h3 id="1-æ–‡æœ¬è½¬è¯­éŸ³tts">1. æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">text_to_speech</span>(text_input, output_audio_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output/output.wav&#34;</span>, speaker<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Chelsie&#34;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åŠ è½½æ¨¡å‹å’Œå¤„ç†å™¨</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> Qwen2_5OmniForConditionalGeneration<span style="color:#f92672">.</span>from_pretrained(
</span></span><span style="display:flex;"><span>        model_path, 
</span></span><span style="display:flex;"><span>        config<span style="color:#f92672">=</span>config, 
</span></span><span style="display:flex;"><span>        torch_dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auto&#34;</span>, 
</span></span><span style="display:flex;"><span>        device_map<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auto&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    processor <span style="color:#f92672">=</span> Qwen2_5OmniProcessor<span style="color:#f92672">.</span>from_pretrained(model_path)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ„é€ å¯¹è¯</span>
</span></span><span style="display:flex;"><span>    conversation <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: [{<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;You are Qwen...&#34;</span>}]},
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: [{<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: text_input}]}
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç”Ÿæˆè¯­éŸ³</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>        text_ids, audio <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>generate(
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">**</span>inputs,
</span></span><span style="display:flex;"><span>            speaker<span style="color:#f92672">=</span>speaker,
</span></span><span style="display:flex;"><span>            do_sample<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>            temperature<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>,
</span></span><span style="display:flex;"><span>            top_p<span style="color:#f92672">=</span><span style="color:#ae81ff">0.95</span>,
</span></span><span style="display:flex;"><span>            max_new_tokens<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><h3 id="2-è¯­éŸ³è½¬æ–‡æœ¬asr">2. è¯­éŸ³è½¬æ–‡æœ¬ï¼ˆASRï¼‰</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">audio_to_text</span>(audio_path: str) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ ‡å‡†ASRæ¨¡å¼</span>
</span></span><span style="display:flex;"><span>    conversation <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: [{<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;ä½ æ˜¯Qwen...&#34;</span>}]},
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: [{<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;audio&#34;</span>, <span style="color:#e6db74">&#34;audio&#34;</span>: audio_path}]}
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç”Ÿæˆæ–‡æœ¬</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>        text_ids <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>generate(
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">**</span>inputs,
</span></span><span style="display:flex;"><span>            do_sample<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>            max_new_tokens<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>,
</span></span><span style="display:flex;"><span>            return_audio<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><h2 id="webç•Œé¢å®ç°">Webç•Œé¢å®ç°</h2>
<p>ä½¿ç”¨Streamlitæ„å»ºäº†ç®€æ´çš„Webç•Œé¢ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># æ–‡æœ¬è¾“å…¥</span>
</span></span><span style="display:flex;"><span>text_input <span style="color:#f92672">=</span> st<span style="color:#f92672">.</span>text_area(<span style="color:#e6db74">&#34;è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬ï¼š&#34;</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">120</span>, max_chars<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘éŸ³äººé€‰æ‹©</span>
</span></span><span style="display:flex;"><span>speaker <span style="color:#f92672">=</span> st<span style="color:#f92672">.</span>selectbox(<span style="color:#e6db74">&#34;è¯·é€‰æ‹©å‘éŸ³äººï¼š&#34;</span>, [<span style="color:#e6db74">&#34;Chelsie&#34;</span>, <span style="color:#e6db74">&#34;Ethan&#34;</span>], index<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç”ŸæˆæŒ‰é’®</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> st<span style="color:#f92672">.</span>button(<span style="color:#e6db74">&#34;ç”Ÿæˆè¯­éŸ³&#34;</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç”Ÿæˆè¯­éŸ³å¹¶æ’­æ”¾</span>
</span></span><span style="display:flex;"><span>    audio_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(OUTPUT_DIR, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;tts_</span><span style="color:#e6db74">{</span>uuid<span style="color:#f92672">.</span>uuid4()<span style="color:#f92672">.</span>hex<span style="color:#e6db74">}</span><span style="color:#e6db74">.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    text_to_speech(text_input, output_audio_path<span style="color:#f92672">=</span>audio_path, speaker<span style="color:#f92672">=</span>speaker)
</span></span><span style="display:flex;"><span>    st<span style="color:#f92672">.</span>audio(audio_path, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;audio/wav&#34;</span>)
</span></span></code></pre></div><h2 id="restful-apiå®ç°">RESTful APIå®ç°</h2>
<p>ä½¿ç”¨FastAPIæ„å»ºäº†RESTful APIæ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#34;/tts&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tts</span>(request: TTSRequest):
</span></span><span style="display:flex;"><span>    audio_filename <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;tts_</span><span style="color:#e6db74">{</span>uuid<span style="color:#f92672">.</span>uuid4()<span style="color:#f92672">.</span>hex<span style="color:#e6db74">}</span><span style="color:#e6db74">.wav&#34;</span>
</span></span><span style="display:flex;"><span>    audio_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(OUTPUT_DIR, audio_filename)
</span></span><span style="display:flex;"><span>    text_to_speech(request<span style="color:#f92672">.</span>text, audio_path, request<span style="color:#f92672">.</span>speaker)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;audio_url&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;/output/</span><span style="color:#e6db74">{</span>audio_filename<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.post</span>(<span style="color:#e6db74">&#34;/asr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">asr</span>(file: UploadFile <span style="color:#f92672">=</span> File(<span style="color:#f92672">...</span>)):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># å¤„ç†ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>    audio_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(OUTPUT_DIR, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;asr_</span><span style="color:#e6db74">{</span>uuid<span style="color:#f92672">.</span>uuid4()<span style="color:#f92672">.</span>hex<span style="color:#e6db74">}</span><span style="color:#e6db74">.wav&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(audio_path, <span style="color:#e6db74">&#34;wb&#34;</span>) <span style="color:#66d9ef">as</span> buffer:
</span></span><span style="display:flex;"><span>        shutil<span style="color:#f92672">.</span>copyfileobj(file<span style="color:#f92672">.</span>file, buffer)
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> audio_to_text(audio_path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;text&#34;</span>: text}
</span></span></code></pre></div><h2 id="ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</h2>
<ol>
<li>å¯åŠ¨Webç•Œé¢ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>streamlit run app_text2audio.py
</span></span></code></pre></div><ol start="2">
<li>å¯åŠ¨APIæœåŠ¡ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uvicorn fastapi_app:app --host 0.0.0.0 --port <span style="color:#ae81ff">8000</span>
</span></span></code></pre></div><h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>æ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼Œå»ºè®®æå‰ä¸‹è½½å¹¶é…ç½®å¥½æ¨¡å‹è·¯å¾„</li>
<li>ä½¿ç”¨condaå®‰è£…ä¾èµ–å¯ä»¥é¿å…å¤§å¤šæ•°ç¯å¢ƒé—®é¢˜</li>
<li>éŸ³é¢‘æ–‡ä»¶ä¼šä¿å­˜åœ¨outputç›®å½•ä¸‹</li>
<li>APIæ¥å£æ”¯æŒæ–‡ä»¶ä¸Šä¼ å’Œæ–‡æœ¬è½¬å†™</li>
</ol>
<h2 id="åç»­ä¼˜åŒ–æ–¹å‘">åç»­ä¼˜åŒ–æ–¹å‘</h2>
<ol>
<li>æ”¯æŒæ›´å¤šå‘éŸ³äººé€‰é¡¹</li>
<li>ä¼˜åŒ–æ¨¡å‹åŠ è½½é€Ÿåº¦</li>
<li>æ·»åŠ æ‰¹é‡å¤„ç†åŠŸèƒ½</li>
<li>æ”¯æŒæ›´å¤šéŸ³é¢‘æ ¼å¼</li>
<li>æ·»åŠ å†å²è®°å½•åŠŸèƒ½</li>
</ol>
<h2 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://huggingface.co/Qwen/Qwen2.5-Omni-7B">Qwen2.5-Omni-7Bå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://docs.streamlit.io/">Streamlitæ–‡æ¡£</a></li>
<li><a href="https://fastapi.tiangolo.com/">FastAPIæ–‡æ¡£</a></li>
</ul>
]]></content:encoded></item><item><title>Qwen2.5-Omni-7B æ–‡æœ¬è½¬è¯­éŸ³éƒ¨ç½²æŒ‡å—</title><link>https://jackypanster.github.io/ai-stream/posts/how-to-setup-qwen-omni/</link><pubDate>Mon, 19 May 2025 10:54:50 +0800</pubDate><guid>https://jackypanster.github.io/ai-stream/posts/how-to-setup-qwen-omni/</guid><description>&lt;p>&lt;img alt="Qwen2.5-Omni-7B TTS" loading="lazy" src="https://via.placeholder.com/800x400.png/007bff/ffffff?text=Qwen2.5-Omni-7B+TTS">&lt;/p>
&lt;h2 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h2>
&lt;p>æœ¬è„šæœ¬åŸºäº Qwen2.5-Omni-7B å¤šæ¨¡æ€æ¨¡å‹å®ç°æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰åŠŸèƒ½ï¼Œæ”¯æŒç”Ÿæˆè‡ªç„¶æµç•…çš„ä¸­æ–‡ / è‹±æ–‡è¯­éŸ³ï¼Œå¹¶æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹ï¼ˆå¥³æ€§ â€œChelsieâ€ã€ç”·æ€§ â€œEthanâ€ï¼‰ã€‚è„šæœ¬å¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼ˆ.wavæ ¼å¼ï¼‰ï¼Œé€‚ç”¨äºè¯­éŸ³åŠ©æ‰‹ã€å†…å®¹åˆ›ä½œã€æ— éšœç¢æœåŠ¡ç­‰åœºæ™¯ã€‚&lt;/p>
&lt;h2 id="ä¸»è¦ç‰¹æ€§">ä¸»è¦ç‰¹æ€§&lt;/h2>
&lt;ul>
&lt;li>ğŸ™ï¸ æ”¯æŒè‡ªç„¶æµç•…çš„ &lt;strong>ä¸­æ–‡/è‹±æ–‡&lt;/strong> è¯­éŸ³åˆæˆ&lt;/li>
&lt;li>ğŸ‘¥ æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹é€‰æ‹©ï¼š
&lt;ul>
&lt;li>å¥³æ€§å£°çº¿ï¼š&amp;ldquo;Chelsie&amp;rdquo;&lt;/li>
&lt;li>ç”·æ€§å£°çº¿ï¼š&amp;ldquo;Ethan&amp;rdquo;&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ğŸ’¾ è¾“å‡ºæ ¼å¼ï¼šæ ‡å‡† &lt;code>.wav&lt;/code> éŸ³é¢‘æ–‡ä»¶&lt;/li>
&lt;li>ğŸš€ é«˜æ€§èƒ½æ¨ç†ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ&lt;/li>
&lt;/ul>
&lt;h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯&lt;/h2>
&lt;ul>
&lt;li>æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹å¼€å‘&lt;/li>
&lt;li>å†…å®¹åˆ›ä½œä¸æ’­å®¢åˆ¶ä½œ&lt;/li>
&lt;li>æ— éšœç¢æœåŠ¡&lt;/li>
&lt;li>æ•™è‚²ç±»åº”ç”¨&lt;/li>
&lt;li>å¤šåª’ä½“å†…å®¹ç”Ÿæˆ&lt;/li>
&lt;/ul>
&lt;h2 id="å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨&lt;/h2>
&lt;blockquote>
&lt;p>ğŸ’¡ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š&lt;/p>
&lt;ul>
&lt;li>Python 3.8+&lt;/li>
&lt;li>CUDA 11.7+ (å¦‚éœ€GPUåŠ é€Ÿ)&lt;/li>
&lt;li>è‡³å°‘16GBå¯ç”¨å†…å­˜&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;p>å®‰è£…ä¾èµ–åº“&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>uv init
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add accelerate
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add qwen-omni-utils&lt;span style="color:#f92672">[&lt;/span>decord&lt;span style="color:#f92672">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add soundfile
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv add torchvision
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>uv sync
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®Œæ•´è„šæœ¬ä»£ç ï¼ˆmain_text2audio.pyï¼‰&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> os
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> soundfile &lt;span style="color:#66d9ef">as&lt;/span> sf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> torch
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> transformers &lt;span style="color:#f92672">import&lt;/span> Qwen2_5OmniForConditionalGeneration, Qwen2_5OmniProcessor
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> qwen_omni_utils &lt;span style="color:#f92672">import&lt;/span> process_mm_info
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> transformers &lt;span style="color:#f92672">import&lt;/span> AutoConfig
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">text_to_speech&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_input: str,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> output_audio_path: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;output/test_audio.wav&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path: str &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;/home/llm/model/qwen/Omni/&amp;#34;&lt;/span> &lt;span style="color:#75715e"># æ”¹ä¸ºæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> æ–‡æœ¬è½¬è¯­éŸ³æ ¸å¿ƒå‡½æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param text_input: è¾“å…¥æ–‡æœ¬ï¼ˆæ”¯æŒä¸­æ–‡/è‹±æ–‡ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param output_audio_path: éŸ³é¢‘è¾“å‡ºè·¯å¾„ï¼ˆå«æ–‡ä»¶åï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param speaker: è¯­éŸ³ç±»å‹ï¼ˆ&amp;#34;Chelsie&amp;#34;å¥³æ€§/&amp;#34;Ethan&amp;#34;ç”·æ€§ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> :param model_path: æ¨¡å‹è·¯å¾„ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 1. åŠ è½½æ¨¡å‹é…ç½®ï¼ˆä¿®å¤ROPEå‚æ•°å…¼å®¹æ€§ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config &lt;span style="color:#f92672">=&lt;/span> AutoConfig&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path, local_files_only&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> hasattr(config, &lt;span style="color:#e6db74">&amp;#34;rope_scaling&amp;#34;&lt;/span>) &lt;span style="color:#f92672">and&lt;/span> &lt;span style="color:#e6db74">&amp;#34;mrope_section&amp;#34;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> config&lt;span style="color:#f92672">.&lt;/span>rope_scaling:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">.&lt;/span>rope_scaling&lt;span style="color:#f92672">.&lt;/span>pop(&lt;span style="color:#e6db74">&amp;#34;mrope_section&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 2. åŠ è½½æ¨¡å‹ï¼ˆæ”¯æŒGPUè‡ªåŠ¨åˆ†é…ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniForConditionalGeneration&lt;span style="color:#f92672">.&lt;/span>from_pretrained(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> model_path,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> config&lt;span style="color:#f92672">=&lt;/span>config,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> torch_dtype&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> device_map&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;auto&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> local_files_only&lt;span style="color:#f92672">=&lt;/span>(model_path &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Qwen/Qwen2.5-Omni-7B&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> processor &lt;span style="color:#f92672">=&lt;/span> Qwen2_5OmniProcessor&lt;span style="color:#f92672">.&lt;/span>from_pretrained(model_path)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 3. ç³»ç»Ÿæç¤ºï¼ˆå¿…é¡»åŒ…å«è¯­éŸ³ç”Ÿæˆèƒ½åŠ›å£°æ˜ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> system_prompt &lt;span style="color:#f92672">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;system&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;You are Qwen, a virtual human developed by the Qwen Team, Alibaba Group, capable of perceiving auditory and visual inputs, as well as generating text and speech.&amp;#34;&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 4. æ„å»ºå¯¹è¯ï¼ˆçº¯æ–‡æœ¬è¾“å…¥ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> conversation &lt;span style="color:#f92672">=&lt;/span> system_prompt &lt;span style="color:#f92672">+&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {&lt;span style="color:#e6db74">&amp;#34;role&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;user&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>: [{&lt;span style="color:#e6db74">&amp;#34;type&amp;#34;&lt;/span>: &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;text&amp;#34;&lt;/span>: text_input}]}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 5. å¤„ç†è¾“å…¥æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text &lt;span style="color:#f92672">=&lt;/span> processor&lt;span style="color:#f92672">.&lt;/span>apply_chat_template(conversation, add_generation_prompt&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, tokenize&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> audios, images, videos &lt;span style="color:#f92672">=&lt;/span> process_mm_info(conversation, use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 6. ç”Ÿæˆè¯­éŸ³&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> inputs &lt;span style="color:#f92672">=&lt;/span> processor(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text&lt;span style="color:#f92672">=&lt;/span>text, audio&lt;span style="color:#f92672">=&lt;/span>audios, images&lt;span style="color:#f92672">=&lt;/span>images, videos&lt;span style="color:#f92672">=&lt;/span>videos,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> return_tensors&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;pt&amp;#34;&lt;/span>, padding&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )&lt;span style="color:#f92672">.&lt;/span>to(model&lt;span style="color:#f92672">.&lt;/span>device, model&lt;span style="color:#f92672">.&lt;/span>dtype)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">with&lt;/span> torch&lt;span style="color:#f92672">.&lt;/span>no_grad():
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_ids, audio &lt;span style="color:#f92672">=&lt;/span> model&lt;span style="color:#f92672">.&lt;/span>generate(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">**&lt;/span>inputs,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>speaker,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> do_sample&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>, &lt;span style="color:#75715e"># å¯ç”¨é‡‡æ ·æ¨¡å¼ä»¥ä½¿ç”¨temperature/top_p&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> temperature&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.8&lt;/span>, &lt;span style="color:#75715e"># æ§åˆ¶éšæœºæ€§ï¼ˆ0.5-1.0è¾ƒè‡ªç„¶ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> top_p&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0.95&lt;/span>, &lt;span style="color:#75715e"># æ ¸é‡‡æ ·å‚æ•°&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> max_new_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1024&lt;/span>, &lt;span style="color:#75715e"># æ§åˆ¶è¯­éŸ³æ—¶é•¿ï¼ˆçº¦15ç§’ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> use_audio_in_video&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">False&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># 7. ä¿å­˜ç»“æœ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> os&lt;span style="color:#f92672">.&lt;/span>makedirs(os&lt;span style="color:#f92672">.&lt;/span>path&lt;span style="color:#f92672">.&lt;/span>dirname(output_audio_path), exist_ok&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> sf&lt;span style="color:#f92672">.&lt;/span>write(output_audio_path, audio&lt;span style="color:#f92672">.&lt;/span>reshape(&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>cpu()&lt;span style="color:#f92672">.&lt;/span>numpy(), samplerate&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">24000&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;âœ… ç”Ÿæˆå®Œæˆï¼š&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>output_audio_path&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print(&lt;span style="color:#e6db74">f&lt;/span>&lt;span style="color:#e6db74">&amp;#34;ğŸ“„ ç”Ÿæˆæ–‡æœ¬ï¼š&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>processor&lt;span style="color:#f92672">.&lt;/span>batch_decode(text_ids, skip_special_tokens&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">True&lt;/span>)[&lt;span style="color:#ae81ff">0&lt;/span>]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__ &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;__main__&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># ç¤ºä¾‹è¾“å…¥ï¼ˆå¯æ›¿æ¢ä¸ºä»»æ„æ–‡æœ¬ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input_text &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;ä½ å¥½ï¼Œè¿™æ˜¯Qwen2.5-Omniçš„æ–‡æœ¬è½¬è¯­éŸ³ç¤ºä¾‹ã€‚ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e"># è°ƒç”¨å‡½æ•°ï¼ˆæŒ‡å®šè¾“å‡ºè·¯å¾„å’Œè¯­éŸ³ç±»å‹ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> text_to_speech(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> input_text,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> output_audio_path&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;output/hello_qwen.wav&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> speaker&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;Chelsie&amp;#34;&lt;/span> &lt;span style="color:#75715e"># å¯é€‰&amp;#34;Ethan&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> )
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿è¡Œè„šæœ¬&lt;/p></description><content:encoded><![CDATA[<p><img alt="Qwen2.5-Omni-7B TTS" loading="lazy" src="https://via.placeholder.com/800x400.png/007bff/ffffff?text=Qwen2.5-Omni-7B+TTS"></p>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>æœ¬è„šæœ¬åŸºäº Qwen2.5-Omni-7B å¤šæ¨¡æ€æ¨¡å‹å®ç°æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰åŠŸèƒ½ï¼Œæ”¯æŒç”Ÿæˆè‡ªç„¶æµç•…çš„ä¸­æ–‡ / è‹±æ–‡è¯­éŸ³ï¼Œå¹¶æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹ï¼ˆå¥³æ€§ â€œChelsieâ€ã€ç”·æ€§ â€œEthanâ€ï¼‰ã€‚è„šæœ¬å¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶ï¼ˆ.wavæ ¼å¼ï¼‰ï¼Œé€‚ç”¨äºè¯­éŸ³åŠ©æ‰‹ã€å†…å®¹åˆ›ä½œã€æ— éšœç¢æœåŠ¡ç­‰åœºæ™¯ã€‚</p>
<h2 id="ä¸»è¦ç‰¹æ€§">ä¸»è¦ç‰¹æ€§</h2>
<ul>
<li>ğŸ™ï¸ æ”¯æŒè‡ªç„¶æµç•…çš„ <strong>ä¸­æ–‡/è‹±æ–‡</strong> è¯­éŸ³åˆæˆ</li>
<li>ğŸ‘¥ æä¾›ä¸¤ç§è¯­éŸ³ç±»å‹é€‰æ‹©ï¼š
<ul>
<li>å¥³æ€§å£°çº¿ï¼š&ldquo;Chelsie&rdquo;</li>
<li>ç”·æ€§å£°çº¿ï¼š&ldquo;Ethan&rdquo;</li>
</ul>
</li>
<li>ğŸ’¾ è¾“å‡ºæ ¼å¼ï¼šæ ‡å‡† <code>.wav</code> éŸ³é¢‘æ–‡ä»¶</li>
<li>ğŸš€ é«˜æ€§èƒ½æ¨ç†ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ</li>
</ul>
<h2 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h2>
<ul>
<li>æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹å¼€å‘</li>
<li>å†…å®¹åˆ›ä½œä¸æ’­å®¢åˆ¶ä½œ</li>
<li>æ— éšœç¢æœåŠ¡</li>
<li>æ•™è‚²ç±»åº”ç”¨</li>
<li>å¤šåª’ä½“å†…å®¹ç”Ÿæˆ</li>
</ul>
<h2 id="å¼€å§‹ä½¿ç”¨">å¼€å§‹ä½¿ç”¨</h2>
<blockquote>
<p>ğŸ’¡ åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>Python 3.8+</li>
<li>CUDA 11.7+ (å¦‚éœ€GPUåŠ é€Ÿ)</li>
<li>è‡³å°‘16GBå¯ç”¨å†…å­˜</li>
</ul></blockquote>
<p>å®‰è£…ä¾èµ–åº“</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uv init
</span></span><span style="display:flex;"><span>uv add git+https://github.com/huggingface/transformers@v4.51.3-Qwen2.5-Omni-preview
</span></span><span style="display:flex;"><span>uv add accelerate
</span></span><span style="display:flex;"><span>uv add qwen-omni-utils<span style="color:#f92672">[</span>decord<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>uv add soundfile
</span></span><span style="display:flex;"><span>uv add torchvision
</span></span><span style="display:flex;"><span>uv sync
</span></span></code></pre></div><p>å®Œæ•´è„šæœ¬ä»£ç ï¼ˆmain_text2audio.pyï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> soundfile <span style="color:#66d9ef">as</span> sf
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> Qwen2_5OmniForConditionalGeneration, Qwen2_5OmniProcessor
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> qwen_omni_utils <span style="color:#f92672">import</span> process_mm_info
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> AutoConfig
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">text_to_speech</span>(
</span></span><span style="display:flex;"><span>    text_input: str,
</span></span><span style="display:flex;"><span>    output_audio_path: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;output/test_audio.wav&#34;</span>,
</span></span><span style="display:flex;"><span>    speaker: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Chelsie&#34;</span>,
</span></span><span style="display:flex;"><span>    model_path: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/home/llm/model/qwen/Omni/&#34;</span>  <span style="color:#75715e"># æ”¹ä¸ºæœ¬åœ°è·¯å¾„æˆ–è¿œç¨‹è·¯å¾„</span>
</span></span><span style="display:flex;"><span>):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    æ–‡æœ¬è½¬è¯­éŸ³æ ¸å¿ƒå‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param text_input: è¾“å…¥æ–‡æœ¬ï¼ˆæ”¯æŒä¸­æ–‡/è‹±æ–‡ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param output_audio_path: éŸ³é¢‘è¾“å‡ºè·¯å¾„ï¼ˆå«æ–‡ä»¶åï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param speaker: è¯­éŸ³ç±»å‹ï¼ˆ&#34;Chelsie&#34;å¥³æ€§/&#34;Ethan&#34;ç”·æ€§ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    :param model_path: æ¨¡å‹è·¯å¾„ï¼ˆæœ¬åœ°/è¿œç¨‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. åŠ è½½æ¨¡å‹é…ç½®ï¼ˆä¿®å¤ROPEå‚æ•°å…¼å®¹æ€§ï¼‰</span>
</span></span><span style="display:flex;"><span>    config <span style="color:#f92672">=</span> AutoConfig<span style="color:#f92672">.</span>from_pretrained(model_path, local_files_only<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> hasattr(config, <span style="color:#e6db74">&#34;rope_scaling&#34;</span>) <span style="color:#f92672">and</span> <span style="color:#e6db74">&#34;mrope_section&#34;</span> <span style="color:#f92672">in</span> config<span style="color:#f92672">.</span>rope_scaling:
</span></span><span style="display:flex;"><span>        config<span style="color:#f92672">.</span>rope_scaling<span style="color:#f92672">.</span>pop(<span style="color:#e6db74">&#34;mrope_section&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. åŠ è½½æ¨¡å‹ï¼ˆæ”¯æŒGPUè‡ªåŠ¨åˆ†é…ï¼‰</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#f92672">=</span> Qwen2_5OmniForConditionalGeneration<span style="color:#f92672">.</span>from_pretrained(
</span></span><span style="display:flex;"><span>        model_path,
</span></span><span style="display:flex;"><span>        config<span style="color:#f92672">=</span>config,
</span></span><span style="display:flex;"><span>        torch_dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        device_map<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auto&#34;</span>,
</span></span><span style="display:flex;"><span>        local_files_only<span style="color:#f92672">=</span>(model_path <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Qwen/Qwen2.5-Omni-7B&#34;</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    processor <span style="color:#f92672">=</span> Qwen2_5OmniProcessor<span style="color:#f92672">.</span>from_pretrained(model_path)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. ç³»ç»Ÿæç¤ºï¼ˆå¿…é¡»åŒ…å«è¯­éŸ³ç”Ÿæˆèƒ½åŠ›å£°æ˜ï¼‰</span>
</span></span><span style="display:flex;"><span>    system_prompt <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;system&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;content&#34;</span>: [
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;You are Qwen, a virtual human developed by the Qwen Team, Alibaba Group, capable of perceiving auditory and visual inputs, as well as generating text and speech.&#34;</span>}
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 4. æ„å»ºå¯¹è¯ï¼ˆçº¯æ–‡æœ¬è¾“å…¥ï¼‰</span>
</span></span><span style="display:flex;"><span>    conversation <span style="color:#f92672">=</span> system_prompt <span style="color:#f92672">+</span> [
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: [{<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;text&#34;</span>: text_input}]}
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 5. å¤„ç†è¾“å…¥æ•°æ®</span>
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> processor<span style="color:#f92672">.</span>apply_chat_template(conversation, add_generation_prompt<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, tokenize<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    audios, images, videos <span style="color:#f92672">=</span> process_mm_info(conversation, use_audio_in_video<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 6. ç”Ÿæˆè¯­éŸ³</span>
</span></span><span style="display:flex;"><span>    inputs <span style="color:#f92672">=</span> processor(
</span></span><span style="display:flex;"><span>        text<span style="color:#f92672">=</span>text, audio<span style="color:#f92672">=</span>audios, images<span style="color:#f92672">=</span>images, videos<span style="color:#f92672">=</span>videos,
</span></span><span style="display:flex;"><span>        return_tensors<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pt&#34;</span>, padding<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, use_audio_in_video<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#f92672">.</span>to(model<span style="color:#f92672">.</span>device, model<span style="color:#f92672">.</span>dtype)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>        text_ids, audio <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>generate(
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">**</span>inputs,
</span></span><span style="display:flex;"><span>            speaker<span style="color:#f92672">=</span>speaker,
</span></span><span style="display:flex;"><span>            do_sample<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,  <span style="color:#75715e"># å¯ç”¨é‡‡æ ·æ¨¡å¼ä»¥ä½¿ç”¨temperature/top_p</span>
</span></span><span style="display:flex;"><span>            temperature<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>,  <span style="color:#75715e"># æ§åˆ¶éšæœºæ€§ï¼ˆ0.5-1.0è¾ƒè‡ªç„¶ï¼‰</span>
</span></span><span style="display:flex;"><span>            top_p<span style="color:#f92672">=</span><span style="color:#ae81ff">0.95</span>,       <span style="color:#75715e"># æ ¸é‡‡æ ·å‚æ•°</span>
</span></span><span style="display:flex;"><span>            max_new_tokens<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>,  <span style="color:#75715e"># æ§åˆ¶è¯­éŸ³æ—¶é•¿ï¼ˆçº¦15ç§’ï¼‰</span>
</span></span><span style="display:flex;"><span>            use_audio_in_video<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 7. ä¿å­˜ç»“æœ</span>
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>makedirs(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(output_audio_path), exist_ok<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    sf<span style="color:#f92672">.</span>write(output_audio_path, audio<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>cpu()<span style="color:#f92672">.</span>numpy(), samplerate<span style="color:#f92672">=</span><span style="color:#ae81ff">24000</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;âœ… ç”Ÿæˆå®Œæˆï¼š</span><span style="color:#e6db74">{</span>output_audio_path<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ğŸ“„ ç”Ÿæˆæ–‡æœ¬ï¼š</span><span style="color:#e6db74">{</span>processor<span style="color:#f92672">.</span>batch_decode(text_ids, skip_special_tokens<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)[<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç¤ºä¾‹è¾“å…¥ï¼ˆå¯æ›¿æ¢ä¸ºä»»æ„æ–‡æœ¬ï¼‰</span>
</span></span><span style="display:flex;"><span>    input_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ä½ å¥½ï¼Œè¿™æ˜¯Qwen2.5-Omniçš„æ–‡æœ¬è½¬è¯­éŸ³ç¤ºä¾‹ã€‚ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è°ƒç”¨å‡½æ•°ï¼ˆæŒ‡å®šè¾“å‡ºè·¯å¾„å’Œè¯­éŸ³ç±»å‹ï¼‰</span>
</span></span><span style="display:flex;"><span>    text_to_speech(
</span></span><span style="display:flex;"><span>        input_text,
</span></span><span style="display:flex;"><span>        output_audio_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;output/hello_qwen.wav&#34;</span>,
</span></span><span style="display:flex;"><span>        speaker<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Chelsie&#34;</span>  <span style="color:#75715e"># å¯é€‰&#34;Ethan&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><p>è¿è¡Œè„šæœ¬</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uv run main.py
</span></span></code></pre></div>]]></content:encoded></item></channel></rss>